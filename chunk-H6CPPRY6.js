import{a as k}from"./chunk-KPJUD5VV.js";import"./chunk-EXYLIBEK.js";import{$ as O,C as P,I as f,J as C,K as y,L as M,P as n,Q as e,R as b,S as h,Ua as R,V as p,W as d,X as E,Y as i,Z as u,_ as s,c as v,ka as w,ma as S,n as _,oa as T,p as g,q as x,x as r}from"./chunk-UKGZAEMS.js";var G=(a,o)=>o.roundNumber;function L(a,o){a&1&&(n(0,"div",2),i(1,"Loading tournament..."),e())}function V(a,o){if(a&1){let t=h();n(0,"div",3)(1,"h2"),i(2,"Waiting for opponent..."),e(),n(3,"p"),i(4),e(),b(5,"div",6),n(6,"button",7),p("click",function(){g(t);let c=d();return x(c.exitGame())}),i(7,"Cancel Tournament"),e()()}if(a&2){let t=d();r(4),s("Tournament created by ",t.tournament.player1Email)}}function z(a,o){a&1&&(n(0,"span",11),i(1,"\u{1F3C6}"),e())}function D(a,o){a&1&&(n(0,"span",11),i(1,"\u{1F3C6}"),e())}function W(a,o){if(a&1&&(n(0,"div",14)(1,"span"),i(2),e(),n(3,"span"),i(4),e(),n(5,"span"),i(6),e()()),a&2){let t=o.$implicit,m=d(2);r(2),s("Round ",t.roundNumber,":"),r(2),O("",m.getIcon(t.player1Choice)," vs ",m.getIcon(t.player2Choice)),r(),E("win",t.winner===m.currentUserId)("lose",t.winner&&t.winner!==m.currentUserId&&t.winner!=="draw"),r(),s(" ",m.getRoundResult(t)," ")}}function F(a,o){if(a&1){let t=h();n(0,"div",4)(1,"h2"),i(2,"Tournament Complete!"),e(),n(3,"div",8)(4,"div",9)(5,"h3"),i(6),e(),n(7,"p",10),i(8),e(),f(9,z,2,0,"span",11),e(),n(10,"div",12),i(11,"VS"),e(),n(12,"div",9)(13,"h3"),i(14),e(),n(15,"p",10),i(16),e(),f(17,D,2,0,"span",11),e()(),n(18,"div",13)(19,"h3"),i(20,"Round Summary"),e(),y(21,W,7,8,"div",14,G),e(),n(23,"button",15),p("click",function(){g(t);let c=d();return x(c.exitGame())}),i(24,"Back to Lobby"),e()()}if(a&2){let t=d();r(4),E("winner",t.isPlayer1Winner()),r(2),u(t.tournament.player1Email),r(2),u(t.tournament.player1Score),r(),C(t.isPlayer1Winner()?9:-1),r(3),E("winner",t.isPlayer2Winner()),r(2),u(t.tournament.player2Email),r(2),u(t.tournament.player2Score),r(),C(t.isPlayer2Winner()?17:-1),r(4),M(t.tournament.rounds)}}function U(a,o){if(a&1&&(n(0,"div",18)(1,"h3"),i(2,"Waiting for opponent..."),e(),n(3,"p"),i(4),e(),b(5,"div",6),e()),a&2){let t=d(2);r(4),s("You chose: ",t.getIcon(t.getCurrentPlayerChoice()))}}function N(a,o){if(a&1){let t=h();n(0,"div",19)(1,"h3"),i(2),e(),n(3,"div",21)(4,"div",22)(5,"div",23),i(6),e(),n(7,"p"),i(8),e()(),n(9,"div",24),i(10,"VS"),e(),n(11,"div",22)(12,"div",23),i(13),e(),n(14,"p"),i(15),e()()(),n(16,"p",25),i(17),e(),n(18,"div",26)(19,"p",27),i(20),e()(),n(21,"button",28),p("click",function(){g(t);let c=d(2);return x(c.continueToNextRound())}),i(22),e()()}if(a&2){let t,m,c,l=d(2);r(2),s("Round ",l.tournament.currentRound-1," Result"),r(4),u(l.getIcon((t=l.getPreviousRound())==null?null:t.player1Choice)),r(2),u(l.tournament.player1Email),r(5),u(l.getIcon((m=l.getPreviousRound())==null?null:m.player2Choice)),r(2),u(l.tournament.player2Email),r(),E("win",l.didCurrentPlayerWinPreviousRound())("lose",!l.didCurrentPlayerWinPreviousRound()&&((c=l.getPreviousRound())==null?null:c.winner)),r(),s(" ",l.getRoundResultText()," "),r(3),s("Auto-continuing in ",l.resultTimeLeft,"s"),r(2),s(" Continue to Round ",l.tournament.currentRound," Now ")}}function j(a,o){if(a&1){let t=h();n(0,"div",20)(1,"div",29)(2,"p",27),i(3),e()(),n(4,"h3"),i(5,"Make your choice:"),e(),n(6,"div",30)(7,"button",31),p("click",function(){g(t);let c=d(2);return x(c.makeChoice("rock"))}),n(8,"span",23),i(9,"\u270A"),e(),n(10,"span"),i(11,"Rock"),e()(),n(12,"button",31),p("click",function(){g(t);let c=d(2);return x(c.makeChoice("paper"))}),n(13,"span",23),i(14,"\u270B"),e(),n(15,"span"),i(16,"Paper"),e()(),n(17,"button",31),p("click",function(){g(t);let c=d(2);return x(c.makeChoice("scissors"))}),n(18,"span",23),i(19,"\u270C\uFE0F"),e(),n(20,"span"),i(21,"Scissors"),e()()()()}if(a&2){let t=d(2);r(3),s("\u23F1\uFE0F Time remaining: ",t.moveTimeLeft,"s")}}function A(a,o){if(a&1&&(n(0,"div",5)(1,"div",16)(2,"div",17)(3,"span"),i(4,"Round:"),e(),n(5,"strong"),i(6),e()(),n(7,"div",17)(8,"span"),i(9),e(),n(10,"strong"),i(11),e()(),n(12,"div",17)(13,"span"),i(14),e(),n(15,"strong"),i(16),e()()(),f(17,U,6,1,"div",18)(18,N,23,12,"div",19)(19,j,22,1,"div",20),e()),a&2){let t=d();r(6),s("",t.tournament.currentRound," / 5"),r(3),s("",t.tournament.player1Email,":"),r(2),u(t.tournament.player1Score),r(3),s("",t.tournament.player2Email,":"),r(2),u(t.tournament.player2Score),r(),C(t.hasCurrentPlayerMadeChoice()?17:t.isRoundComplete()&&t.tournament.currentRound<=5?18:19)}}var I=class a{tournamentService=_(k);route=_(S);router=_(T);auth=_(R);tournament=null;tournamentId="";currentUserId="";subscription;acknowledgedRounds=new Set;resultTimer=null;moveTimer=null;resultTimeLeft=30;moveTimeLeft=60;continueToNextRound(){this.tournament&&(this.acknowledgedRounds.add(this.tournament.currentRound-1),this.clearResultTimer(),this.startMoveTimer())}startResultTimer(){this.clearResultTimer(),this.resultTimeLeft=30,this.resultTimer=setInterval(()=>{this.resultTimeLeft--,this.resultTimeLeft<=0&&this.continueToNextRound()},1e3)}clearResultTimer(){this.resultTimer&&(clearInterval(this.resultTimer),this.resultTimer=null)}startMoveTimer(){this.clearMoveTimer(),this.moveTimeLeft=60,this.moveTimer=setInterval(()=>{this.moveTimeLeft--,this.moveTimeLeft<=0&&this.autoLoseRound()},1e3)}clearMoveTimer(){this.moveTimer&&(clearInterval(this.moveTimer),this.moveTimer=null)}autoLoseRound(){return v(this,null,function*(){this.hasCurrentPlayerMadeChoice()||(yield this.makeChoice("rock")),this.clearMoveTimer()})}ngOnInit(){this.currentUserId=this.auth.currentUser?.uid||"",this.tournamentId=this.route.snapshot.paramMap.get("tournamentId")||"",this.tournamentId&&(this.subscription=this.tournamentService.getTournament(this.tournamentId).subscribe({next:o=>{if(this.tournament=o,!o){alert("Tournament not found"),this.router.navigate(["/lobby"]);return}o.status==="in-progress"&&(this.isRoundComplete()?this.startResultTimer():this.hasCurrentPlayerMadeChoice()||this.startMoveTimer())},error:o=>{console.error("Error loading tournament:",o),this.router.navigate(["/lobby"])}}))}ngOnDestroy(){this.subscription?.unsubscribe(),this.clearResultTimer(),this.clearMoveTimer()}makeChoice(o){return v(this,null,function*(){try{this.clearMoveTimer(),yield this.tournamentService.makeChoice(this.tournamentId,o)}catch(t){console.error("Error making choice:",t),alert("Failed to make choice")}})}hasCurrentPlayerMadeChoice(){if(!this.tournament)return!1;let o=this.tournament.rounds[this.tournament.currentRound-1];return o?this.currentUserId===this.tournament.player1Id?!!o.player1Choice:!!o.player2Choice:!1}getCurrentPlayerChoice(){if(!this.tournament)return null;let o=this.tournament.rounds[this.tournament.currentRound-1];return this.currentUserId===this.tournament.player1Id?o.player1Choice:o.player2Choice}isRoundComplete(){if(!this.tournament||this.tournament.currentRound===1)return!1;let o=this.tournament.rounds[this.tournament.currentRound-2],t=this.tournament.currentRound-1;return o?.completed&&!this.acknowledgedRounds.has(t)}getPreviousRound(){return!this.tournament||this.tournament.currentRound===1?null:this.tournament.rounds[this.tournament.currentRound-2]}didCurrentPlayerWinPreviousRound(){return this.getPreviousRound()?.winner===this.currentUserId}getRoundResultText(){let o=this.getPreviousRound();return o?o.winner?o.winner===this.currentUserId?"You Win!":"You Lose!":"It's a Draw!":""}isPlayer1Winner(){return this.tournament?this.tournament.player1Score>this.tournament.player2Score:!1}isPlayer2Winner(){return this.tournament?this.tournament.player2Score>this.tournament.player1Score:!1}getRoundResult(o){return o.winner?o.winner===this.currentUserId?"Won":"Lost":"Draw"}getIcon(o){return o&&{rock:"\u270A",paper:"\u270B",scissors:"\u270C\uFE0F"}[o]||"?"}exitGame(){this.tournament?.status==="waiting"&&this.tournament.player1Id===this.currentUserId?confirm("Cancel this tournament?")&&(this.tournamentService.deleteTournament(this.tournamentId),this.router.navigate(["/lobby"])):this.router.navigate(["/lobby"])}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=P({type:a,selectors:[["app-game"]],decls:10,vars:1,consts:[[1,"game-container"],[1,"btn-exit",3,"click"],[1,"loading"],[1,"waiting-screen"],[1,"end-screen"],[1,"game-screen"],[1,"spinner"],[1,"btn-cancel",3,"click"],[1,"final-score"],[1,"player-card"],[1,"score"],[1,"trophy"],[1,"vs"],[1,"rounds-summary"],[1,"round-summary-item"],[1,"btn-lobby",3,"click"],[1,"scoreboard"],[1,"score-item"],[1,"waiting-choice"],[1,"round-result"],[1,"choice-buttons"],[1,"choices"],[1,"choice-display"],[1,"icon"],[1,"vs-text"],[1,"result-text"],[1,"timer-display"],[1,"timer-text"],[1,"btn-continue",3,"click"],[1,"timer-display","warning"],[1,"buttons"],[1,"btn-choice",3,"click"]],template:function(t,m){t&1&&(n(0,"div",0)(1,"header")(2,"h1"),i(3,"\u{1F3C6} RPS Tournament"),e(),n(4,"button",1),p("click",function(){return m.exitGame()}),i(5,"Exit to Lobby"),e()(),f(6,L,2,0,"div",2)(7,V,8,1,"div",3)(8,F,25,10,"div",4)(9,A,20,6,"div",5),e()),t&2&&(r(6),C(m.tournament?m.tournament.status==="waiting"?7:m.tournament.status==="completed"?8:9:6))},dependencies:[w],styles:[".game-container[_ngcontent-%COMP%]{min-height:100vh;background:linear-gradient(135deg,#667eea,#764ba2);padding:20px}header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;max-width:900px;margin:0 auto 30px}h1[_ngcontent-%COMP%]{color:#fff;margin:0}.btn-exit[_ngcontent-%COMP%]{padding:10px 20px;background:#fff3;color:#fff;border:2px solid white;border-radius:5px;cursor:pointer;font-weight:600}.btn-exit[_ngcontent-%COMP%]:hover{background:#ffffff4d}.loading[_ngcontent-%COMP%], .waiting-screen[_ngcontent-%COMP%], .end-screen[_ngcontent-%COMP%], .game-screen[_ngcontent-%COMP%]{background:#fff;max-width:900px;margin:0 auto;padding:40px;border-radius:10px;box-shadow:0 10px 40px #0003}.loading[_ngcontent-%COMP%]{text-align:center;font-size:18px;color:#666}.waiting-screen[_ngcontent-%COMP%], .end-screen[_ngcontent-%COMP%]{text-align:center}.waiting-screen[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .end-screen[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:20px;color:#333}.spinner[_ngcontent-%COMP%]{width:50px;height:50px;border:5px solid #f3f3f3;border-top:5px solid #667eea;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin:30px auto}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.btn-cancel[_ngcontent-%COMP%], .btn-lobby[_ngcontent-%COMP%]{padding:12px 30px;background:#f44336;color:#fff;border:none;border-radius:5px;font-weight:600;cursor:pointer;margin-top:20px}.btn-cancel[_ngcontent-%COMP%]:hover{background:#da190b}.btn-continue[_ngcontent-%COMP%]{padding:15px 40px;background:#4caf50;color:#fff;border:none;border-radius:5px;font-size:18px;font-weight:600;cursor:pointer;margin-top:30px;transition:background .3s}.btn-continue[_ngcontent-%COMP%]:hover{background:#45a049}.timer-display[_ngcontent-%COMP%]{margin:20px 0;padding:15px;background:#e3f2fd;border-radius:8px;border:2px solid #2196f3}.timer-display.warning[_ngcontent-%COMP%]{background:#fff3e0;border-color:#ff9800}.timer-text[_ngcontent-%COMP%]{font-size:18px;font-weight:600;color:#1976d2;margin:0}.timer-display.warning[_ngcontent-%COMP%]   .timer-text[_ngcontent-%COMP%]{color:#f57c00}.btn-lobby[_ngcontent-%COMP%]{background:#667eea}.btn-lobby[_ngcontent-%COMP%]:hover{background:#5568d3}.scoreboard[_ngcontent-%COMP%]{display:flex;justify-content:space-around;margin-bottom:40px;padding:20px;background:#f5f5f5;border-radius:10px}.score-item[_ngcontent-%COMP%]{text-align:center}.score-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:block;color:#666;margin-bottom:5px;font-size:14px}.score-item[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:24px;color:#333}.choice-buttons[_ngcontent-%COMP%]{text-align:center}.choice-buttons[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:30px;color:#333}.buttons[_ngcontent-%COMP%]{display:flex;gap:20px;justify-content:center;flex-wrap:wrap}.btn-choice[_ngcontent-%COMP%]{padding:30px;background:#fff;border:3px solid #667eea;border-radius:10px;cursor:pointer;transition:all .3s;display:flex;flex-direction:column;align-items:center;gap:10px;min-width:120px}.btn-choice[_ngcontent-%COMP%]:hover{background:#667eea;color:#fff;transform:translateY(-5px);box-shadow:0 8px 16px #667eea4d}.btn-choice[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{font-size:48px}.waiting-choice[_ngcontent-%COMP%]{text-align:center;padding:40px}.waiting-choice[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#333;margin-bottom:20px}.waiting-choice[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:48px;margin:20px 0}.round-result[_ngcontent-%COMP%]{text-align:center}.choices[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:40px;margin:30px 0;flex-wrap:wrap}.choice-display[_ngcontent-%COMP%]{text-align:center}.choice-display[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{font-size:72px;margin-bottom:10px}.choice-display[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:14px;color:#666}.vs-text[_ngcontent-%COMP%]{font-size:24px;font-weight:600;color:#666}.result-text[_ngcontent-%COMP%]{font-size:28px;font-weight:600;margin:30px 0}.result-text.win[_ngcontent-%COMP%]{color:#4caf50}.result-text.lose[_ngcontent-%COMP%]{color:#f44336}.final-score[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:40px;margin:40px 0;flex-wrap:wrap}.player-card[_ngcontent-%COMP%]{text-align:center;padding:30px 40px;background:#f5f5f5;border-radius:10px;border:3px solid transparent;position:relative;min-width:200px}.player-card.winner[_ngcontent-%COMP%]{border-color:gold;background:linear-gradient(135deg,#fff9e6,#ffe6b3)}.player-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:15px;color:#333;font-size:16px}.player-card[_ngcontent-%COMP%]   .score[_ngcontent-%COMP%]{font-size:48px;font-weight:600;margin:0;color:#667eea}.player-card[_ngcontent-%COMP%]   .trophy[_ngcontent-%COMP%]{font-size:32px;position:absolute;top:-15px;right:-15px}.vs[_ngcontent-%COMP%]{font-size:24px;font-weight:600;color:#666}.rounds-summary[_ngcontent-%COMP%]{margin:40px 0;padding:20px;background:#f9f9f9;border-radius:8px}.rounds-summary[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:20px;color:#333;text-align:center}.round-summary-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:12px;margin-bottom:10px;background:#fff;border-radius:5px;font-size:18px}.round-summary-item[_ngcontent-%COMP%]   .win[_ngcontent-%COMP%]{color:#4caf50;font-weight:600}.round-summary-item[_ngcontent-%COMP%]   .lose[_ngcontent-%COMP%]{color:#f44336;font-weight:600}"]})};export{I as GameComponent};
