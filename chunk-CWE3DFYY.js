import{D as g,Da as P,E as _,F as v,G as E,L as n,M as i,N as k,O as b,R as m,S as s,U as r,V as C,W as h,c as p,ga as y,ka as O,m as x,n as f,o as u,pa as w,t as l,x as M}from"./chunk-PUHYVJE5.js";var F=(o,t)=>t.id;function S(o,t){o&1&&(n(0,"div",3),k(1,"div",5),n(2,"p"),r(3,"Loading friends..."),i()())}function R(o,t){if(o&1){let e=b();n(0,"div",13)(1,"div",14)(2,"span",15),r(3,"\u2694\uFE0F"),i(),n(4,"div",16)(5,"span",17),r(6),i(),n(7,"span",18),r(8,"wants to play!"),i()()(),n(9,"div",19)(10,"button",20),m("click",function(){let a=f(e).$implicit,c=s(3);return u(c.acceptRequest(a))}),r(11," Accept "),i(),n(12,"button",21),m("click",function(){let a=f(e).$implicit,c=s(3);return u(c.declineRequest(a))}),r(13," Decline "),i()()()}if(o&2){let e=t.$implicit;l(6),C(e.fromNickname)}}function T(o,t){if(o&1&&(n(0,"div",6)(1,"div",11)(2,"h2"),r(3),i()(),n(4,"div",12),v(5,R,14,1,"div",13,F),i()()),o&2){let e=s(2);l(3),h("\u{1F3AE} Game Requests (",e.gameRequests.length,")"),l(2),E(e.gameRequests)}}function I(o,t){o&1&&(n(0,"div",9)(1,"p"),r(2,"You haven't added any friends yet"),i(),n(3,"p",22),r(4,"Add friends after playing games together!"),i()())}function D(o,t){if(o&1){let e=b();n(0,"div",23)(1,"div",24)(2,"span",25),r(3,"\u{1F464}"),i(),n(4,"div",26)(5,"span",27),r(6),i(),n(7,"span",28),r(8),i()()(),n(9,"div",29)(10,"button",30),m("click",function(){let a=f(e).$implicit,c=s(3);return u(c.challengeFriend(a))}),r(11," Challenge "),i(),n(12,"button",31),m("click",function(){let a=f(e).$implicit,c=s(3);return u(c.confirmRemoveFriend(a))}),r(13," Remove "),i()()()}if(o&2){let e=t.$implicit,d=s(3);l(6),C(e.friendNickname),l(2),h("Added ",d.formatDate(e.addedAt))}}function V(o,t){if(o&1&&(n(0,"div",10),v(1,D,14,2,"div",23,F),i()),o&2){let e=s(2);l(),E(e.friends)}}function G(o,t){if(o&1&&(g(0,T,7,1,"div",6),n(1,"div",7)(2,"div",8)(3,"h2"),r(4),i()(),g(5,I,5,0,"div",9)(6,V,3,0,"div",10),i()),o&2){let e=s();_(e.gameRequests.length>0?0:-1),l(4),h("Your Friends (",e.friends.length,")"),l(),_(e.friends.length===0?5:6)}}function L(o,t){if(o&1){let e=b();n(0,"div",32),m("click",function(){f(e);let a=s();return u(a.cancelRemove())}),n(1,"div",33),m("click",function(a){return f(e),u(a.stopPropagation())}),n(2,"h3"),r(3,"Remove Friend?"),i(),n(4,"p"),r(5,"Are you sure you want to remove "),n(6,"strong"),r(7),i(),r(8," from your friends list?"),i(),n(9,"div",34)(10,"button",35),m("click",function(){f(e);let a=s();return u(a.cancelRemove())}),r(11,"Cancel"),i(),n(12,"button",36),m("click",function(){f(e);let a=s();return u(a.removeFriend())}),r(13,"Remove"),i()()()()}if(o&2){let e=s();l(7),C(e.friendToRemove==null?null:e.friendToRemove.friendEmail)}}var q=class o{router=x(O);auth=x(w);tournamentService=x(P);loading=!0;friends=[];gameRequests=[];showConfirmModal=!1;friendToRemove=null;requestsSubscription;sentRequestsSubscription;ngOnInit(){return p(this,null,function*(){yield this.loadFriends(),this.loadGameRequests(),this.watchSentRequests()})}ngOnDestroy(){this.requestsSubscription?.unsubscribe(),this.sentRequestsSubscription?.unsubscribe()}loadFriends(){return p(this,null,function*(){let t=this.auth.currentUser?.uid;if(t)try{this.friends=yield this.tournamentService.getFriends(t)}catch(e){console.error("Error loading friends:",e)}finally{this.loading=!1}})}loadGameRequests(){let t=this.auth.currentUser?.uid;t&&(this.requestsSubscription=this.tournamentService.getGameRequests(t).subscribe(e=>{this.gameRequests=e}))}watchSentRequests(){let t=this.auth.currentUser?.uid;t&&(this.sentRequestsSubscription=this.tournamentService.getSentGameRequests(t).subscribe(e=>{e.forEach(d=>{d.status==="accepted"&&d.tournamentId&&this.router.navigate(["/game",d.tournamentId])})}))}sendGameRequest(t){return p(this,null,function*(){try{let e=yield this.tournamentService.hasActiveGameWith(t.friendId);if(e){confirm("You already have an active game with this player. Would you like to resume it?")&&this.router.navigate(["/game",e]);return}yield this.tournamentService.sendGameRequest(t.friendId,t.friendEmail,t.friendNickname),alert(`Game request sent to ${t.friendNickname}!`)}catch(e){console.error("Error sending game request:",e),alert("Failed to send game request")}})}challengeFriend(t){return p(this,null,function*(){try{yield this.tournamentService.sendGameRequest(t.friendId,t.friendEmail,t.friendNickname),alert(`Challenge sent to ${t.friendNickname}!`)}catch(e){console.error("Error sending challenge:",e),alert("Failed to send challenge")}})}acceptRequest(t){return p(this,null,function*(){try{let e=yield this.tournamentService.acceptGameRequest(t.id);this.router.navigate(["/game",e])}catch(e){console.error("Error accepting request:",e),alert("Failed to accept request")}})}declineRequest(t){return p(this,null,function*(){try{yield this.tournamentService.declineGameRequest(t.id)}catch(e){console.error("Error declining request:",e),alert("Failed to decline request")}})}confirmRemoveFriend(t){this.friendToRemove=t,this.showConfirmModal=!0}cancelRemove(){this.showConfirmModal=!1,this.friendToRemove=null}removeFriend(){return p(this,null,function*(){if(this.friendToRemove)try{yield this.tournamentService.removeFriend(this.friendToRemove.friendId),this.showConfirmModal=!1,this.friendToRemove=null,yield this.loadFriends()}catch(t){console.error("Error removing friend:",t),alert("Failed to remove friend")}})}formatDate(t){if(!t)return"";let e=t.toDate(),a=Math.abs(new Date().getTime()-e.getTime()),c=Math.ceil(a/(1e3*60*60*24));return c===0?"today":c===1?"yesterday":c<7?`${c} days ago`:c<30?`${Math.floor(c/7)} weeks ago`:c<365?`${Math.floor(c/30)} months ago`:`${Math.floor(c/365)} years ago`}goToLobby(){this.router.navigate(["/lobby"])}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=M({type:o,selectors:[["app-friends"]],decls:10,vars:2,consts:[[1,"friends-container"],[1,"btn-back",3,"click"],[1,"friends-content"],[1,"loading"],[1,"modal-overlay"],[1,"spinner"],[1,"requests-card"],[1,"friends-card"],[1,"friends-header"],[1,"empty-state"],[1,"friends-list"],[1,"requests-header"],[1,"requests-list"],[1,"request-item"],[1,"request-info"],[1,"request-icon"],[1,"request-details"],[1,"request-name"],[1,"request-text"],[1,"request-actions"],[1,"btn-accept",3,"click"],[1,"btn-decline",3,"click"],[1,"sub-text"],[1,"friend-item"],[1,"friend-info"],[1,"friend-icon"],[1,"friend-details"],[1,"friend-name"],[1,"friend-date"],[1,"friend-actions"],[1,"btn-challenge",3,"click"],[1,"btn-remove",3,"click"],[1,"modal-overlay",3,"click"],[1,"modal-content",3,"click"],[1,"modal-actions"],[1,"btn-cancel-modal",3,"click"],[1,"btn-confirm-remove",3,"click"]],template:function(e,d){e&1&&(n(0,"div",0)(1,"header")(2,"h1"),r(3,"\u{1F465} Friends"),i(),n(4,"button",1),m("click",function(){return d.goToLobby()}),r(5,"Back to Lobby"),i()(),n(6,"div",2),g(7,S,4,0,"div",3)(8,G,7,3),i(),g(9,L,14,1,"div",4),i()),e&2&&(l(7),_(d.loading?7:8),l(2),_(d.showConfirmModal?9:-1))},dependencies:[y],styles:[".friends-container[_ngcontent-%COMP%]{min-height:100vh;background:linear-gradient(135deg,#667eea,#764ba2);padding:20px}header[_ngcontent-%COMP%]{max-width:800px;margin:0 auto 30px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:20px}h1[_ngcontent-%COMP%]{color:#fff;margin:0}.btn-back[_ngcontent-%COMP%]{padding:10px 20px;background:#fff3;color:#fff;border:2px solid white;border-radius:5px;cursor:pointer;font-weight:600}.btn-back[_ngcontent-%COMP%]:hover{background:#ffffff4d}.friends-content[_ngcontent-%COMP%]{max-width:800px;margin:0 auto}.loading[_ngcontent-%COMP%]{background:#fff;padding:60px;border-radius:10px;text-align:center}.spinner[_ngcontent-%COMP%]{width:50px;height:50px;border:5px solid #f3f3f3;border-top:5px solid #667eea;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin:0 auto 20px}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.loading[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#666;font-size:16px}.requests-card[_ngcontent-%COMP%]{background:#fff;border-radius:10px;box-shadow:0 10px 40px #0003;margin-bottom:30px;overflow:hidden;border:3px solid #ffd700}.requests-header[_ngcontent-%COMP%]{padding:20px 30px;background:linear-gradient(135deg,#fff9e6,#ffe6b3);border-bottom:2px solid #ffd700}.requests-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;color:#333}.requests-list[_ngcontent-%COMP%]{display:flex;flex-direction:column}.request-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:20px 30px;border-bottom:1px solid #f0f0f0;background:#fffbf0}.request-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.request-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:15px}.request-icon[_ngcontent-%COMP%]{font-size:32px;width:50px;height:50px;display:flex;align-items:center;justify-content:center;background:#fff3cd;border-radius:50%}.request-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:5px}.request-name[_ngcontent-%COMP%]{font-size:16px;font-weight:600;color:#333}.request-text[_ngcontent-%COMP%]{font-size:14px;color:#666}.request-actions[_ngcontent-%COMP%]{display:flex;gap:10px}.btn-accept[_ngcontent-%COMP%], .btn-decline[_ngcontent-%COMP%]{padding:10px 20px;border:none;border-radius:5px;cursor:pointer;font-weight:600;transition:background .3s}.btn-accept[_ngcontent-%COMP%]{background:#4caf50;color:#fff}.btn-accept[_ngcontent-%COMP%]:hover{background:#45a049}.btn-decline[_ngcontent-%COMP%]{background:#f44336;color:#fff}.btn-decline[_ngcontent-%COMP%]:hover{background:#da190b}.friends-card[_ngcontent-%COMP%]{background:#fff;border-radius:10px;box-shadow:0 10px 40px #0003;overflow:hidden}.friends-header[_ngcontent-%COMP%]{padding:25px 30px;border-bottom:2px solid #f0f0f0}.friends-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;color:#333}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:80px 20px;color:#999}.empty-state[_ngcontent-%COMP%]   .sub-text[_ngcontent-%COMP%]{font-size:14px;margin-top:10px}.friends-list[_ngcontent-%COMP%]{display:flex;flex-direction:column}.friend-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:20px 30px;border-bottom:1px solid #f0f0f0;transition:background .3s}.friend-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.friend-item[_ngcontent-%COMP%]:hover{background:#f9f9f9}.friend-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:15px}.friend-icon[_ngcontent-%COMP%]{font-size:32px;width:50px;height:50px;display:flex;align-items:center;justify-content:center;background:#e3f2fd;border-radius:50%}.friend-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:5px}.friend-name[_ngcontent-%COMP%]{font-size:16px;font-weight:600;color:#333}.friend-date[_ngcontent-%COMP%]{font-size:13px;color:#999}.friend-actions[_ngcontent-%COMP%]{display:flex;gap:10px}.btn-challenge[_ngcontent-%COMP%]{padding:8px 20px;background:#667eea;color:#fff;border:none;border-radius:5px;cursor:pointer;font-weight:600;transition:background .3s}.btn-challenge[_ngcontent-%COMP%]:hover{background:#5568d3}.btn-remove[_ngcontent-%COMP%]{padding:8px 20px;background:#f44336;color:#fff;border:none;border-radius:5px;cursor:pointer;font-weight:600;transition:background .3s}.btn-remove[_ngcontent-%COMP%]:hover{background:#da190b}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000000b3;display:flex;align-items:center;justify-content:center;z-index:1000;padding:20px}.modal-content[_ngcontent-%COMP%]{background:#fff;padding:30px;border-radius:10px;max-width:400px;width:100%;box-shadow:0 10px 40px #0000004d}.modal-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 15px;color:#333}.modal-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 25px;color:#666;line-height:1.5}.modal-actions[_ngcontent-%COMP%]{display:flex;gap:10px;justify-content:flex-end}.btn-cancel-modal[_ngcontent-%COMP%], .btn-confirm-remove[_ngcontent-%COMP%]{padding:10px 20px;border:none;border-radius:5px;cursor:pointer;font-weight:600;transition:background .3s}.btn-cancel-modal[_ngcontent-%COMP%]{background:#e0e0e0;color:#333}.btn-cancel-modal[_ngcontent-%COMP%]:hover{background:#d0d0d0}.btn-confirm-remove[_ngcontent-%COMP%]{background:#f44336;color:#fff}.btn-confirm-remove[_ngcontent-%COMP%]:hover{background:#da190b}"]})};export{q as FriendsComponent};
