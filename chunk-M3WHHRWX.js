import{D as Nt,F as Hi,G as Ue,K as Hh,N as Ye,a as je,b as ea,c as Dt,d as m,e as Me,g as jh,h as zh,i as ta,j as na,k as ra,m as xr,o as Wh,p as Gh,s as Gi,u as Vn,v as Fe,w as Ln,wa as ia,x as Kh,y as Ki}from"./chunk-7ZLQ5FKV.js";var Qh=()=>{};var Xh=function(n){let e=[],t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},n_=function(n){let e=[],t=0,r=0;for(;t<n.length;){let i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=n[t++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){let s=n[t++],a=n[t++],c=n[t++],l=((i&7)<<18|(s&63)<<12|(a&63)<<6|c&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{let s=n[t++],a=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|a&63)}}return e.join("")},Qi={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){let s=n[i],a=i+1<n.length,c=a?n[i+1]:0,l=i+2<n.length,d=l?n[i+2]:0,p=s>>2,_=(s&3)<<4|c>>4,I=(c&15)<<2|d>>6,R=d&63;l||(R=64,a||(I=64)),r.push(t[p],t[_],t[I],t[R])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Xh(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):n_(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();let t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){let s=t[n.charAt(i++)],c=i<n.length?t[n.charAt(i)]:0;++i;let d=i<n.length?t[n.charAt(i)]:64;++i;let _=i<n.length?t[n.charAt(i)]:64;if(++i,s==null||c==null||d==null||_==null)throw new oa;let I=s<<2|c>>4;if(r.push(I),d!==64){let R=c<<4&240|d>>2;if(r.push(R),_!==64){let k=d<<6&192|_;r.push(k)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},oa=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},r_=function(n){let e=Xh(n);return Qi.encodeByteArray(e,!0)},Lr=function(n){return r_(n).replace(/\./g,"")},Ji=function(n){try{return Qi.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function ca(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var i_=()=>ca().__FIREBASE_DEFAULTS__,s_=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},o_=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let e=n&&Ji(n[1]);return e&&JSON.parse(e)},Yi=()=>{try{return Qh()||i_()||s_()||o_()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},ua=n=>{var e,t;return(t=(e=Yi())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},Zh=n=>{let e=ua(n);if(!e)return;let t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);let r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},la=()=>{var n;return(n=Yi())===null||n===void 0?void 0:n.config},ha=n=>{var e;return(e=Yi())===null||e===void 0?void 0:e[`_${n}`]};var sn=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}};function Ot(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}function Xi(n){return m(this,null,function*(){return(yield fetch(n,{credentials:"include"})).ok})}function ed(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let t={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let a=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},n);return[Lr(JSON.stringify(t)),Lr(JSON.stringify(a)),""].join(".")}var Vr={};function a_(){let n={prod:[],emulator:[]};for(let e of Object.keys(Vr))Vr[e]?n.emulator.push(e):n.prod.push(e);return n}function c_(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}var Jh=!1;function Zi(n,e){if(typeof window>"u"||typeof document>"u"||!Ot(window.location.host)||Vr[n]===e||Vr[n]||Jh)return;Vr[n]=e;function t(I){return`__firebase__banner__${I}`}let r="__firebase__banner",s=a_().prod.length>0;function a(){let I=document.getElementById(r);I&&I.remove()}function c(I){I.style.display="flex",I.style.background="#7faaf0",I.style.position="fixed",I.style.bottom="5px",I.style.left="5px",I.style.padding=".5em",I.style.borderRadius="5px",I.style.alignItems="center"}function l(I,R){I.setAttribute("width","24"),I.setAttribute("id",R),I.setAttribute("height","24"),I.setAttribute("viewBox","0 0 24 24"),I.setAttribute("fill","none"),I.style.marginLeft="-6px"}function d(){let I=document.createElement("span");return I.style.cursor="pointer",I.style.marginLeft="16px",I.style.fontSize="24px",I.innerHTML=" &times;",I.onclick=()=>{Jh=!0,a()},I}function p(I,R){I.setAttribute("id",R),I.innerText="Learn more",I.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",I.setAttribute("target","__blank"),I.style.paddingLeft="5px",I.style.textDecoration="underline"}function _(){let I=c_(r),R=t("text"),k=document.getElementById(R)||document.createElement("span"),x=t("learnmore"),D=document.getElementById(x)||document.createElement("a"),$=t("preprendIcon"),U=document.getElementById($)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(I.created){let j=I.element;c(j),p(D,x);let X=d();l(U,$),j.append(U,k,D,X),document.body.appendChild(j)}s?(k.innerText="Preview backend disconnected.",U.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(U.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,k.innerText="Preview backend running in this workspace."),k.setAttribute("id",R)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",_):_()}function me(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function td(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(me())}function u_(){var n;let e=(n=Yi())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function nd(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function rd(){let n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function id(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function sd(){let n=me();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function od(){return!u_()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Mr(){try{return typeof indexedDB=="object"}catch{return!1}}function ad(){return new Promise((n,e)=>{try{let t=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var s;e(((s=i.error)===null||s===void 0?void 0:s.message)||"")}}catch(t){e(t)}})}var l_="FirebaseError",xe=class n extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=l_,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ze.prototype.create)}},ze=class{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){let r=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],a=s?h_(s,r):"Error",c=`${this.serviceName}: ${a} (${i}).`;return new xe(i,c,r)}};function h_(n,e){return n.replace(d_,(t,r)=>{let i=e[r];return i!=null?String(i):`<${r}?>`})}var d_=/\{\$([^}]+)}/g;function cd(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Xe(n,e){if(n===e)return!0;let t=Object.keys(n),r=Object.keys(e);for(let i of t){if(!r.includes(i))return!1;let s=n[i],a=e[i];if(Yh(s)&&Yh(a)){if(!Xe(s,a))return!1}else if(s!==a)return!1}for(let i of r)if(!t.includes(i))return!1;return!0}function Yh(n){return n!==null&&typeof n=="object"}function Fr(n){let e=[];for(let[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Mn(n){let e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){let[i,s]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(s)}}),e}function Fn(n){let e=n.indexOf("?");if(!e)return"";let t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function ud(n,e){let t=new aa(n,e);return t.subscribe.bind(t)}var aa=class{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let i;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");f_(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:r},i.next===void 0&&(i.next=sa),i.error===void 0&&(i.error=sa),i.complete===void 0&&(i.complete=sa);let s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};function f_(n,e){if(typeof n!="object"||n===null)return!1;for(let t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function sa(){}var BT=14400*1e3;function ce(n){return n&&n._delegate?n._delegate:n}var Pe=class{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};var on="[DEFAULT]";var da=class{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let r=new sn;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{let i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let r=this.normalizeInstanceIdentifier(e?.identifier),i=(t=e?.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(m_(e))try{this.getOrInitializeService({instanceIdentifier:on})}catch{}for(let[t,r]of this.instancesDeferred.entries()){let i=this.normalizeInstanceIdentifier(t);try{let s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=on){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){return m(this,null,function*(){let e=Array.from(this.instances.values());yield Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])})}isComponentSet(){return this.component!=null}isInitialized(e=on){return this.instances.has(e)}getOptions(e=on){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[s,a]of this.instancesDeferred.entries()){let c=this.normalizeInstanceIdentifier(s);r===c&&a.resolve(i)}return i}onInit(e,t){var r;let i=this.normalizeInstanceIdentifier(t),s=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;s.add(e),this.onInitCallbacks.set(i,s);let a=this.instances.get(i);return a&&e(a,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:p_(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=on){return this.component?this.component.multipleInstances?e:on:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function p_(n){return n===on?void 0:n}function m_(n){return n.instantiationMode==="EAGER"}var es=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new da(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}};var g_=[],W=(function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n})(W||{}),__={debug:W.DEBUG,verbose:W.VERBOSE,info:W.INFO,warn:W.WARN,error:W.ERROR,silent:W.SILENT},y_=W.INFO,v_={[W.DEBUG]:"log",[W.VERBOSE]:"log",[W.INFO]:"info",[W.WARN]:"warn",[W.ERROR]:"error"},I_=(n,e,...t)=>{if(e<n.logLevel)return;let r=new Date().toISOString(),i=v_[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},Ze=class{constructor(e){this.name=e,this._logLevel=y_,this._logHandler=I_,this._userLogHandler=null,g_.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in W))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?__[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,W.DEBUG,...e),this._logHandler(this,W.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,W.VERBOSE,...e),this._logHandler(this,W.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,W.INFO,...e),this._logHandler(this,W.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,W.WARN,...e),this._logHandler(this,W.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,W.ERROR,...e),this._logHandler(this,W.ERROR,...e)}};var w_=(n,e)=>e.some(t=>n instanceof t),ld,hd;function E_(){return ld||(ld=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function T_(){return hd||(hd=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var dd=new WeakMap,pa=new WeakMap,fd=new WeakMap,fa=new WeakMap,ga=new WeakMap;function A_(n){let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("success",s),n.removeEventListener("error",a)},s=()=>{t(et(n.result)),i()},a=()=>{r(n.error),i()};n.addEventListener("success",s),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&dd.set(t,n)}).catch(()=>{}),ga.set(e,n),e}function b_(n){if(pa.has(n))return;let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",a),n.removeEventListener("abort",a)},s=()=>{t(),i()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",s),n.addEventListener("error",a),n.addEventListener("abort",a)});pa.set(n,e)}var ma={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return pa.get(n);if(e==="objectStoreNames")return n.objectStoreNames||fd.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return et(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function pd(n){ma=n(ma)}function S_(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){let r=n.call(ts(this),e,...t);return fd.set(r,e.sort?e.sort():[e]),et(r)}:T_().includes(n)?function(...e){return n.apply(ts(this),e),et(dd.get(this))}:function(...e){return et(n.apply(ts(this),e))}}function R_(n){return typeof n=="function"?S_(n):(n instanceof IDBTransaction&&b_(n),w_(n,E_())?new Proxy(n,ma):n)}function et(n){if(n instanceof IDBRequest)return A_(n);if(fa.has(n))return fa.get(n);let e=R_(n);return e!==n&&(fa.set(n,e),ga.set(e,n)),e}var ts=n=>ga.get(n);function gd(n,e,{blocked:t,upgrade:r,blocking:i,terminated:s}={}){let a=indexedDB.open(n,e),c=et(a);return r&&a.addEventListener("upgradeneeded",l=>{r(et(a.result),l.oldVersion,l.newVersion,et(a.transaction),l)}),t&&a.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),c.then(l=>{s&&l.addEventListener("close",()=>s()),i&&l.addEventListener("versionchange",d=>i(d.oldVersion,d.newVersion,d))}).catch(()=>{}),c}var P_=["get","getKey","getAll","getAllKeys","count"],C_=["put","add","delete","clear"],_a=new Map;function md(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(_a.get(e))return _a.get(e);let t=e.replace(/FromIndex$/,""),r=e!==t,i=C_.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||P_.includes(t)))return;let s=function(a,...c){return m(this,null,function*(){let l=this.transaction(a,i?"readwrite":"readonly"),d=l.store;return r&&(d=d.index(c.shift())),(yield Promise.all([d[t](...c),i&&l.done]))[0]})};return _a.set(e,s),s}pd(n=>ea(je({},n),{get:(e,t,r)=>md(e,t)||n.get(e,t,r),has:(e,t)=>!!md(e,t)||n.has(e,t)}));var va=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(k_(t)){let r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}};function k_(n){let e=n.getComponent();return e?.type==="VERSION"}var Ia="@firebase/app",_d="0.13.2";var ft=new Ze("@firebase/app"),D_="@firebase/app-compat",N_="@firebase/analytics-compat",O_="@firebase/analytics",x_="@firebase/app-check-compat",V_="@firebase/app-check",L_="@firebase/auth",M_="@firebase/auth-compat",F_="@firebase/database",U_="@firebase/data-connect",q_="@firebase/database-compat",B_="@firebase/functions",$_="@firebase/functions-compat",j_="@firebase/installations",z_="@firebase/installations-compat",W_="@firebase/messaging",G_="@firebase/messaging-compat",K_="@firebase/performance",H_="@firebase/performance-compat",Q_="@firebase/remote-config",J_="@firebase/remote-config-compat",Y_="@firebase/storage",X_="@firebase/storage-compat",Z_="@firebase/firestore",ey="@firebase/ai",ty="@firebase/firestore-compat",ny="firebase",ry="11.10.0";var wa="[DEFAULT]",iy={[Ia]:"fire-core",[D_]:"fire-core-compat",[O_]:"fire-analytics",[N_]:"fire-analytics-compat",[V_]:"fire-app-check",[x_]:"fire-app-check-compat",[L_]:"fire-auth",[M_]:"fire-auth-compat",[F_]:"fire-rtdb",[U_]:"fire-data-connect",[q_]:"fire-rtdb-compat",[B_]:"fire-fn",[$_]:"fire-fn-compat",[j_]:"fire-iid",[z_]:"fire-iid-compat",[W_]:"fire-fcm",[G_]:"fire-fcm-compat",[K_]:"fire-perf",[H_]:"fire-perf-compat",[Q_]:"fire-rc",[J_]:"fire-rc-compat",[Y_]:"fire-gcs",[X_]:"fire-gcs-compat",[Z_]:"fire-fst",[ty]:"fire-fst-compat",[ey]:"fire-vertex","fire-js":"fire-js",[ny]:"fire-js-all"};var Ur=new Map,sy=new Map,Ea=new Map;function yd(n,e){try{n.container.addComponent(e)}catch(t){ft.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function We(n){let e=n.name;if(Ea.has(e))return ft.debug(`There were multiple attempts to register component ${e}.`),!1;Ea.set(e,n);for(let t of Ur.values())yd(t,n);for(let t of sy.values())yd(t,n);return!0}function Un(n,e){let t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function ke(n){return n==null?!1:n.settings!==void 0}var oy={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},xt=new ze("app","Firebase",oy);var Ta=class{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Pe("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw xt.create("app-deleted",{appName:this._name})}};var Vt=ry;function Sa(n,e={}){let t=n;typeof e!="object"&&(e={name:e});let r=Object.assign({name:wa,automaticDataCollectionEnabled:!0},e),i=r.name;if(typeof i!="string"||!i)throw xt.create("bad-app-name",{appName:String(i)});if(t||(t=la()),!t)throw xt.create("no-options");let s=Ur.get(i);if(s){if(Xe(t,s.options)&&Xe(r,s.config))return s;throw xt.create("duplicate-app",{appName:i})}let a=new es(i);for(let l of Ea.values())a.addComponent(l);let c=new Ta(t,r,a);return Ur.set(i,c),c}function an(n=wa){let e=Ur.get(n);if(!e&&n===wa&&la())return Sa();if(!e)throw xt.create("no-app",{appName:n});return e}function ns(){return Array.from(Ur.values())}function se(n,e,t){var r;let i=(r=iy[n])!==null&&r!==void 0?r:n;t&&(i+=`-${t}`);let s=i.match(/\s|\//),a=e.match(/\s|\//);if(s||a){let c=[`Unable to register library "${i}" with version "${e}":`];s&&c.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&a&&c.push("and"),a&&c.push(`version name "${e}" contains illegal characters (whitespace or "/")`),ft.warn(c.join(" "));return}We(new Pe(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}var ay="firebase-heartbeat-database",cy=1,qr="firebase-heartbeat-store",ya=null;function Ed(){return ya||(ya=gd(ay,cy,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(qr)}catch(t){console.warn(t)}}}}).catch(n=>{throw xt.create("idb-open",{originalErrorMessage:n.message})})),ya}function uy(n){return m(this,null,function*(){try{let t=(yield Ed()).transaction(qr),r=yield t.objectStore(qr).get(Td(n));return yield t.done,r}catch(e){if(e instanceof xe)ft.warn(e.message);else{let t=xt.create("idb-get",{originalErrorMessage:e?.message});ft.warn(t.message)}}})}function vd(n,e){return m(this,null,function*(){try{let r=(yield Ed()).transaction(qr,"readwrite");yield r.objectStore(qr).put(e,Td(n)),yield r.done}catch(t){if(t instanceof xe)ft.warn(t.message);else{let r=xt.create("idb-set",{originalErrorMessage:t?.message});ft.warn(r.message)}}})}function Td(n){return`${n.name}!${n.options.appId}`}var ly=1024,hy=30,Aa=class{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new ba(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}triggerHeartbeat(){return m(this,null,function*(){var e,t;try{let i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=Id();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(a=>a.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:i}),this._heartbeatsCache.heartbeats.length>hy){let a=fy(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){ft.warn(r)}})}getHeartbeatsHeader(){return m(this,null,function*(){var e;try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";let t=Id(),{heartbeatsToSend:r,unsentEntries:i}=dy(this._heartbeatsCache.heartbeats),s=Lr(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return ft.warn(t),""}})}};function Id(){return new Date().toISOString().substring(0,10)}function dy(n,e=ly){let t=[],r=n.slice();for(let i of n){let s=t.find(a=>a.agent===i.agent);if(s){if(s.dates.push(i.date),wd(t)>e){s.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),wd(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}var ba=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return m(this,null,function*(){return Mr()?ad().then(()=>!0).catch(()=>!1):!1})}read(){return m(this,null,function*(){if(yield this._canUseIndexedDBPromise){let t=yield uy(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(e){return m(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return vd(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return})}add(e){return m(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return vd(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return})}};function wd(n){return Lr(JSON.stringify({version:2,heartbeats:n})).length}function fy(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function py(n){We(new Pe("platform-logger",e=>new va(e),"PRIVATE")),We(new Pe("heartbeat",e=>new Aa(e),"PRIVATE")),se(Ia,_d,n),se(Ia,_d,"esm2017"),se("fire-js","")}py("");var my="firebase",gy="11.10.0";se(my,gy,"app");function Ad(n){n===void 0&&(n=Fe(Nt));let e=n.get(Hi);return t=>new Me(r=>{let i=e.add(),s=!1;function a(){s||(i(),s=!0)}let c=t.subscribe({next:l=>{r.next(l),a()},complete:()=>{r.complete(),a()},error:l=>{r.error(l),a()}});return c.add(()=>{r.unsubscribe(),a()}),c})}var Lt=new Wh("ANGULARFIRE2_VERSION");function Br(n,e,t){if(e){if(e.length===1)return e[0];let s=e.filter(a=>a.app===t);if(s.length===1)return s[0]}return t.container.getProvider(n).getImmediate({optional:!0})}var Bn=(n,e)=>{let t=e?[e]:ns(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(a=>{r.includes(a)||r.push(a)})}),r},qn=(function(n){return n[n.SILENT=0]="SILENT",n[n.WARN=1]="WARN",n[n.VERBOSE=2]="VERBOSE",n})(qn||{}),bd=ia()&&typeof Zone<"u"?qn.WARN:qn.SILENT;var rs=class{zone;delegate;constructor(e,t=zh){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,s=function(a){i?i.runGuarded(()=>{e.apply(this,[a])}):e.apply(this,[a])};return this.delegate.schedule(s,t,r)}},Mt=(()=>{class n{outsideAngular;insideAngular;constructor(){let t=Fe(Ye);this.outsideAngular=t.runOutsideAngular(()=>new rs(typeof Zone>"u"?void 0:Zone.current)),this.insideAngular=t.run(()=>new rs(typeof Zone>"u"?void 0:Zone.current,jh))}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Gi({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Sd=!1;function yy(n,e){!Sd&&(bd>qn.SILENT||ia())&&(Sd=!0,console.warn("Calling Firebase APIs outside of an Injection context may destabilize your application leading to subtle change-detection and hydration bugs. Find more at https://github.com/angular/angularfire/blob/main/docs/zones.md")),bd>=e&&console.warn(`Firebase API called outside injection context: ${n.name}`)}function vy(n){let e=Fe(Ye,{optional:!0});return e?e.runOutsideAngular(()=>n()):n()}function cn(n){let e=Fe(Ye,{optional:!0});return e?e.run(()=>n()):n()}var Iy=(n,e,t)=>(...r)=>(e&&setTimeout(e,0),Ki(t,()=>cn(()=>n.apply(void 0,r)))),te=(n,e,t)=>(t||=e?qn.WARN:qn.VERBOSE,function(){let r,i=arguments,s,a,c;try{s=Fe(Mt),a=Fe(Hi),c=Fe(Kh)}catch{return yy(n,t),n.apply(this,i)}for(let d=0;d<arguments.length;d++)typeof i[d]=="function"&&(e&&(r||=cn(()=>a.add())),i[d]=Iy(i[d],r,c));let l=vy(()=>n.apply(this,i));return e?l instanceof Me?l.pipe(ra(s.outsideAngular),na(s.insideAngular),Ad(c)):l instanceof Promise?cn(()=>{let d=a.add();return new Promise((p,_)=>{l.then(I=>Ki(c,()=>cn(()=>p(I))),I=>Ki(c,()=>cn(()=>_(I)))).finally(d)})}):typeof l=="function"&&r?function(){return setTimeout(r,0),l.apply(this,arguments)}:cn(()=>l):l instanceof Me?l.pipe(ra(s.outsideAngular),na(s.insideAngular)):cn(()=>l)});var pt=class{constructor(e){return e}},un=class{constructor(){return ns()}};function wy(n){return n&&n.length===1?n[0]:new pt(an())}var Ra=new Vn("angularfire2._apps"),Ey={provide:pt,useFactory:wy,deps:[[new Ue,Ra]]},Ty={provide:un,deps:[[new Ue,Ra]]};function Ay(n){return(e,t)=>{let r=t.get(Hh);se("angularfire",Lt.full,"core"),se("angularfire",Lt.full,"app"),se("angular",Gh.full,r.toString());let i=e.runOutsideAngular(()=>n(t));return new pt(i)}}function UA(n,...e){return Ln([Ey,Ty,{provide:Ra,useFactory:Ay(n),multi:!0,deps:[Ye,Nt,Mt,...e]}])}var qA=te(Sa,!0);var by=new Map,Sy={activated:!1,tokenObservers:[]},Ry={initialized:!1,enabled:!1};function Ge(n){return by.get(n)||Object.assign({},Sy)}function kd(){return Ry}var Py="https://content-firebaseappcheck.googleapis.com/v1";var Cy="exchangeDebugToken",Rd={OFFSET_DURATION:300*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:960*1e3},QA=1440*60*1e3;var ka=class{constructor(e,t,r,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return m(this,null,function*(){this.stop();try{this.pending=new sn,this.pending.promise.catch(t=>{}),yield ky(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new sn,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function ky(n){return new Promise(e=>{setTimeout(e,n)})}var Dy={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.","initial-throttle":"{$httpStatus} error. Attempts allowed again after {$time}",throttled:"Requests throttled due to previous {$httpStatus} error. Attempts allowed again after {$time}"},Ft=new ze("appCheck","AppCheck",Dy);function Dd(n){if(!Ge(n).activated)throw Ft.create("use-before-activation",{appName:n.name})}function Nd(r,i){return m(this,arguments,function*({url:n,body:e},t){let s={"Content-Type":"application/json"},a=t.getImmediate({optional:!0});if(a){let R=yield a.getHeartbeatsHeader();R&&(s["X-Firebase-Client"]=R)}let c={method:"POST",body:JSON.stringify(e),headers:s},l;try{l=yield fetch(n,c)}catch(R){throw Ft.create("fetch-network-error",{originalErrorMessage:R?.message})}if(l.status!==200)throw Ft.create("fetch-status-error",{httpStatus:l.status});let d;try{d=yield l.json()}catch(R){throw Ft.create("fetch-parse-error",{originalErrorMessage:R?.message})}let p=d.ttl.match(/^([\d.]+)(s)$/);if(!p||!p[2]||isNaN(Number(p[1])))throw Ft.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${d.ttl}`});let _=Number(p[1])*1e3,I=Date.now();return{token:d.token,expireTimeMillis:I+_,issuedAtTimeMillis:I}})}function Od(n,e){let{projectId:t,appId:r,apiKey:i}=n.options;return{url:`${Py}/projects/${t}/apps/${r}:${Cy}?key=${i}`,body:{debug_token:e}}}var Ny="firebase-app-check-database",Oy=1,Da="firebase-app-check-store";var is=null;function xy(){return is||(is=new Promise((n,e)=>{try{let t=indexedDB.open(Ny,Oy);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var i;e(Ft.create("storage-open",{originalErrorMessage:(i=r.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=r=>{let i=r.target.result;switch(r.oldVersion){case 0:i.createObjectStore(Da,{keyPath:"compositeKey"})}}}catch(t){e(Ft.create("storage-open",{originalErrorMessage:t?.message}))}}),is)}function Vy(n,e){return Ly(My(n),e)}function Ly(n,e){return m(this,null,function*(){let r=(yield xy()).transaction(Da,"readwrite"),s=r.objectStore(Da).put({compositeKey:n,value:e});return new Promise((a,c)=>{s.onsuccess=l=>{a()},r.onerror=l=>{var d;c(Ft.create("storage-set",{originalErrorMessage:(d=l.target.error)===null||d===void 0?void 0:d.message}))}})})}function My(n){return`${n.options.appId}-${n.name}`}var $r=new Ze("@firebase/app-check");function Pa(n,e){return Mr()?Vy(n,e).catch(t=>{$r.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function xd(){return kd().enabled}function Vd(){return m(this,null,function*(){let n=kd();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var Fy={error:"UNKNOWN_ERROR"};function Uy(n){return Qi.encodeString(JSON.stringify(n),!1)}function Na(n,e=!1,t=!1){return m(this,null,function*(){let r=n.app;Dd(r);let i=Ge(r),s=i.token,a;if(s&&!jr(s)&&(i.token=void 0,s=void 0),!s){let d=yield i.cachedTokenPromise;d&&(jr(d)?s=d:yield Pa(r,void 0))}if(!e&&s&&jr(s))return{token:s.token};let c=!1;if(xd())try{i.exchangeTokenPromise||(i.exchangeTokenPromise=Nd(Od(r,yield Vd()),n.heartbeatServiceProvider).finally(()=>{i.exchangeTokenPromise=void 0}),c=!0);let d=yield i.exchangeTokenPromise;return yield Pa(r,d),i.token=d,{token:d.token}}catch(d){return d.code==="appCheck/throttled"||d.code==="appCheck/initial-throttle"?$r.warn(d.message):t&&$r.error(d),Ca(d)}try{i.exchangeTokenPromise||(i.exchangeTokenPromise=i.provider.getToken().finally(()=>{i.exchangeTokenPromise=void 0}),c=!0),s=yield Ge(r).exchangeTokenPromise}catch(d){d.code==="appCheck/throttled"||d.code==="appCheck/initial-throttle"?$r.warn(d.message):t&&$r.error(d),a=d}let l;return s?a?jr(s)?l={token:s.token,internalError:a}:l=Ca(a):(l={token:s.token},i.token=s,yield Pa(r,s)):l=Ca(a),c&&jy(r,l),l})}function qy(n){return m(this,null,function*(){let e=n.app;Dd(e);let{provider:t}=Ge(e);if(xd()){let r=yield Vd(),{token:i}=yield Nd(Od(e,r),n.heartbeatServiceProvider);return{token:i}}else{let{token:r}=yield t.getToken();return{token:r}}})}function By(n,e,t,r){let{app:i}=n,s=Ge(i),a={next:t,error:r,type:e};if(s.tokenObservers=[...s.tokenObservers,a],s.token&&jr(s.token)){let c=s.token;Promise.resolve().then(()=>{t({token:c.token}),Pd(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>Pd(n))}function Ld(n,e){let t=Ge(n),r=t.tokenObservers.filter(i=>i.next!==e);r.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function Pd(n){let{app:e}=n,t=Ge(e),r=t.tokenRefresher;r||(r=$y(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function $y(n){let{app:e}=n;return new ka(()=>m(null,null,function*(){let t=Ge(e),r;if(t.token?r=yield Na(n,!0):r=yield Na(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{let t=Ge(e);if(t.token){let r=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-300*1e3;return r=Math.min(r,i),Math.max(0,r-Date.now())}else return 0},Rd.RETRIAL_MIN_WAIT,Rd.RETRIAL_MAX_WAIT)}function jy(n,e){let t=Ge(n).tokenObservers;for(let r of t)try{r.type==="EXTERNAL"&&e.error!=null?r.error(e.error):r.next(e)}catch{}}function jr(n){return n.expireTimeMillis-Date.now()>0}function Ca(n){return{token:Uy(Fy),error:n}}var Oa=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=Ge(this.app);for(let t of e)Ld(this.app,t.next);return Promise.resolve()}};function zy(n,e){return new Oa(n,e)}function Wy(n){return{getToken:e=>Na(n,e),getLimitedUseToken:()=>qy(n),addTokenListener:e=>By(n,"INTERNAL",e),removeTokenListener:e=>Ld(n.app,e)}}var Gy="@firebase/app-check",Ky="0.10.1";var Hy="app-check",Cd="app-check-internal";function Qy(){We(new Pe(Hy,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return zy(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(Cd).initialize()})),We(new Pe(Cd,n=>{let e=n.getProvider("app-check").getImmediate();return Wy(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),se(Gy,Ky)}Qy();var Jy="app-check";var $n=class{constructor(){return Bn(Jy)}};var Yy=["localhost","0.0.0.0","127.0.0.1"],cb=typeof window<"u"&&Yy.includes(window.location.hostname);function Xd(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}var Zd=Xd,ef=new ze("auth","Firebase",Xd());var ls=new Ze("@firebase/auth");function Xy(n,...e){ls.logLevel<=W.WARN&&ls.warn(`Auth (${Vt}): ${n}`,...e)}function os(n,...e){ls.logLevel<=W.ERROR&&ls.error(`Auth (${Vt}): ${n}`,...e)}function nt(n,...e){throw ic(n,...e)}function ln(n,...e){return ic(n,...e)}function tf(n,e,t){let r=Object.assign(Object.assign({},Zd()),{[e]:t});return new ze("auth","Firebase",r).create(e,{appName:n.name})}function _t(n){return tf(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function ic(n,...e){if(typeof n!="string"){let t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return ef.create(n,...e)}function F(n,e,...t){if(!n)throw ic(e,...t)}function mt(n){let e="INTERNAL ASSERTION FAILED: "+n;throw os(e),new Error(e)}function Bt(n,e){n||mt(e)}function Ma(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function Zy(){return Md()==="http:"||Md()==="https:"}function Md(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}function ev(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Zy()||rd()||"connection"in navigator)?navigator.onLine:!0}function tv(){if(typeof navigator>"u")return null;let n=navigator;return n.languages&&n.languages[0]||n.language||null}var hn=class{constructor(e,t){this.shortDelay=e,this.longDelay=t,Bt(t>e,"Short delay should be less than long delay!"),this.isMobile=td()||id()}get(){return ev()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};function sc(n,e){Bt(n.emulator,"Emulator should always be set here");let{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}var hs=class{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;mt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;mt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;mt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}};var nv={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};var rv=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],iv=new hn(3e4,6e4);function $t(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}function jt(s,a,c,l){return m(this,arguments,function*(n,e,t,r,i={}){return nf(n,i,()=>m(null,null,function*(){let d={},p={};r&&(e==="GET"?p=r:d={body:JSON.stringify(r)});let _=Fr(Object.assign({key:n.config.apiKey},p)).slice(1),I=yield n._getAdditionalHeaders();I["Content-Type"]="application/json",n.languageCode&&(I["X-Firebase-Locale"]=n.languageCode);let R=Object.assign({method:e,headers:I},d);return nd()||(R.referrerPolicy="no-referrer"),n.emulatorConfig&&Ot(n.emulatorConfig.host)&&(R.credentials="include"),hs.fetch()(yield rf(n,n.config.apiHost,t,_),R)}))})}function nf(n,e,t){return m(this,null,function*(){n._canInitEmulator=!1;let r=Object.assign(Object.assign({},nv),e);try{let i=new Fa(n),s=yield Promise.race([t(),i.promise]);i.clearNetworkTimeout();let a=yield s.json();if("needConfirmation"in a)throw ss(n,"account-exists-with-different-credential",a);if(s.ok&&!("errorMessage"in a))return a;{let c=s.ok?a.errorMessage:a.error.message,[l,d]=c.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw ss(n,"credential-already-in-use",a);if(l==="EMAIL_EXISTS")throw ss(n,"email-already-in-use",a);if(l==="USER_DISABLED")throw ss(n,"user-disabled",a);let p=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw tf(n,p,d);nt(n,p)}}catch(i){if(i instanceof xe)throw i;nt(n,"network-request-failed",{message:String(i)})}})}function Xr(s,a,c,l){return m(this,arguments,function*(n,e,t,r,i={}){let d=yield jt(n,e,t,r,i);return"mfaPendingCredential"in d&&nt(n,"multi-factor-auth-required",{_serverResponse:d}),d})}function rf(n,e,t,r){return m(this,null,function*(){let i=`${e}${t}?${r}`,s=n,a=s.config.emulator?sc(n.config,i):`${n.config.apiScheme}://${i}`;return rv.includes(t)&&(yield s._persistenceManagerAvailable,s._getPersistenceType()==="COOKIE")?s._getPersistence()._getFinalTarget(a).toString():a})}function sv(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}var Fa=class{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(ln(this.auth,"network-request-failed")),iv.get())})}};function ss(n,e,t){let r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);let i=ln(n,e,r);return i.customData._tokenResponse=t,i}function Fd(n){return n!==void 0&&n.enterprise!==void 0}var Ua=class{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return sv(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}};function ov(n,e){return m(this,null,function*(){return jt(n,"GET","/v2/recaptchaConfig",$t(n,e))})}function av(n,e){return m(this,null,function*(){return jt(n,"POST","/v1/accounts:delete",e)})}function ds(n,e){return m(this,null,function*(){return jt(n,"POST","/v1/accounts:lookup",e)})}function Wr(n){if(n)try{let e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}function oc(n,e=!1){return m(this,null,function*(){let t=ce(n),r=yield t.getIdToken(e),i=ac(r);F(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");let s=typeof i.firebase=="object"?i.firebase:void 0,a=s?.sign_in_provider;return{claims:i,token:r,authTime:Wr(xa(i.auth_time)),issuedAtTime:Wr(xa(i.iat)),expirationTime:Wr(xa(i.exp)),signInProvider:a||null,signInSecondFactor:s?.sign_in_second_factor||null}})}function xa(n){return Number(n)*1e3}function ac(n){let[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return os("JWT malformed, contained fewer than 3 sections"),null;try{let i=Ji(t);return i?JSON.parse(i):(os("Failed to decode base64 JWT payload"),null)}catch(i){return os("Caught error parsing JWT payload as JSON",i?.toString()),null}}function Ud(n){let e=ac(n);return F(e,"internal-error"),F(typeof e.exp<"u","internal-error"),F(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}function Kr(n,e,t=!1){return m(this,null,function*(){if(t)return e;try{return yield e}catch(r){throw r instanceof xe&&cv(r)&&n.auth.currentUser===n&&(yield n.auth.signOut()),r}})}function cv({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}var qa=class{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){let r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;let i=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(()=>m(this,null,function*(){yield this.iteration()}),t)}iteration(){return m(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()})}};var Hr=class{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Wr(this.lastLoginAt),this.creationTime=Wr(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};function fs(n){return m(this,null,function*(){var e;let t=n.auth,r=yield n.getIdToken(),i=yield Kr(n,ds(t,{idToken:r}));F(i?.users.length,t,"internal-error");let s=i.users[0];n._notifyReloadListener(s);let a=!((e=s.providerUserInfo)===null||e===void 0)&&e.length?sf(s.providerUserInfo):[],c=uv(n.providerData,a),l=n.isAnonymous,d=!(n.email&&s.passwordHash)&&!c?.length,p=l?d:!1,_={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:c,metadata:new Hr(s.createdAt,s.lastLoginAt),isAnonymous:p};Object.assign(n,_)})}function cc(n){return m(this,null,function*(){let e=ce(n);yield fs(e),yield e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)})}function uv(n,e){return[...n.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function sf(n){return n.map(e=>{var{providerId:t}=e,r=ta(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}function lv(n,e){return m(this,null,function*(){let t=yield nf(n,{},()=>m(null,null,function*(){let r=Fr({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=n.config,a=yield rf(n,i,"/v1/token",`key=${s}`),c=yield n._getAdditionalHeaders();c["Content-Type"]="application/x-www-form-urlencoded";let l={method:"POST",headers:c,body:r};return n.emulatorConfig&&Ot(n.emulatorConfig.host)&&(l.credentials="include"),hs.fetch()(a,l)}));return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}})}function hv(n,e){return m(this,null,function*(){return jt(n,"POST","/v2/accounts:revokeToken",$t(n,e))})}var Gr=class n{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){F(e.idToken,"internal-error"),F(typeof e.idToken<"u","internal-error"),F(typeof e.refreshToken<"u","internal-error");let t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Ud(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){F(e.length!==0,"internal-error");let t=Ud(e);this.updateTokensAndExpiration(e,null,t)}getToken(e,t=!1){return m(this,null,function*(){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(F(this.refreshToken,e,"user-token-expired"),this.refreshToken?(yield this.refresh(e,this.refreshToken),this.accessToken):null)})}clearRefreshToken(){this.refreshToken=null}refresh(e,t){return m(this,null,function*(){let{accessToken:r,refreshToken:i,expiresIn:s}=yield lv(e,t);this.updateTokensAndExpiration(r,i,Number(s))})}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){let{refreshToken:r,accessToken:i,expirationTime:s}=t,a=new n;return r&&(F(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),i&&(F(typeof i=="string","internal-error",{appName:e}),a.accessToken=i),s&&(F(typeof s=="number","internal-error",{appName:e}),a.expirationTime=s),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new n,this.toJSON())}_performRefresh(){return mt("not implemented")}};function Ut(n,e){F(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}var qt=class n{constructor(e){var{uid:t,auth:r,stsTokenManager:i}=e,s=ta(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new qa(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Hr(s.createdAt||void 0,s.lastLoginAt||void 0)}getIdToken(e){return m(this,null,function*(){let t=yield Kr(this,this.stsTokenManager.getToken(this.auth,e));return F(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t})}getIdTokenResult(e){return oc(this,e)}reload(){return cc(this)}_assign(e){this!==e&&(F(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new n(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){F(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){return m(this,null,function*(){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&(yield fs(this)),yield this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)})}delete(){return m(this,null,function*(){if(ke(this.auth.app))return Promise.reject(_t(this.auth));let e=yield this.getIdToken();return yield Kr(this,av(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,i,s,a,c,l,d,p;let _=(r=t.displayName)!==null&&r!==void 0?r:void 0,I=(i=t.email)!==null&&i!==void 0?i:void 0,R=(s=t.phoneNumber)!==null&&s!==void 0?s:void 0,k=(a=t.photoURL)!==null&&a!==void 0?a:void 0,x=(c=t.tenantId)!==null&&c!==void 0?c:void 0,D=(l=t._redirectEventId)!==null&&l!==void 0?l:void 0,$=(d=t.createdAt)!==null&&d!==void 0?d:void 0,U=(p=t.lastLoginAt)!==null&&p!==void 0?p:void 0,{uid:j,emailVerified:X,isAnonymous:be,providerData:Y,stsTokenManager:E}=t;F(j&&E,e,"internal-error");let g=Gr.fromJSON(this.name,E);F(typeof j=="string",e,"internal-error"),Ut(_,e.name),Ut(I,e.name),F(typeof X=="boolean",e,"internal-error"),F(typeof be=="boolean",e,"internal-error"),Ut(R,e.name),Ut(k,e.name),Ut(x,e.name),Ut(D,e.name),Ut($,e.name),Ut(U,e.name);let v=new n({uid:j,auth:e,email:I,emailVerified:X,displayName:_,isAnonymous:be,photoURL:k,phoneNumber:R,tenantId:x,stsTokenManager:g,createdAt:$,lastLoginAt:U});return Y&&Array.isArray(Y)&&(v.providerData=Y.map(w=>Object.assign({},w))),D&&(v._redirectEventId=D),v}static _fromIdTokenResponse(e,t,r=!1){return m(this,null,function*(){let i=new Gr;i.updateFromServerResponse(t);let s=new n({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:r});return yield fs(s),s})}static _fromGetAccountInfoResponse(e,t,r){return m(this,null,function*(){let i=t.users[0];F(i.localId!==void 0,"internal-error");let s=i.providerUserInfo!==void 0?sf(i.providerUserInfo):[],a=!(i.email&&i.passwordHash)&&!s?.length,c=new Gr;c.updateFromIdToken(r);let l=new n({uid:i.localId,auth:e,stsTokenManager:c,isAnonymous:a}),d={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:s,metadata:new Hr(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!s?.length};return Object.assign(l,d),l})}};var qd=new Map;function gt(n){Bt(n instanceof Function,"Expected a class definition");let e=qd.get(n);return e?(Bt(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,qd.set(n,e),e)}var dv=(()=>{class n{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return m(this,null,function*(){return!0})}_set(t,r){return m(this,null,function*(){this.storage[t]=r})}_get(t){return m(this,null,function*(){let r=this.storage[t];return r===void 0?null:r})}_remove(t){return m(this,null,function*(){delete this.storage[t]})}_addListener(t,r){}_removeListener(t,r){}}return n.type="NONE",n})(),Ba=dv;function as(n,e,t){return`firebase:${n}:${e}:${t}`}var ps=class n{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;let{config:i,name:s}=this.auth;this.fullUserKey=as(this.userKey,i.apiKey,s),this.fullPersistenceKey=as("persistence",i.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){return m(this,null,function*(){let e=yield this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){let t=yield ds(this.auth,{idToken:e}).catch(()=>{});return t?qt._fromGetAccountInfoResponse(this.auth,t,e):null}return qt._fromJSON(this.auth,e)})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){return m(this,null,function*(){if(this.persistence===e)return;let t=yield this.getCurrentUser();if(yield this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,r="authUser"){return m(this,null,function*(){if(!t.length)return new n(gt(Ba),e,r);let i=(yield Promise.all(t.map(d=>m(null,null,function*(){if(yield d._isAvailable())return d})))).filter(d=>d),s=i[0]||gt(Ba),a=as(r,e.config.apiKey,e.name),c=null;for(let d of t)try{let p=yield d._get(a);if(p){let _;if(typeof p=="string"){let I=yield ds(e,{idToken:p}).catch(()=>{});if(!I)break;_=yield qt._fromGetAccountInfoResponse(e,I,p)}else _=qt._fromJSON(e,p);d!==s&&(c=_),s=d;break}}catch{}let l=i.filter(d=>d._shouldAllowMigration);return!s._shouldAllowMigration||!l.length?new n(s,e,r):(s=l[0],c&&(yield s._set(a,c.toJSON())),yield Promise.all(t.map(d=>m(null,null,function*(){if(d!==s)try{yield d._remove(a)}catch{}}))),new n(s,e,r))})}};function Bd(n){let e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(uf(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(of(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(hf(e))return"Blackberry";if(df(e))return"Webos";if(af(e))return"Safari";if((e.includes("chrome/")||cf(e))&&!e.includes("edge/"))return"Chrome";if(lf(e))return"Android";{let t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function of(n=me()){return/firefox\//i.test(n)}function af(n=me()){let e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function cf(n=me()){return/crios\//i.test(n)}function uf(n=me()){return/iemobile/i.test(n)}function lf(n=me()){return/android/i.test(n)}function hf(n=me()){return/blackberry/i.test(n)}function df(n=me()){return/webos/i.test(n)}function uc(n=me()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function fv(n=me()){var e;return uc(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function pv(){return sd()&&document.documentMode===10}function ff(n=me()){return uc(n)||lf(n)||df(n)||hf(n)||/windows phone/i.test(n)||uf(n)}function pf(n,e=[]){let t;switch(n){case"Browser":t=Bd(me());break;case"Worker":t=`${Bd(me())}-${n}`;break;default:t=n}let r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Vt}/${r}`}var $a=class{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let r=s=>new Promise((a,c)=>{try{let l=e(s);a(l)}catch(l){c(l)}});r.onAbort=t,this.queue.push(r);let i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}runMiddleware(e){return m(this,null,function*(){if(this.auth.currentUser===e)return;let t=[];try{for(let r of this.queue)yield r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(let i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}})}};function mv(t){return m(this,arguments,function*(n,e={}){return jt(n,"GET","/v2/passwordPolicy",$t(n,e))})}var gv=6,ja=class{constructor(e){var t,r,i,s;let a=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=a.minPasswordLength)!==null&&t!==void 0?t:gv,a.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=a.maxPasswordLength),a.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=a.containsLowercaseCharacter),a.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=a.containsUppercaseCharacter),a.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=a.containsNumericCharacter),a.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=a.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(s=e.forceUpgradeOnSignin)!==null&&s!==void 0?s:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,i,s,a,c;let l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,l),this.validatePasswordCharacterOptions(e,l),l.isValid&&(l.isValid=(t=l.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),l.isValid&&(l.isValid=(r=l.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(i=l.containsLowercaseLetter)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(s=l.containsUppercaseLetter)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(a=l.containsNumericCharacter)!==null&&a!==void 0?a:!0),l.isValid&&(l.isValid=(c=l.containsNonAlphanumericCharacter)!==null&&c!==void 0?c:!0),l}validatePasswordLengthOptions(e,t){let r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}};var za=class{constructor(e,t,r,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ms(this),this.idTokenSubscription=new ms(this),this.beforeStateQueue=new $a(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ef,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(s=>this._resolvePersistenceManagerAvailable=s)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=gt(t)),this._initializationPromise=this.queue(()=>m(this,null,function*(){var r,i,s;if(!this._deleted&&(this.persistenceManager=yield ps.create(this,e),(r=this._resolvePersistenceManagerAvailable)===null||r===void 0||r.call(this),!this._deleted)){if(!((i=this._popupRedirectResolver)===null||i===void 0)&&i._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch{}yield this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return m(this,null,function*(){if(this._deleted)return;let e=yield this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),yield this.currentUser.getIdToken();return}yield this._updateCurrentUser(e,!0)}})}initializeCurrentUserFromIdToken(e){return m(this,null,function*(){try{let t=yield ds(this,{idToken:e}),r=yield qt._fromGetAccountInfoResponse(this,t,e);yield this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(e){return m(this,null,function*(){var t;if(ke(this.app)){let a=this.app.settings.authIdToken;return a?new Promise(c=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(c,c))}):this.directlySetCurrentUser(null)}let r=yield this.assertedPersistence.getCurrentUser(),i=r,s=!1;if(e&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();let a=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,c=i?._redirectEventId,l=yield this.tryRedirectSignIn(e);(!a||a===c)&&l?.user&&(i=l.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{yield this.beforeStateQueue.runMiddleware(i)}catch(a){i=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return F(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)})}tryRedirectSignIn(e){return m(this,null,function*(){let t=null;try{t=yield this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{yield this._setRedirectUser(null)}return t})}reloadAndSetCurrentUserOrClear(e){return m(this,null,function*(){try{yield fs(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)})}useDeviceLanguage(){this.languageCode=tv()}_delete(){return m(this,null,function*(){this._deleted=!0})}updateCurrentUser(e){return m(this,null,function*(){if(ke(this.app))return Promise.reject(_t(this));let t=e?ce(e):null;return t&&F(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))})}_updateCurrentUser(e,t=!1){return m(this,null,function*(){if(!this._deleted)return e&&F(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||(yield this.beforeStateQueue.runMiddleware(e)),this.queue(()=>m(this,null,function*(){yield this.directlySetCurrentUser(e),this.notifyAuthListeners()}))})}signOut(){return m(this,null,function*(){return ke(this.app)?Promise.reject(_t(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(e){return ke(this.app)?Promise.reject(_t(this)):this.queue(()=>m(this,null,function*(){yield this.assertedPersistence.setPersistence(gt(e))}))}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(e){return m(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)})}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return m(this,null,function*(){let e=yield mv(this),t=new ja(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t})}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new ze("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let r=this.onAuthStateChanged(()=>{r(),e()},t)}})}revokeAccessToken(e){return m(this,null,function*(){if(this.currentUser){let t=yield this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),yield hv(this,r)}})}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}_setRedirectUser(e,t){return m(this,null,function*(){let r=yield this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)})}getOrInitRedirectPersistenceManager(e){return m(this,null,function*(){if(!this.redirectPersistenceManager){let t=e&&gt(e)||this._popupRedirectResolver;F(t,this,"argument-error"),this.redirectPersistenceManager=yield ps.create(this,[gt(t._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(e){return m(this,null,function*(){var t,r;return this._isInitialized&&(yield this.queue(()=>m(this,null,function*(){}))),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null})}_persistUserIfCurrent(e){return m(this,null,function*(){if(e===this.currentUser)return this.queue(()=>m(this,null,function*(){return this.directlySetCurrentUser(e)}))})}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,i){if(this._deleted)return()=>{};let s=typeof t=="function"?t:t.next.bind(t),a=!1,c=this._isInitialized?Promise.resolve():this._initializationPromise;if(F(c,this,"internal-error"),c.then(()=>{a||s(this.currentUser)}),typeof t=="function"){let l=e.addObserver(t,r,i);return()=>{a=!0,l()}}else{let l=e.addObserver(t);return()=>{a=!0,l()}}}directlySetCurrentUser(e){return m(this,null,function*(){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?yield this.assertedPersistence.setCurrentUser(e):yield this.assertedPersistence.removeCurrentUser()})}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return F(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=pf(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return m(this,null,function*(){var e;let t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);let r=yield(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader();r&&(t["X-Firebase-Client"]=r);let i=yield this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t})}_getAppCheckToken(){return m(this,null,function*(){var e;if(ke(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let t=yield(e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken();return t?.error&&Xy(`Error while retrieving App Check token: ${t.error}`),t?.token})}};function fn(n){return ce(n)}var ms=class{constructor(e){this.auth=e,this.observer=null,this.addObserver=ud(t=>this.observer=t)}get next(){return F(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};var Es={loadJS(){return m(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function _v(n){Es=n}function mf(n){return Es.loadJS(n)}function yv(){return Es.recaptchaEnterpriseScript}function vv(){return Es.gapiScript}function gf(n){return`__${n}${Math.floor(Math.random()*1e6)}`}var Wa=class{constructor(){this.enterprise=new Ga}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}},Ga=class{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}};var Iv="recaptcha-enterprise",_f="NO_RECAPTCHA",Ka=class{constructor(e){this.type=Iv,this.auth=fn(e)}verify(e="verify",t=!1){return m(this,null,function*(){function r(s){return m(this,null,function*(){if(!t){if(s.tenantId==null&&s._agentRecaptchaConfig!=null)return s._agentRecaptchaConfig.siteKey;if(s.tenantId!=null&&s._tenantRecaptchaConfigs[s.tenantId]!==void 0)return s._tenantRecaptchaConfigs[s.tenantId].siteKey}return new Promise((a,c)=>m(null,null,function*(){ov(s,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)c(new Error("recaptcha Enterprise site key undefined"));else{let d=new Ua(l);return s.tenantId==null?s._agentRecaptchaConfig=d:s._tenantRecaptchaConfigs[s.tenantId]=d,a(d.siteKey)}}).catch(l=>{c(l)})}))})}function i(s,a,c){let l=window.grecaptcha;Fd(l)?l.enterprise.ready(()=>{l.enterprise.execute(s,{action:e}).then(d=>{a(d)}).catch(()=>{a(_f)})}):c(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new Wa().execute("siteKey",{action:"verify"}):new Promise((s,a)=>{r(this.auth).then(c=>{if(!t&&Fd(window.grecaptcha))i(c,s,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let l=yv();l.length!==0&&(l+=c),mf(l).then(()=>{i(c,s,a)}).catch(d=>{a(d)})}}).catch(c=>{a(c)})})})}};function zr(n,e,t,r=!1,i=!1){return m(this,null,function*(){let s=new Ka(n),a;if(i)a=_f;else try{a=yield s.verify(t)}catch{a=yield s.verify(t,!0)}let c=Object.assign({},e);if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in c){let l=c.phoneEnrollmentInfo.phoneNumber,d=c.phoneEnrollmentInfo.recaptchaToken;Object.assign(c,{phoneEnrollmentInfo:{phoneNumber:l,recaptchaToken:d,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in c){let l=c.phoneSignInInfo.recaptchaToken;Object.assign(c,{phoneSignInInfo:{recaptchaToken:l,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return c}return r?Object.assign(c,{captchaResp:a}):Object.assign(c,{captchaResponse:a}),Object.assign(c,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(c,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),c})}function Ha(n,e,t,r,i){return m(this,null,function*(){var s,a;if(i==="EMAIL_PASSWORD_PROVIDER")if(!((s=n._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){let c=yield zr(n,e,t,t==="getOobCode");return r(n,c)}else return r(n,e).catch(c=>m(null,null,function*(){if(c.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let l=yield zr(n,e,t,t==="getOobCode");return r(n,l)}else return Promise.reject(c)}));else if(i==="PHONE_PROVIDER")if(!((a=n._getRecaptchaConfig())===null||a===void 0)&&a.isProviderEnabled("PHONE_PROVIDER")){let c=yield zr(n,e,t);return r(n,c).catch(l=>m(null,null,function*(){var d;if(((d=n._getRecaptchaConfig())===null||d===void 0?void 0:d.getProviderEnforcementState("PHONE_PROVIDER"))==="AUDIT"&&(l.code==="auth/missing-recaptcha-token"||l.code==="auth/invalid-app-credential")){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${t} flow.`);let p=yield zr(n,e,t,!1,!0);return r(n,p)}return Promise.reject(l)}))}else{let c=yield zr(n,e,t,!1,!0);return r(n,c)}else return Promise.reject(i+" provider is not supported.")})}function lc(n,e){let t=Un(n,"auth");if(t.isInitialized()){let i=t.getImmediate(),s=t.getOptions();if(Xe(s,e??{}))return i;nt(i,"already-initialized")}return t.initialize({options:e})}function wv(n,e){let t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(gt);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function hc(n,e,t){let r=fn(n);F(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");let i=!!t?.disableWarnings,s=yf(e),{host:a,port:c}=Ev(e),l=c===null?"":`:${c}`,d={url:`${s}//${a}${l}/`},p=Object.freeze({host:a,port:c,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){F(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),F(Xe(d,r.config.emulator)&&Xe(p,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=d,r.emulatorConfig=p,r.settings.appVerificationDisabledForTesting=!0,Ot(a)?(Xi(`${s}//${a}${l}`),Zi("Auth",!0)):i||Tv()}function yf(n){let e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function Ev(n){let e=yf(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};let r=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){let s=i[1];return{host:s,port:$d(r.substr(s.length+1))}}else{let[s,a]=r.split(":");return{host:s,port:$d(a)}}}function $d(n){if(!n)return null;let e=Number(n);return isNaN(e)?null:e}function Tv(){function n(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}var Qr=class{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return mt("not implemented")}_getIdTokenResponse(e){return mt("not implemented")}_linkToIdToken(e,t){return mt("not implemented")}_getReauthenticationResolver(e){return mt("not implemented")}};function Av(n,e){return m(this,null,function*(){return jt(n,"POST","/v1/accounts:signUp",e)})}function bv(n,e){return m(this,null,function*(){return Xr(n,"POST","/v1/accounts:signInWithPassword",$t(n,e))})}function Sv(n,e){return m(this,null,function*(){return Xr(n,"POST","/v1/accounts:signInWithEmailLink",$t(n,e))})}function Rv(n,e){return m(this,null,function*(){return Xr(n,"POST","/v1/accounts:signInWithEmailLink",$t(n,e))})}var Jr=class n extends Qr{constructor(e,t,r,i=null){super("password",r),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new n(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new n(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t=typeof e=="string"?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}_getIdTokenResponse(e){return m(this,null,function*(){switch(this.signInMethod){case"password":let t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Ha(e,t,"signInWithPassword",bv,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return Sv(e,{email:this._email,oobCode:this._password});default:nt(e,"internal-error")}})}_linkToIdToken(e,t){return m(this,null,function*(){switch(this.signInMethod){case"password":let r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Ha(e,r,"signUpPassword",Av,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return Rv(e,{idToken:t,email:this._email,oobCode:this._password});default:nt(e,"internal-error")}})}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}};function Va(n,e){return m(this,null,function*(){return Xr(n,"POST","/v1/accounts:signInWithIdp",$t(n,e))})}function Pv(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Cv(n){let e=Mn(Fn(n)).link,t=e?Mn(Fn(e)).deep_link_id:null,r=Mn(Fn(n)).deep_link_id;return(r?Mn(Fn(r)).link:null)||r||t||e||n}var gs=class n{constructor(e){var t,r,i,s,a,c;let l=Mn(Fn(e)),d=(t=l.apiKey)!==null&&t!==void 0?t:null,p=(r=l.oobCode)!==null&&r!==void 0?r:null,_=Pv((i=l.mode)!==null&&i!==void 0?i:null);F(d&&p&&_,"argument-error"),this.apiKey=d,this.operation=_,this.code=p,this.continueUrl=(s=l.continueUrl)!==null&&s!==void 0?s:null,this.languageCode=(a=l.lang)!==null&&a!==void 0?a:null,this.tenantId=(c=l.tenantId)!==null&&c!==void 0?c:null}static parseLink(e){let t=Cv(e);try{return new n(t)}catch{return null}}};var vf=(()=>{class n{constructor(){this.providerId=n.PROVIDER_ID}static credential(t,r){return Jr._fromEmailAndPassword(t,r)}static credentialWithLink(t,r){let i=gs.parseLink(r);return F(i,"argument-error"),Jr._fromEmailAndCode(t,i.code,i.tenantId)}}n.PROVIDER_ID="password",n.EMAIL_PASSWORD_SIGN_IN_METHOD="password",n.EMAIL_LINK_SIGN_IN_METHOD="emailLink";return n})(),_s=class{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}};var Qa=class extends _s{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}};function kv(n,e){return m(this,null,function*(){return Xr(n,"POST","/v1/accounts:signUp",$t(n,e))})}var jn=class n{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static _fromIdTokenResponse(e,t,r,i=!1){return m(this,null,function*(){let s=yield qt._fromIdTokenResponse(e,r,i),a=jd(r);return new n({user:s,providerId:a,_tokenResponse:r,operationType:t})})}static _forOperation(e,t,r){return m(this,null,function*(){yield e._updateTokensIfNecessary(r,!0);let i=jd(r);return new n({user:e,providerId:i,_tokenResponse:r,operationType:t})})}};function jd(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}var Ja=class n extends xe{constructor(e,t,r,i){var s;super(t.code,t.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,n.prototype),this.customData={appName:e.name,tenantId:(s=e.tenantId)!==null&&s!==void 0?s:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,i){return new n(e,t,r,i)}};function If(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?Ja._fromErrorAndOperation(n,s,e,r):s})}function Dv(n,e,t=!1){return m(this,null,function*(){let r=yield Kr(n,e._linkToIdToken(n.auth,yield n.getIdToken()),t);return jn._forOperation(n,"link",r)})}function Nv(n,e,t=!1){return m(this,null,function*(){let{auth:r}=n;if(ke(r.app))return Promise.reject(_t(r));let i="reauthenticate";try{let s=yield Kr(n,If(r,i,e,n),t);F(s.idToken,r,"internal-error");let a=ac(s.idToken);F(a,r,"internal-error");let{sub:c}=a;return F(n.uid===c,r,"user-mismatch"),jn._forOperation(n,i,s)}catch(s){throw s?.code==="auth/user-not-found"&&nt(r,"user-mismatch"),s}})}function wf(n,e,t=!1){return m(this,null,function*(){if(ke(n.app))return Promise.reject(_t(n));let r="signIn",i=yield If(n,r,e),s=yield jn._fromIdTokenResponse(n,r,i);return t||(yield n._updateCurrentUser(s.user)),s})}function dc(n,e){return m(this,null,function*(){return wf(fn(n),e)})}function Ef(n){return m(this,null,function*(){let e=fn(n);e._getPasswordPolicyInternal()&&(yield e._updatePasswordPolicy())})}function fc(n,e,t){return m(this,null,function*(){if(ke(n.app))return Promise.reject(_t(n));let r=fn(n),a=yield Ha(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",kv,"EMAIL_PASSWORD_PROVIDER").catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&Ef(n),l}),c=yield jn._fromIdTokenResponse(r,"signIn",a);return yield r._updateCurrentUser(c.user),c})}function pc(n,e,t){return ke(n.app)?Promise.reject(_t(n)):dc(ce(n),vf.credential(e,t)).catch(r=>m(null,null,function*(){throw r.code==="auth/password-does-not-meet-requirements"&&Ef(n),r}))}function Zr(n,e,t,r){return ce(n).onIdTokenChanged(e,t,r)}function mc(n,e,t){return ce(n).beforeAuthStateChanged(e,t)}function gc(n){return ce(n).signOut()}var ys="__sak";var vs=class{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(ys,"1"),this.storage.removeItem(ys),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}};var Ov=1e3,xv=10,Vv=(()=>{class n extends vs{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,r)=>this.onStorageEvent(t,r),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=ff(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(let r of Object.keys(this.listeners)){let i=this.storage.getItem(r),s=this.localCache[r];i!==s&&t(r,s,i)}}onStorageEvent(t,r=!1){if(!t.key){this.forAllChangedKeys((c,l,d)=>{this.notifyListeners(c,d)});return}let i=t.key;r?this.detachListener():this.stopPolling();let s=()=>{let c=this.storage.getItem(i);!r&&this.localCache[i]===c||this.notifyListeners(i,c)},a=this.storage.getItem(i);pv()&&a!==t.newValue&&t.newValue!==t.oldValue?setTimeout(s,xv):s()}notifyListeners(t,r){this.localCache[t]=r;let i=this.listeners[t];if(i)for(let s of Array.from(i))s(r&&JSON.parse(r))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,r,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:r,newValue:i}),!0)})},Ov)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,r){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}_set(t,r){return m(this,null,function*(){yield Dt(n.prototype,this,"_set").call(this,t,r),this.localCache[t]=JSON.stringify(r)})}_get(t){return m(this,null,function*(){let r=yield Dt(n.prototype,this,"_get").call(this,t);return this.localCache[t]=JSON.stringify(r),r})}_remove(t){return m(this,null,function*(){yield Dt(n.prototype,this,"_remove").call(this,t),delete this.localCache[t]})}}return n.type="LOCAL",n})(),Tf=Vv;var Lv=(()=>{class n extends vs{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,r){}_removeListener(t,r){}}return n.type="SESSION",n})(),_c=Lv;function Mv(n){return Promise.all(n.map(e=>m(null,null,function*(){try{return{fulfilled:!0,value:yield e}}catch(t){return{fulfilled:!1,reason:t}}})))}var Fv=(()=>{class n{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){let r=this.receivers.find(s=>s.isListeningto(t));if(r)return r;let i=new n(t);return this.receivers.push(i),i}isListeningto(t){return this.eventTarget===t}handleEvent(t){return m(this,null,function*(){let r=t,{eventId:i,eventType:s,data:a}=r.data,c=this.handlersMap[s];if(!c?.size)return;r.ports[0].postMessage({status:"ack",eventId:i,eventType:s});let l=Array.from(c).map(p=>m(this,null,function*(){return p(r.origin,a)})),d=yield Mv(l);r.ports[0].postMessage({status:"done",eventId:i,eventType:s,response:d})})}_subscribe(t,r){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(r)}_unsubscribe(t,r){this.handlersMap[t]&&r&&this.handlersMap[t].delete(r),(!r||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}n.receivers=[];return n})();function Af(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}var Ya=class{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}_send(e,t,r=50){return m(this,null,function*(){let i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,a;return new Promise((c,l)=>{let d=Af("",20);i.port1.start();let p=setTimeout(()=>{l(new Error("unsupported_event"))},r);a={messageChannel:i,onMessage(_){let I=_;if(I.data.eventId===d)switch(I.data.status){case"ack":clearTimeout(p),s=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),c(I.data.response);break;default:clearTimeout(p),clearTimeout(s),l(new Error("invalid_response"));break}}},this.handlers.add(a),i.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:d,data:t},[i.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})})}};function tt(){return window}function Uv(n){tt().location.href=n}function bf(){return typeof tt().WorkerGlobalScope<"u"&&typeof tt().importScripts=="function"}function qv(){return m(this,null,function*(){if(!navigator?.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})}function Bv(){var n;return((n=navigator?.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function $v(){return bf()?self:null}var Sf="firebaseLocalStorageDb",jv=1,Is="firebaseLocalStorage",Rf="fbase_key",dn=class{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}};function Ts(n,e){return n.transaction([Is],e?"readwrite":"readonly").objectStore(Is)}function zv(){let n=indexedDB.deleteDatabase(Sf);return new dn(n).toPromise()}function Xa(){let n=indexedDB.open(Sf,jv);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{let r=n.result;try{r.createObjectStore(Is,{keyPath:Rf})}catch(i){t(i)}}),n.addEventListener("success",()=>m(null,null,function*(){let r=n.result;r.objectStoreNames.contains(Is)?e(r):(r.close(),yield zv(),e(yield Xa()))}))})}function zd(n,e,t){return m(this,null,function*(){let r=Ts(n,!0).put({[Rf]:e,value:t});return new dn(r).toPromise()})}function Wv(n,e){return m(this,null,function*(){let t=Ts(n,!1).get(e),r=yield new dn(t).toPromise();return r===void 0?null:r.value})}function Wd(n,e){let t=Ts(n,!0).delete(e);return new dn(t).toPromise()}var Gv=800,Kv=3,Hv=(()=>{class n{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){return m(this,null,function*(){return this.db?this.db:(this.db=yield Xa(),this.db)})}_withRetries(t){return m(this,null,function*(){let r=0;for(;;)try{let i=yield this._openDb();return yield t(i)}catch(i){if(r++>Kv)throw i;this.db&&(this.db.close(),this.db=void 0)}})}initializeServiceWorkerMessaging(){return m(this,null,function*(){return bf()?this.initializeReceiver():this.initializeSender()})}initializeReceiver(){return m(this,null,function*(){this.receiver=Fv._getInstance($v()),this.receiver._subscribe("keyChanged",(t,r)=>m(this,null,function*(){return{keyProcessed:(yield this._poll()).includes(r.key)}})),this.receiver._subscribe("ping",(t,r)=>m(this,null,function*(){return["keyChanged"]}))})}initializeSender(){return m(this,null,function*(){var t,r;if(this.activeServiceWorker=yield qv(),!this.activeServiceWorker)return;this.sender=new Ya(this.activeServiceWorker);let i=yield this.sender._send("ping",{},800);i&&!((t=i[0])===null||t===void 0)&&t.fulfilled&&!((r=i[0])===null||r===void 0)&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)})}notifyServiceWorker(t){return m(this,null,function*(){if(!(!this.sender||!this.activeServiceWorker||Bv()!==this.activeServiceWorker))try{yield this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}})}_isAvailable(){return m(this,null,function*(){try{if(!indexedDB)return!1;let t=yield Xa();return yield zd(t,ys,"1"),yield Wd(t,ys),!0}catch{}return!1})}_withPendingWrite(t){return m(this,null,function*(){this.pendingWrites++;try{yield t()}finally{this.pendingWrites--}})}_set(t,r){return m(this,null,function*(){return this._withPendingWrite(()=>m(this,null,function*(){return yield this._withRetries(i=>zd(i,t,r)),this.localCache[t]=r,this.notifyServiceWorker(t)}))})}_get(t){return m(this,null,function*(){let r=yield this._withRetries(i=>Wv(i,t));return this.localCache[t]=r,r})}_remove(t){return m(this,null,function*(){return this._withPendingWrite(()=>m(this,null,function*(){return yield this._withRetries(r=>Wd(r,t)),delete this.localCache[t],this.notifyServiceWorker(t)}))})}_poll(){return m(this,null,function*(){let t=yield this._withRetries(s=>{let a=Ts(s,!1).getAll();return new dn(a).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];let r=[],i=new Set;if(t.length!==0)for(let{fbase_key:s,value:a}of t)i.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(a)&&(this.notifyListeners(s,a),r.push(s));for(let s of Object.keys(this.localCache))this.localCache[s]&&!i.has(s)&&(this.notifyListeners(s,null),r.push(s));return r})}notifyListeners(t,r){this.localCache[t]=r;let i=this.listeners[t];if(i)for(let s of Array.from(i))s(r)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>m(this,null,function*(){return this._poll()}),Gv)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,r){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}return n.type="LOCAL",n})(),Pf=Hv;var gb=gf("rcb"),_b=new hn(3e4,6e4);function Qv(n,e){return e?gt(e):(F(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}var Yr=class extends Qr{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Va(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Va(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Va(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}};function Jv(n){return wf(n.auth,new Yr(n),n.bypassAuthState)}function Yv(n){let{auth:e,user:t}=n;return F(t,e,"internal-error"),Nv(t,new Yr(n),n.bypassAuthState)}function Xv(n){return m(this,null,function*(){let{auth:e,user:t}=n;return F(t,e,"internal-error"),Dv(t,new Yr(n),n.bypassAuthState)})}var Za=class{constructor(e,t,r,i,s=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((e,t)=>m(this,null,function*(){this.pendingPromise={resolve:e,reject:t};try{this.eventManager=yield this.resolver._initialize(this.auth),yield this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}}))}onAuthEvent(e){return m(this,null,function*(){let{urlResponse:t,sessionId:r,postBody:i,tenantId:s,error:a,type:c}=e;if(a){this.reject(a);return}let l={auth:this.auth,requestUri:t,sessionId:r,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(yield this.getIdpTask(c)(l))}catch(d){this.reject(d)}})}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Jv;case"linkViaPopup":case"linkViaRedirect":return Xv;case"reauthViaPopup":case"reauthViaRedirect":return Yv;default:nt(this.auth,"internal-error")}}resolve(e){Bt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Bt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}};var yb=new hn(2e3,1e4);var Zv="pendingRedirect",cs=new Map,ec=class n extends Za{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}execute(){return m(this,null,function*(){let e=cs.get(this.auth._key());if(!e){try{let r=(yield eI(this.resolver,this.auth))?yield Dt(n.prototype,this,"execute").call(this):null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}cs.set(this.auth._key(),e)}return this.bypassAuthState||cs.set(this.auth._key(),()=>Promise.resolve(null)),e()})}onAuthEvent(e){return m(this,null,function*(){if(e.type==="signInViaRedirect")return Dt(n.prototype,this,"onAuthEvent").call(this,e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){let t=yield this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,Dt(n.prototype,this,"onAuthEvent").call(this,e);this.resolve(null)}})}onExecution(){return m(this,null,function*(){})}cleanUp(){}};function eI(n,e){return m(this,null,function*(){let t=rI(e),r=nI(n);if(!(yield r._isAvailable()))return!1;let i=(yield r._get(t))==="true";return yield r._remove(t),i})}function tI(n,e){cs.set(n._key(),e)}function nI(n){return gt(n._redirectPersistence)}function rI(n){return as(Zv,n.config.apiKey,n.name)}function iI(n,e,t=!1){return m(this,null,function*(){if(ke(n.app))return Promise.reject(_t(n));let r=fn(n),i=Qv(r,e),a=yield new ec(r,i,t).execute();return a&&!t&&(delete a.user._redirectEventId,yield r._persistUserIfCurrent(a.user),yield r._setRedirectUser(null,e)),a})}var sI=600*1e3,tc=class{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!oI(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!Cf(e)){let i=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(ln(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=sI&&this.cachedEventUids.clear(),this.cachedEventUids.has(Gd(e))}saveEventToCache(e){this.cachedEventUids.add(Gd(e)),this.lastProcessedEventTime=Date.now()}};function Gd(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function Cf({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function oI(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Cf(n);default:return!1}}function aI(t){return m(this,arguments,function*(n,e={}){return jt(n,"GET","/v1/projects",e)})}var cI=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,uI=/^https?/;function lI(n){return m(this,null,function*(){if(n.config.emulator)return;let{authorizedDomains:e}=yield aI(n);for(let t of e)try{if(hI(t))return}catch{}nt(n,"unauthorized-domain")})}function hI(n){let e=Ma(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){let a=new URL(n);return a.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===r}if(!uI.test(t))return!1;if(cI.test(n))return r===n;let i=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}var dI=new hn(3e4,6e4);function Kd(){let n=tt().___jsl;if(n?.H){for(let e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function fI(n){return new Promise((e,t)=>{var r,i,s;function a(){Kd(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Kd(),t(ln(n,"network-request-failed"))},timeout:dI.get()})}if(!((i=(r=tt().gapi)===null||r===void 0?void 0:r.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((s=tt().gapi)===null||s===void 0)&&s.load)a();else{let c=gf("iframefcb");return tt()[c]=()=>{gapi.load?a():t(ln(n,"network-request-failed"))},mf(`${vv()}?onload=${c}`).catch(l=>t(l))}}).catch(e=>{throw us=null,e})}var us=null;function pI(n){return us=us||fI(n),us}var mI=new hn(5e3,15e3),gI="__/auth/iframe",_I="emulator/auth/iframe",yI={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},vI=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function II(n){let e=n.config;F(e.authDomain,n,"auth-domain-config-required");let t=e.emulator?sc(e,_I):`https://${n.config.authDomain}/${gI}`,r={apiKey:e.apiKey,appName:n.name,v:Vt},i=vI.get(n.config.apiHost);i&&(r.eid=i);let s=n._getFrameworks();return s.length&&(r.fw=s.join(",")),`${t}?${Fr(r).slice(1)}`}function wI(n){return m(this,null,function*(){let e=yield pI(n),t=tt().gapi;return F(t,n,"internal-error"),e.open({where:document.body,url:II(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:yI,dontclear:!0},r=>new Promise((i,s)=>m(null,null,function*(){yield r.restyle({setHideOnLeave:!1});let a=ln(n,"network-request-failed"),c=tt().setTimeout(()=>{s(a)},mI.get());function l(){tt().clearTimeout(c),i(r)}r.ping(l).then(l,()=>{s(a)})})))})}var EI={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},TI=500,AI=600,bI="_blank",SI="http://localhost",ws=class{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}};function RI(n,e,t,r=TI,i=AI){let s=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString(),c="",l=Object.assign(Object.assign({},EI),{width:r.toString(),height:i.toString(),top:s,left:a}),d=me().toLowerCase();t&&(c=cf(d)?bI:t),of(d)&&(e=e||SI,l.scrollbars="yes");let p=Object.entries(l).reduce((I,[R,k])=>`${I}${R}=${k},`,"");if(fv(d)&&c!=="_self")return PI(e||"",c),new ws(null);let _=window.open(e||"",c,p);F(_,n,"popup-blocked");try{_.focus()}catch{}return new ws(_)}function PI(n,e){let t=document.createElement("a");t.href=n,t.target=e;let r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}var CI="__/auth/handler",kI="emulator/auth/handler",DI=encodeURIComponent("fac");function Hd(n,e,t,r,i,s){return m(this,null,function*(){F(n.config.authDomain,n,"auth-domain-config-required"),F(n.config.apiKey,n,"invalid-api-key");let a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:Vt,eventId:i};if(e instanceof _s){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",cd(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(let[p,_]of Object.entries(s||{}))a[p]=_}if(e instanceof Qa){let p=e.getScopes().filter(_=>_!=="");p.length>0&&(a.scopes=p.join(","))}n.tenantId&&(a.tid=n.tenantId);let c=a;for(let p of Object.keys(c))c[p]===void 0&&delete c[p];let l=yield n._getAppCheckToken(),d=l?`#${DI}=${encodeURIComponent(l)}`:"";return`${NI(n)}?${Fr(c).slice(1)}${d}`})}function NI({config:n}){return n.emulator?sc(n,kI):`https://${n.authDomain}/${CI}`}var La="webStorageSupport",nc=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=_c,this._completeRedirectFn=iI,this._overrideRedirectResult=tI}_openPopup(e,t,r,i){return m(this,null,function*(){var s;Bt((s=this.eventManagers[e._key()])===null||s===void 0?void 0:s.manager,"_initialize() not called before _openPopup()");let a=yield Hd(e,t,r,Ma(),i);return RI(e,a,Af())})}_openRedirect(e,t,r,i){return m(this,null,function*(){yield this._originValidation(e);let s=yield Hd(e,t,r,Ma(),i);return Uv(s),new Promise(()=>{})})}_initialize(e){let t=e._key();if(this.eventManagers[t]){let{manager:i,promise:s}=this.eventManagers[t];return i?Promise.resolve(i):(Bt(s,"If manager is not set, promise should be"),s)}let r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}initAndGetManager(e){return m(this,null,function*(){let t=yield wI(e),r=new tc(e);return t.register("authEvent",i=>(F(i?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r})}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(La,{type:La},i=>{var s;let a=(s=i?.[0])===null||s===void 0?void 0:s[La];a!==void 0&&t(!!a),nt(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=lI(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return ff()||af()||uc()}},kf=nc;var Qd="@firebase/auth",Jd="1.10.8";var rc=class{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}getToken(e){return m(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(e)}:null})}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){F(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};function OI(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function xI(n){We(new Pe("auth",(e,{options:t})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:a,authDomain:c}=r.options;F(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});let l={apiKey:a,authDomain:c,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:pf(n)},d=new za(r,i,s,l);return wv(d,t),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),We(new Pe("auth-internal",e=>{let t=fn(e.getProvider("auth").getImmediate());return(r=>new rc(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),se(Qd,Jd,OI(n)),se(Qd,Jd,"esm2017")}var VI=300,LI=ha("authIdTokenMaxAge")||VI,Yd=null,MI=n=>e=>m(null,null,function*(){let t=e&&(yield e.getIdTokenResult()),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>LI)return;let i=t?.token;Yd!==i&&(Yd=i,yield fetch(n,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))});function yc(n=an()){let e=Un(n,"auth");if(e.isInitialized())return e.getImmediate();let t=lc(n,{popupRedirectResolver:kf,persistence:[Pf,Tf,_c]}),r=ha("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){let s=new URL(r,location.origin);if(location.origin===s.origin){let a=MI(s.toString());mc(t,a,()=>a(t.currentUser)),Zr(t,c=>a(c))}}let i=ua("auth");return i&&hc(t,`http://${i}`),t}function FI(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}_v({loadJS(n){return new Promise((e,t)=>{let r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=i=>{let s=ln("internal-error");s.customData=i,t(s)},r.type="text/javascript",r.charset="UTF-8",FI().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});xI("Browser");function Of(n){return new Me(function(e){var t=Zr(n,e.next.bind(e),e.error.bind(e),e.complete.bind(e));return{unsubscribe:t}})}var xf="auth",pn=class{constructor(e){return e}},ei=class{constructor(){return Bn(xf)}};var vc=new Vn("angularfire2.auth-instances");function Sw(n,e){let t=Br(xf,n,e);return t&&new pn(t)}function Rw(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new pn(r)}}var Pw={provide:ei,deps:[[new Ue,vc]]},Cw={provide:pn,useFactory:Sw,deps:[[new Ue,vc],pt]};function h0(n,...e){return se("angularfire",Lt.full,"auth"),Ln([Cw,Pw,{provide:vc,useFactory:Rw(n),multi:!0,deps:[Ye,Nt,Mt,un,[new Ue,$n],...e]}])}var d0=te(Of,!0);var f0=te(fc,!0,2);var p0=te(yc,!0);var m0=te(pc,!0,2);var g0=te(gc,!0,2);var Vf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Lf={};var yt,Ic;(function(){var n;function e(E,g){function v(){}v.prototype=g.prototype,E.D=g.prototype,E.prototype=new v,E.prototype.constructor=E,E.C=function(w,T,b){for(var y=Array(arguments.length-2),lt=2;lt<arguments.length;lt++)y[lt-2]=arguments[lt];return g.prototype[T].apply(w,y)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(E,g,v){v||(v=0);var w=Array(16);if(typeof g=="string")for(var T=0;16>T;++T)w[T]=g.charCodeAt(v++)|g.charCodeAt(v++)<<8|g.charCodeAt(v++)<<16|g.charCodeAt(v++)<<24;else for(T=0;16>T;++T)w[T]=g[v++]|g[v++]<<8|g[v++]<<16|g[v++]<<24;g=E.g[0],v=E.g[1],T=E.g[2];var b=E.g[3],y=g+(b^v&(T^b))+w[0]+3614090360&4294967295;g=v+(y<<7&4294967295|y>>>25),y=b+(T^g&(v^T))+w[1]+3905402710&4294967295,b=g+(y<<12&4294967295|y>>>20),y=T+(v^b&(g^v))+w[2]+606105819&4294967295,T=b+(y<<17&4294967295|y>>>15),y=v+(g^T&(b^g))+w[3]+3250441966&4294967295,v=T+(y<<22&4294967295|y>>>10),y=g+(b^v&(T^b))+w[4]+4118548399&4294967295,g=v+(y<<7&4294967295|y>>>25),y=b+(T^g&(v^T))+w[5]+1200080426&4294967295,b=g+(y<<12&4294967295|y>>>20),y=T+(v^b&(g^v))+w[6]+2821735955&4294967295,T=b+(y<<17&4294967295|y>>>15),y=v+(g^T&(b^g))+w[7]+4249261313&4294967295,v=T+(y<<22&4294967295|y>>>10),y=g+(b^v&(T^b))+w[8]+1770035416&4294967295,g=v+(y<<7&4294967295|y>>>25),y=b+(T^g&(v^T))+w[9]+2336552879&4294967295,b=g+(y<<12&4294967295|y>>>20),y=T+(v^b&(g^v))+w[10]+4294925233&4294967295,T=b+(y<<17&4294967295|y>>>15),y=v+(g^T&(b^g))+w[11]+2304563134&4294967295,v=T+(y<<22&4294967295|y>>>10),y=g+(b^v&(T^b))+w[12]+1804603682&4294967295,g=v+(y<<7&4294967295|y>>>25),y=b+(T^g&(v^T))+w[13]+4254626195&4294967295,b=g+(y<<12&4294967295|y>>>20),y=T+(v^b&(g^v))+w[14]+2792965006&4294967295,T=b+(y<<17&4294967295|y>>>15),y=v+(g^T&(b^g))+w[15]+1236535329&4294967295,v=T+(y<<22&4294967295|y>>>10),y=g+(T^b&(v^T))+w[1]+4129170786&4294967295,g=v+(y<<5&4294967295|y>>>27),y=b+(v^T&(g^v))+w[6]+3225465664&4294967295,b=g+(y<<9&4294967295|y>>>23),y=T+(g^v&(b^g))+w[11]+643717713&4294967295,T=b+(y<<14&4294967295|y>>>18),y=v+(b^g&(T^b))+w[0]+3921069994&4294967295,v=T+(y<<20&4294967295|y>>>12),y=g+(T^b&(v^T))+w[5]+3593408605&4294967295,g=v+(y<<5&4294967295|y>>>27),y=b+(v^T&(g^v))+w[10]+38016083&4294967295,b=g+(y<<9&4294967295|y>>>23),y=T+(g^v&(b^g))+w[15]+3634488961&4294967295,T=b+(y<<14&4294967295|y>>>18),y=v+(b^g&(T^b))+w[4]+3889429448&4294967295,v=T+(y<<20&4294967295|y>>>12),y=g+(T^b&(v^T))+w[9]+568446438&4294967295,g=v+(y<<5&4294967295|y>>>27),y=b+(v^T&(g^v))+w[14]+3275163606&4294967295,b=g+(y<<9&4294967295|y>>>23),y=T+(g^v&(b^g))+w[3]+4107603335&4294967295,T=b+(y<<14&4294967295|y>>>18),y=v+(b^g&(T^b))+w[8]+1163531501&4294967295,v=T+(y<<20&4294967295|y>>>12),y=g+(T^b&(v^T))+w[13]+2850285829&4294967295,g=v+(y<<5&4294967295|y>>>27),y=b+(v^T&(g^v))+w[2]+4243563512&4294967295,b=g+(y<<9&4294967295|y>>>23),y=T+(g^v&(b^g))+w[7]+1735328473&4294967295,T=b+(y<<14&4294967295|y>>>18),y=v+(b^g&(T^b))+w[12]+2368359562&4294967295,v=T+(y<<20&4294967295|y>>>12),y=g+(v^T^b)+w[5]+4294588738&4294967295,g=v+(y<<4&4294967295|y>>>28),y=b+(g^v^T)+w[8]+2272392833&4294967295,b=g+(y<<11&4294967295|y>>>21),y=T+(b^g^v)+w[11]+1839030562&4294967295,T=b+(y<<16&4294967295|y>>>16),y=v+(T^b^g)+w[14]+4259657740&4294967295,v=T+(y<<23&4294967295|y>>>9),y=g+(v^T^b)+w[1]+2763975236&4294967295,g=v+(y<<4&4294967295|y>>>28),y=b+(g^v^T)+w[4]+1272893353&4294967295,b=g+(y<<11&4294967295|y>>>21),y=T+(b^g^v)+w[7]+4139469664&4294967295,T=b+(y<<16&4294967295|y>>>16),y=v+(T^b^g)+w[10]+3200236656&4294967295,v=T+(y<<23&4294967295|y>>>9),y=g+(v^T^b)+w[13]+681279174&4294967295,g=v+(y<<4&4294967295|y>>>28),y=b+(g^v^T)+w[0]+3936430074&4294967295,b=g+(y<<11&4294967295|y>>>21),y=T+(b^g^v)+w[3]+3572445317&4294967295,T=b+(y<<16&4294967295|y>>>16),y=v+(T^b^g)+w[6]+76029189&4294967295,v=T+(y<<23&4294967295|y>>>9),y=g+(v^T^b)+w[9]+3654602809&4294967295,g=v+(y<<4&4294967295|y>>>28),y=b+(g^v^T)+w[12]+3873151461&4294967295,b=g+(y<<11&4294967295|y>>>21),y=T+(b^g^v)+w[15]+530742520&4294967295,T=b+(y<<16&4294967295|y>>>16),y=v+(T^b^g)+w[2]+3299628645&4294967295,v=T+(y<<23&4294967295|y>>>9),y=g+(T^(v|~b))+w[0]+4096336452&4294967295,g=v+(y<<6&4294967295|y>>>26),y=b+(v^(g|~T))+w[7]+1126891415&4294967295,b=g+(y<<10&4294967295|y>>>22),y=T+(g^(b|~v))+w[14]+2878612391&4294967295,T=b+(y<<15&4294967295|y>>>17),y=v+(b^(T|~g))+w[5]+4237533241&4294967295,v=T+(y<<21&4294967295|y>>>11),y=g+(T^(v|~b))+w[12]+1700485571&4294967295,g=v+(y<<6&4294967295|y>>>26),y=b+(v^(g|~T))+w[3]+2399980690&4294967295,b=g+(y<<10&4294967295|y>>>22),y=T+(g^(b|~v))+w[10]+4293915773&4294967295,T=b+(y<<15&4294967295|y>>>17),y=v+(b^(T|~g))+w[1]+2240044497&4294967295,v=T+(y<<21&4294967295|y>>>11),y=g+(T^(v|~b))+w[8]+1873313359&4294967295,g=v+(y<<6&4294967295|y>>>26),y=b+(v^(g|~T))+w[15]+4264355552&4294967295,b=g+(y<<10&4294967295|y>>>22),y=T+(g^(b|~v))+w[6]+2734768916&4294967295,T=b+(y<<15&4294967295|y>>>17),y=v+(b^(T|~g))+w[13]+1309151649&4294967295,v=T+(y<<21&4294967295|y>>>11),y=g+(T^(v|~b))+w[4]+4149444226&4294967295,g=v+(y<<6&4294967295|y>>>26),y=b+(v^(g|~T))+w[11]+3174756917&4294967295,b=g+(y<<10&4294967295|y>>>22),y=T+(g^(b|~v))+w[2]+718787259&4294967295,T=b+(y<<15&4294967295|y>>>17),y=v+(b^(T|~g))+w[9]+3951481745&4294967295,E.g[0]=E.g[0]+g&4294967295,E.g[1]=E.g[1]+(T+(y<<21&4294967295|y>>>11))&4294967295,E.g[2]=E.g[2]+T&4294967295,E.g[3]=E.g[3]+b&4294967295}r.prototype.u=function(E,g){g===void 0&&(g=E.length);for(var v=g-this.blockSize,w=this.B,T=this.h,b=0;b<g;){if(T==0)for(;b<=v;)i(this,E,b),b+=this.blockSize;if(typeof E=="string"){for(;b<g;)if(w[T++]=E.charCodeAt(b++),T==this.blockSize){i(this,w),T=0;break}}else for(;b<g;)if(w[T++]=E[b++],T==this.blockSize){i(this,w),T=0;break}}this.h=T,this.o+=g},r.prototype.v=function(){var E=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);E[0]=128;for(var g=1;g<E.length-8;++g)E[g]=0;var v=8*this.o;for(g=E.length-8;g<E.length;++g)E[g]=v&255,v/=256;for(this.u(E),E=Array(16),g=v=0;4>g;++g)for(var w=0;32>w;w+=8)E[v++]=this.g[g]>>>w&255;return E};function s(E,g){var v=c;return Object.prototype.hasOwnProperty.call(v,E)?v[E]:v[E]=g(E)}function a(E,g){this.h=g;for(var v=[],w=!0,T=E.length-1;0<=T;T--){var b=E[T]|0;w&&b==g||(v[T]=b,w=!1)}this.g=v}var c={};function l(E){return-128<=E&&128>E?s(E,function(g){return new a([g|0],0>g?-1:0)}):new a([E|0],0>E?-1:0)}function d(E){if(isNaN(E)||!isFinite(E))return _;if(0>E)return D(d(-E));for(var g=[],v=1,w=0;E>=v;w++)g[w]=E/v|0,v*=4294967296;return new a(g,0)}function p(E,g){if(E.length==0)throw Error("number format error: empty string");if(g=g||10,2>g||36<g)throw Error("radix out of range: "+g);if(E.charAt(0)=="-")return D(p(E.substring(1),g));if(0<=E.indexOf("-"))throw Error('number format error: interior "-" character');for(var v=d(Math.pow(g,8)),w=_,T=0;T<E.length;T+=8){var b=Math.min(8,E.length-T),y=parseInt(E.substring(T,T+b),g);8>b?(b=d(Math.pow(g,b)),w=w.j(b).add(d(y))):(w=w.j(v),w=w.add(d(y)))}return w}var _=l(0),I=l(1),R=l(16777216);n=a.prototype,n.m=function(){if(x(this))return-D(this).m();for(var E=0,g=1,v=0;v<this.g.length;v++){var w=this.i(v);E+=(0<=w?w:4294967296+w)*g,g*=4294967296}return E},n.toString=function(E){if(E=E||10,2>E||36<E)throw Error("radix out of range: "+E);if(k(this))return"0";if(x(this))return"-"+D(this).toString(E);for(var g=d(Math.pow(E,6)),v=this,w="";;){var T=X(v,g).g;v=$(v,T.j(g));var b=((0<v.g.length?v.g[0]:v.h)>>>0).toString(E);if(v=T,k(v))return b+w;for(;6>b.length;)b="0"+b;w=b+w}},n.i=function(E){return 0>E?0:E<this.g.length?this.g[E]:this.h};function k(E){if(E.h!=0)return!1;for(var g=0;g<E.g.length;g++)if(E.g[g]!=0)return!1;return!0}function x(E){return E.h==-1}n.l=function(E){return E=$(this,E),x(E)?-1:k(E)?0:1};function D(E){for(var g=E.g.length,v=[],w=0;w<g;w++)v[w]=~E.g[w];return new a(v,~E.h).add(I)}n.abs=function(){return x(this)?D(this):this},n.add=function(E){for(var g=Math.max(this.g.length,E.g.length),v=[],w=0,T=0;T<=g;T++){var b=w+(this.i(T)&65535)+(E.i(T)&65535),y=(b>>>16)+(this.i(T)>>>16)+(E.i(T)>>>16);w=y>>>16,b&=65535,y&=65535,v[T]=y<<16|b}return new a(v,v[v.length-1]&-2147483648?-1:0)};function $(E,g){return E.add(D(g))}n.j=function(E){if(k(this)||k(E))return _;if(x(this))return x(E)?D(this).j(D(E)):D(D(this).j(E));if(x(E))return D(this.j(D(E)));if(0>this.l(R)&&0>E.l(R))return d(this.m()*E.m());for(var g=this.g.length+E.g.length,v=[],w=0;w<2*g;w++)v[w]=0;for(w=0;w<this.g.length;w++)for(var T=0;T<E.g.length;T++){var b=this.i(w)>>>16,y=this.i(w)&65535,lt=E.i(T)>>>16,mr=E.i(T)&65535;v[2*w+2*T]+=y*mr,U(v,2*w+2*T),v[2*w+2*T+1]+=b*mr,U(v,2*w+2*T+1),v[2*w+2*T+1]+=y*lt,U(v,2*w+2*T+1),v[2*w+2*T+2]+=b*lt,U(v,2*w+2*T+2)}for(w=0;w<g;w++)v[w]=v[2*w+1]<<16|v[2*w];for(w=g;w<2*g;w++)v[w]=0;return new a(v,0)};function U(E,g){for(;(E[g]&65535)!=E[g];)E[g+1]+=E[g]>>>16,E[g]&=65535,g++}function j(E,g){this.g=E,this.h=g}function X(E,g){if(k(g))throw Error("division by zero");if(k(E))return new j(_,_);if(x(E))return g=X(D(E),g),new j(D(g.g),D(g.h));if(x(g))return g=X(E,D(g)),new j(D(g.g),g.h);if(30<E.g.length){if(x(E)||x(g))throw Error("slowDivide_ only works with positive integers.");for(var v=I,w=g;0>=w.l(E);)v=be(v),w=be(w);var T=Y(v,1),b=Y(w,1);for(w=Y(w,2),v=Y(v,2);!k(w);){var y=b.add(w);0>=y.l(E)&&(T=T.add(v),b=y),w=Y(w,1),v=Y(v,1)}return g=$(E,T.j(g)),new j(T,g)}for(T=_;0<=E.l(g);){for(v=Math.max(1,Math.floor(E.m()/g.m())),w=Math.ceil(Math.log(v)/Math.LN2),w=48>=w?1:Math.pow(2,w-48),b=d(v),y=b.j(g);x(y)||0<y.l(E);)v-=w,b=d(v),y=b.j(g);k(b)&&(b=I),T=T.add(b),E=$(E,y)}return new j(T,E)}n.A=function(E){return X(this,E).h},n.and=function(E){for(var g=Math.max(this.g.length,E.g.length),v=[],w=0;w<g;w++)v[w]=this.i(w)&E.i(w);return new a(v,this.h&E.h)},n.or=function(E){for(var g=Math.max(this.g.length,E.g.length),v=[],w=0;w<g;w++)v[w]=this.i(w)|E.i(w);return new a(v,this.h|E.h)},n.xor=function(E){for(var g=Math.max(this.g.length,E.g.length),v=[],w=0;w<g;w++)v[w]=this.i(w)^E.i(w);return new a(v,this.h^E.h)};function be(E){for(var g=E.g.length+1,v=[],w=0;w<g;w++)v[w]=E.i(w)<<1|E.i(w-1)>>>31;return new a(v,E.h)}function Y(E,g){var v=g>>5;g%=32;for(var w=E.g.length-v,T=[],b=0;b<w;b++)T[b]=0<g?E.i(b+v)>>>g|E.i(b+v+1)<<32-g:E.i(b+v);return new a(T,E.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,Ic=Lf.Md5=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=p,yt=Lf.Integer=a}).apply(typeof Vf<"u"?Vf:typeof self<"u"?self:typeof window<"u"?window:{});var As=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},vt={};var wc,kw,zn,Ec,ti,bs,Tc,Ac,bc;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(o,u,h){return o==Array.prototype||o==Object.prototype||(o[u]=h.value),o};function t(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof As=="object"&&As];for(var u=0;u<o.length;++u){var h=o[u];if(h&&h.Math==Math)return h}throw Error("Cannot find global object")}var r=t(this);function i(o,u){if(u)e:{var h=r;o=o.split(".");for(var f=0;f<o.length-1;f++){var A=o[f];if(!(A in h))break e;h=h[A]}o=o[o.length-1],f=h[o],u=u(f),u!=f&&u!=null&&e(h,o,{configurable:!0,writable:!0,value:u})}}function s(o,u){o instanceof String&&(o+="");var h=0,f=!1,A={next:function(){if(!f&&h<o.length){var S=h++;return{value:u(S,o[S]),done:!1}}return f=!0,{done:!0,value:void 0}}};return A[Symbol.iterator]=function(){return A},A}i("Array.prototype.values",function(o){return o||function(){return s(this,function(u,h){return h})}});var a=a||{},c=this||self;function l(o){var u=typeof o;return u=u!="object"?u:o?Array.isArray(o)?"array":u:"null",u=="array"||u=="object"&&typeof o.length=="number"}function d(o){var u=typeof o;return u=="object"&&o!=null||u=="function"}function p(o,u,h){return o.call.apply(o.bind,arguments)}function _(o,u,h){if(!o)throw Error();if(2<arguments.length){var f=Array.prototype.slice.call(arguments,2);return function(){var A=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(A,f),o.apply(u,A)}}return function(){return o.apply(u,arguments)}}function I(o,u,h){return I=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?p:_,I.apply(null,arguments)}function R(o,u){var h=Array.prototype.slice.call(arguments,1);return function(){var f=h.slice();return f.push.apply(f,arguments),o.apply(this,f)}}function k(o,u){function h(){}h.prototype=u.prototype,o.aa=u.prototype,o.prototype=new h,o.prototype.constructor=o,o.Qb=function(f,A,S){for(var N=Array(arguments.length-2),Z=2;Z<arguments.length;Z++)N[Z-2]=arguments[Z];return u.prototype[A].apply(f,N)}}function x(o){let u=o.length;if(0<u){let h=Array(u);for(let f=0;f<u;f++)h[f]=o[f];return h}return[]}function D(o,u){for(let h=1;h<arguments.length;h++){let f=arguments[h];if(l(f)){let A=o.length||0,S=f.length||0;o.length=A+S;for(let N=0;N<S;N++)o[A+N]=f[N]}else o.push(f)}}class ${constructor(u,h){this.i=u,this.j=h,this.h=0,this.g=null}get(){let u;return 0<this.h?(this.h--,u=this.g,this.g=u.next,u.next=null):u=this.i(),u}}function U(o){return/^[\s\xa0]*$/.test(o)}function j(){var o=c.navigator;return o&&(o=o.userAgent)?o:""}function X(o){return X[" "](o),o}X[" "]=function(){};var be=j().indexOf("Gecko")!=-1&&!(j().toLowerCase().indexOf("webkit")!=-1&&j().indexOf("Edge")==-1)&&!(j().indexOf("Trident")!=-1||j().indexOf("MSIE")!=-1)&&j().indexOf("Edge")==-1;function Y(o,u,h){for(let f in o)u.call(h,o[f],f,o)}function E(o,u){for(let h in o)u.call(void 0,o[h],h,o)}function g(o){let u={};for(let h in o)u[h]=o[h];return u}let v="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function w(o,u){let h,f;for(let A=1;A<arguments.length;A++){f=arguments[A];for(h in f)o[h]=f[h];for(let S=0;S<v.length;S++)h=v[S],Object.prototype.hasOwnProperty.call(f,h)&&(o[h]=f[h])}}function T(o){var u=1;o=o.split(":");let h=[];for(;0<u&&o.length;)h.push(o.shift()),u--;return o.length&&h.push(o.join(":")),h}function b(o){c.setTimeout(()=>{throw o},0)}function y(){var o=Co;let u=null;return o.g&&(u=o.g,o.g=o.g.next,o.g||(o.h=null),u.next=null),u}class lt{constructor(){this.h=this.g=null}add(u,h){let f=mr.get();f.set(u,h),this.h?this.h.next=f:this.g=f,this.h=f}}var mr=new $(()=>new Eg,o=>o.reset());class Eg{constructor(){this.next=this.g=this.h=null}set(u,h){this.h=u,this.g=h,this.next=null}reset(){this.next=this.g=this.h=null}}let gr,_r=!1,Co=new lt,$l=()=>{let o=c.Promise.resolve(void 0);gr=()=>{o.then(Tg)}};var Tg=()=>{for(var o;o=y();){try{o.h.call(o.g)}catch(h){b(h)}var u=mr;u.j(o),100>u.h&&(u.h++,o.next=u.g,u.g=o)}_r=!1};function Rt(){this.s=this.s,this.C=this.C}Rt.prototype.s=!1,Rt.prototype.ma=function(){this.s||(this.s=!0,this.N())},Rt.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function ve(o,u){this.type=o,this.g=this.target=u,this.defaultPrevented=!1}ve.prototype.h=function(){this.defaultPrevented=!0};var Ag=(function(){if(!c.addEventListener||!Object.defineProperty)return!1;var o=!1,u=Object.defineProperty({},"passive",{get:function(){o=!0}});try{let h=()=>{};c.addEventListener("test",h,u),c.removeEventListener("test",h,u)}catch{}return o})();function yr(o,u){if(ve.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o){var h=this.type=o.type,f=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;if(this.target=o.target||o.srcElement,this.g=u,u=o.relatedTarget){if(be){e:{try{X(u.nodeName);var A=!0;break e}catch{}A=!1}A||(u=null)}}else h=="mouseover"?u=o.fromElement:h=="mouseout"&&(u=o.toElement);this.relatedTarget=u,f?(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=typeof o.pointerType=="string"?o.pointerType:bg[o.pointerType]||"",this.state=o.state,this.i=o,o.defaultPrevented&&yr.aa.h.call(this)}}k(yr,ve);var bg={2:"touch",3:"pen",4:"mouse"};yr.prototype.h=function(){yr.aa.h.call(this);var o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var vr="closure_listenable_"+(1e6*Math.random()|0),Sg=0;function Rg(o,u,h,f,A){this.listener=o,this.proxy=null,this.src=u,this.type=h,this.capture=!!f,this.ha=A,this.key=++Sg,this.da=this.fa=!1}function Ci(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function ki(o){this.src=o,this.g={},this.h=0}ki.prototype.add=function(o,u,h,f,A){var S=o.toString();o=this.g[S],o||(o=this.g[S]=[],this.h++);var N=Do(o,u,f,A);return-1<N?(u=o[N],h||(u.fa=!1)):(u=new Rg(u,this.src,S,!!f,A),u.fa=h,o.push(u)),u};function ko(o,u){var h=u.type;if(h in o.g){var f=o.g[h],A=Array.prototype.indexOf.call(f,u,void 0),S;(S=0<=A)&&Array.prototype.splice.call(f,A,1),S&&(Ci(u),o.g[h].length==0&&(delete o.g[h],o.h--))}}function Do(o,u,h,f){for(var A=0;A<o.length;++A){var S=o[A];if(!S.da&&S.listener==u&&S.capture==!!h&&S.ha==f)return A}return-1}var No="closure_lm_"+(1e6*Math.random()|0),Oo={};function jl(o,u,h,f,A){if(f&&f.once)return Wl(o,u,h,f,A);if(Array.isArray(u)){for(var S=0;S<u.length;S++)jl(o,u[S],h,f,A);return null}return h=Mo(h),o&&o[vr]?o.K(u,h,d(f)?!!f.capture:!!f,A):zl(o,u,h,!1,f,A)}function zl(o,u,h,f,A,S){if(!u)throw Error("Invalid event type");var N=d(A)?!!A.capture:!!A,Z=Vo(o);if(Z||(o[No]=Z=new ki(o)),h=Z.add(u,h,f,N,S),h.proxy)return h;if(f=Pg(),h.proxy=f,f.src=o,f.listener=h,o.addEventListener)Ag||(A=N),A===void 0&&(A=!1),o.addEventListener(u.toString(),f,A);else if(o.attachEvent)o.attachEvent(Kl(u.toString()),f);else if(o.addListener&&o.removeListener)o.addListener(f);else throw Error("addEventListener and attachEvent are unavailable.");return h}function Pg(){function o(h){return u.call(o.src,o.listener,h)}let u=Cg;return o}function Wl(o,u,h,f,A){if(Array.isArray(u)){for(var S=0;S<u.length;S++)Wl(o,u[S],h,f,A);return null}return h=Mo(h),o&&o[vr]?o.L(u,h,d(f)?!!f.capture:!!f,A):zl(o,u,h,!0,f,A)}function Gl(o,u,h,f,A){if(Array.isArray(u))for(var S=0;S<u.length;S++)Gl(o,u[S],h,f,A);else f=d(f)?!!f.capture:!!f,h=Mo(h),o&&o[vr]?(o=o.i,u=String(u).toString(),u in o.g&&(S=o.g[u],h=Do(S,h,f,A),-1<h&&(Ci(S[h]),Array.prototype.splice.call(S,h,1),S.length==0&&(delete o.g[u],o.h--)))):o&&(o=Vo(o))&&(u=o.g[u.toString()],o=-1,u&&(o=Do(u,h,f,A)),(h=-1<o?u[o]:null)&&xo(h))}function xo(o){if(typeof o!="number"&&o&&!o.da){var u=o.src;if(u&&u[vr])ko(u.i,o);else{var h=o.type,f=o.proxy;u.removeEventListener?u.removeEventListener(h,f,o.capture):u.detachEvent?u.detachEvent(Kl(h),f):u.addListener&&u.removeListener&&u.removeListener(f),(h=Vo(u))?(ko(h,o),h.h==0&&(h.src=null,u[No]=null)):Ci(o)}}}function Kl(o){return o in Oo?Oo[o]:Oo[o]="on"+o}function Cg(o,u){if(o.da)o=!0;else{u=new yr(u,this);var h=o.listener,f=o.ha||o.src;o.fa&&xo(o),o=h.call(f,u)}return o}function Vo(o){return o=o[No],o instanceof ki?o:null}var Lo="__closure_events_fn_"+(1e9*Math.random()>>>0);function Mo(o){return typeof o=="function"?o:(o[Lo]||(o[Lo]=function(u){return o.handleEvent(u)}),o[Lo])}function Ie(){Rt.call(this),this.i=new ki(this),this.M=this,this.F=null}k(Ie,Rt),Ie.prototype[vr]=!0,Ie.prototype.removeEventListener=function(o,u,h,f){Gl(this,o,u,h,f)};function Se(o,u){var h,f=o.F;if(f)for(h=[];f;f=f.F)h.push(f);if(o=o.M,f=u.type||u,typeof u=="string")u=new ve(u,o);else if(u instanceof ve)u.target=u.target||o;else{var A=u;u=new ve(f,o),w(u,A)}if(A=!0,h)for(var S=h.length-1;0<=S;S--){var N=u.g=h[S];A=Di(N,f,!0,u)&&A}if(N=u.g=o,A=Di(N,f,!0,u)&&A,A=Di(N,f,!1,u)&&A,h)for(S=0;S<h.length;S++)N=u.g=h[S],A=Di(N,f,!1,u)&&A}Ie.prototype.N=function(){if(Ie.aa.N.call(this),this.i){var o=this.i,u;for(u in o.g){for(var h=o.g[u],f=0;f<h.length;f++)Ci(h[f]);delete o.g[u],o.h--}}this.F=null},Ie.prototype.K=function(o,u,h,f){return this.i.add(String(o),u,!1,h,f)},Ie.prototype.L=function(o,u,h,f){return this.i.add(String(o),u,!0,h,f)};function Di(o,u,h,f){if(u=o.i.g[String(u)],!u)return!0;u=u.concat();for(var A=!0,S=0;S<u.length;++S){var N=u[S];if(N&&!N.da&&N.capture==h){var Z=N.listener,ye=N.ha||N.src;N.fa&&ko(o.i,N),A=Z.call(ye,f)!==!1&&A}}return A&&!f.defaultPrevented}function Hl(o,u,h){if(typeof o=="function")h&&(o=I(o,h));else if(o&&typeof o.handleEvent=="function")o=I(o.handleEvent,o);else throw Error("Invalid listener argument");return 2147483647<Number(u)?-1:c.setTimeout(o,u||0)}function Ql(o){o.g=Hl(()=>{o.g=null,o.i&&(o.i=!1,Ql(o))},o.l);let u=o.h;o.h=null,o.m.apply(null,u)}class kg extends Rt{constructor(u,h){super(),this.m=u,this.l=h,this.h=null,this.i=!1,this.g=null}j(u){this.h=arguments,this.g?this.i=!0:Ql(this)}N(){super.N(),this.g&&(c.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ir(o){Rt.call(this),this.h=o,this.g={}}k(Ir,Rt);var Jl=[];function Yl(o){Y(o.g,function(u,h){this.g.hasOwnProperty(h)&&xo(u)},o),o.g={}}Ir.prototype.N=function(){Ir.aa.N.call(this),Yl(this)},Ir.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Fo=c.JSON.stringify,Dg=c.JSON.parse,Ng=class{stringify(o){return c.JSON.stringify(o,void 0)}parse(o){return c.JSON.parse(o,void 0)}};function Uo(){}Uo.prototype.h=null;function Xl(o){return o.h||(o.h=o.i())}function Zl(){}var wr={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function qo(){ve.call(this,"d")}k(qo,ve);function Bo(){ve.call(this,"c")}k(Bo,ve);var en={},eh=null;function Ni(){return eh=eh||new Ie}en.La="serverreachability";function th(o){ve.call(this,en.La,o)}k(th,ve);function Er(o){let u=Ni();Se(u,new th(u))}en.STAT_EVENT="statevent";function nh(o,u){ve.call(this,en.STAT_EVENT,o),this.stat=u}k(nh,ve);function Re(o){let u=Ni();Se(u,new nh(u,o))}en.Ma="timingevent";function rh(o,u){ve.call(this,en.Ma,o),this.size=u}k(rh,ve);function Tr(o,u){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return c.setTimeout(function(){o()},u)}function Ar(){this.g=!0}Ar.prototype.xa=function(){this.g=!1};function Og(o,u,h,f,A,S){o.info(function(){if(o.g)if(S)for(var N="",Z=S.split("&"),ye=0;ye<Z.length;ye++){var Q=Z[ye].split("=");if(1<Q.length){var we=Q[0];Q=Q[1];var Ee=we.split("_");N=2<=Ee.length&&Ee[1]=="type"?N+(we+"="+Q+"&"):N+(we+"=redacted&")}}else N=null;else N=S;return"XMLHTTP REQ ("+f+") [attempt "+A+"]: "+u+`
`+h+`
`+N})}function xg(o,u,h,f,A,S,N){o.info(function(){return"XMLHTTP RESP ("+f+") [ attempt "+A+"]: "+u+`
`+h+`
`+S+" "+N})}function Dn(o,u,h,f){o.info(function(){return"XMLHTTP TEXT ("+u+"): "+Lg(o,h)+(f?" "+f:"")})}function Vg(o,u){o.info(function(){return"TIMEOUT: "+u})}Ar.prototype.info=function(){};function Lg(o,u){if(!o.g)return u;if(!u)return null;try{var h=JSON.parse(u);if(h){for(o=0;o<h.length;o++)if(Array.isArray(h[o])){var f=h[o];if(!(2>f.length)){var A=f[1];if(Array.isArray(A)&&!(1>A.length)){var S=A[0];if(S!="noop"&&S!="stop"&&S!="close")for(var N=1;N<A.length;N++)A[N]=""}}}}return Fo(h)}catch{return u}}var Oi={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},ih={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},$o;function xi(){}k(xi,Uo),xi.prototype.g=function(){return new XMLHttpRequest},xi.prototype.i=function(){return{}},$o=new xi;function Pt(o,u,h,f){this.j=o,this.i=u,this.l=h,this.R=f||1,this.U=new Ir(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new sh}function sh(){this.i=null,this.g="",this.h=!1}var oh={},jo={};function zo(o,u,h){o.L=1,o.v=Fi(ht(u)),o.m=h,o.P=!0,ah(o,null)}function ah(o,u){o.F=Date.now(),Vi(o),o.A=ht(o.v);var h=o.A,f=o.R;Array.isArray(f)||(f=[String(f)]),wh(h.i,"t",f),o.C=0,h=o.j.J,o.h=new sh,o.g=Uh(o.j,h?u:null,!o.m),0<o.O&&(o.M=new kg(I(o.Y,o,o.g),o.O)),u=o.U,h=o.g,f=o.ca;var A="readystatechange";Array.isArray(A)||(A&&(Jl[0]=A.toString()),A=Jl);for(var S=0;S<A.length;S++){var N=jl(h,A[S],f||u.handleEvent,!1,u.h||u);if(!N)break;u.g[N.key]=N}u=o.H?g(o.H):{},o.m?(o.u||(o.u="POST"),u["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.A,o.u,o.m,u)):(o.u="GET",o.g.ea(o.A,o.u,null,u)),Er(),Og(o.i,o.u,o.A,o.l,o.R,o.m)}Pt.prototype.ca=function(o){o=o.target;let u=this.M;u&&dt(o)==3?u.j():this.Y(o)},Pt.prototype.Y=function(o){try{if(o==this.g)e:{let Ee=dt(this.g);var u=this.g.Ba();let xn=this.g.Z();if(!(3>Ee)&&(Ee!=3||this.g&&(this.h.h||this.g.oa()||Ph(this.g)))){this.J||Ee!=4||u==7||(u==8||0>=xn?Er(3):Er(2)),Wo(this);var h=this.g.Z();this.X=h;t:if(ch(this)){var f=Ph(this.g);o="";var A=f.length,S=dt(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){tn(this),br(this);var N="";break t}this.h.i=new c.TextDecoder}for(u=0;u<A;u++)this.h.h=!0,o+=this.h.i.decode(f[u],{stream:!(S&&u==A-1)});f.length=0,this.h.g+=o,this.C=0,N=this.h.g}else N=this.g.oa();if(this.o=h==200,xg(this.i,this.u,this.A,this.l,this.R,Ee,h),this.o){if(this.T&&!this.K){t:{if(this.g){var Z,ye=this.g;if((Z=ye.g?ye.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!U(Z)){var Q=Z;break t}}Q=null}if(h=Q)Dn(this.i,this.l,h,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Go(this,h);else{this.o=!1,this.s=3,Re(12),tn(this),br(this);break e}}if(this.P){h=!0;let $e;for(;!this.J&&this.C<N.length;)if($e=Mg(this,N),$e==jo){Ee==4&&(this.s=4,Re(14),h=!1),Dn(this.i,this.l,null,"[Incomplete Response]");break}else if($e==oh){this.s=4,Re(15),Dn(this.i,this.l,N,"[Invalid Chunk]"),h=!1;break}else Dn(this.i,this.l,$e,null),Go(this,$e);if(ch(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ee!=4||N.length!=0||this.h.h||(this.s=1,Re(16),h=!1),this.o=this.o&&h,!h)Dn(this.i,this.l,N,"[Invalid Chunked Response]"),tn(this),br(this);else if(0<N.length&&!this.W){this.W=!0;var we=this.j;we.g==this&&we.ba&&!we.M&&(we.j.info("Great, no buffering proxy detected. Bytes received: "+N.length),Xo(we),we.M=!0,Re(11))}}else Dn(this.i,this.l,N,null),Go(this,N);Ee==4&&tn(this),this.o&&!this.J&&(Ee==4?Vh(this.j,this):(this.o=!1,Vi(this)))}else e_(this.g),h==400&&0<N.indexOf("Unknown SID")?(this.s=3,Re(12)):(this.s=0,Re(13)),tn(this),br(this)}}}catch{}finally{}};function ch(o){return o.g?o.u=="GET"&&o.L!=2&&o.j.Ca:!1}function Mg(o,u){var h=o.C,f=u.indexOf(`
`,h);return f==-1?jo:(h=Number(u.substring(h,f)),isNaN(h)?oh:(f+=1,f+h>u.length?jo:(u=u.slice(f,f+h),o.C=f+h,u)))}Pt.prototype.cancel=function(){this.J=!0,tn(this)};function Vi(o){o.S=Date.now()+o.I,uh(o,o.I)}function uh(o,u){if(o.B!=null)throw Error("WatchDog timer not null");o.B=Tr(I(o.ba,o),u)}function Wo(o){o.B&&(c.clearTimeout(o.B),o.B=null)}Pt.prototype.ba=function(){this.B=null;let o=Date.now();0<=o-this.S?(Vg(this.i,this.A),this.L!=2&&(Er(),Re(17)),tn(this),this.s=2,br(this)):uh(this,this.S-o)};function br(o){o.j.G==0||o.J||Vh(o.j,o)}function tn(o){Wo(o);var u=o.M;u&&typeof u.ma=="function"&&u.ma(),o.M=null,Yl(o.U),o.g&&(u=o.g,o.g=null,u.abort(),u.ma())}function Go(o,u){try{var h=o.j;if(h.G!=0&&(h.g==o||Ko(h.h,o))){if(!o.K&&Ko(h.h,o)&&h.G==3){try{var f=h.Da.g.parse(u)}catch{f=null}if(Array.isArray(f)&&f.length==3){var A=f;if(A[0]==0){e:if(!h.u){if(h.g)if(h.g.F+3e3<o.F)ji(h),Bi(h);else break e;Yo(h),Re(18)}}else h.za=A[1],0<h.za-h.T&&37500>A[2]&&h.F&&h.v==0&&!h.C&&(h.C=Tr(I(h.Za,h),6e3));if(1>=dh(h.h)&&h.ca){try{h.ca()}catch{}h.ca=void 0}}else rn(h,11)}else if((o.K||h.g==o)&&ji(h),!U(u))for(A=h.Da.g.parse(u),u=0;u<A.length;u++){let Q=A[u];if(h.T=Q[0],Q=Q[1],h.G==2)if(Q[0]=="c"){h.K=Q[1],h.ia=Q[2];let we=Q[3];we!=null&&(h.la=we,h.j.info("VER="+h.la));let Ee=Q[4];Ee!=null&&(h.Aa=Ee,h.j.info("SVER="+h.Aa));let xn=Q[5];xn!=null&&typeof xn=="number"&&0<xn&&(f=1.5*xn,h.L=f,h.j.info("backChannelRequestTimeoutMs_="+f)),f=h;let $e=o.g;if($e){let Wi=$e.g?$e.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Wi){var S=f.h;S.g||Wi.indexOf("spdy")==-1&&Wi.indexOf("quic")==-1&&Wi.indexOf("h2")==-1||(S.j=S.l,S.g=new Set,S.h&&(Ho(S,S.h),S.h=null))}if(f.D){let Zo=$e.g?$e.g.getResponseHeader("X-HTTP-Session-Id"):null;Zo&&(f.ya=Zo,ee(f.I,f.D,Zo))}}h.G=3,h.l&&h.l.ua(),h.ba&&(h.R=Date.now()-o.F,h.j.info("Handshake RTT: "+h.R+"ms")),f=h;var N=o;if(f.qa=Fh(f,f.J?f.ia:null,f.W),N.K){fh(f.h,N);var Z=N,ye=f.L;ye&&(Z.I=ye),Z.B&&(Wo(Z),Vi(Z)),f.g=N}else Oh(f);0<h.i.length&&$i(h)}else Q[0]!="stop"&&Q[0]!="close"||rn(h,7);else h.G==3&&(Q[0]=="stop"||Q[0]=="close"?Q[0]=="stop"?rn(h,7):Jo(h):Q[0]!="noop"&&h.l&&h.l.ta(Q),h.v=0)}}Er(4)}catch{}}var Fg=class{constructor(o,u){this.g=o,this.map=u}};function lh(o){this.l=o||10,c.PerformanceNavigationTiming?(o=c.performance.getEntriesByType("navigation"),o=0<o.length&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(c.chrome&&c.chrome.loadTimes&&c.chrome.loadTimes()&&c.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function hh(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function dh(o){return o.h?1:o.g?o.g.size:0}function Ko(o,u){return o.h?o.h==u:o.g?o.g.has(u):!1}function Ho(o,u){o.g?o.g.add(u):o.h=u}function fh(o,u){o.h&&o.h==u?o.h=null:o.g&&o.g.has(u)&&o.g.delete(u)}lh.prototype.cancel=function(){if(this.i=ph(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let o of this.g.values())o.cancel();this.g.clear()}};function ph(o){if(o.h!=null)return o.i.concat(o.h.D);if(o.g!=null&&o.g.size!==0){let u=o.i;for(let h of o.g.values())u=u.concat(h.D);return u}return x(o.i)}function Ug(o){if(o.V&&typeof o.V=="function")return o.V();if(typeof Map<"u"&&o instanceof Map||typeof Set<"u"&&o instanceof Set)return Array.from(o.values());if(typeof o=="string")return o.split("");if(l(o)){for(var u=[],h=o.length,f=0;f<h;f++)u.push(o[f]);return u}u=[],h=0;for(f in o)u[h++]=o[f];return u}function qg(o){if(o.na&&typeof o.na=="function")return o.na();if(!o.V||typeof o.V!="function"){if(typeof Map<"u"&&o instanceof Map)return Array.from(o.keys());if(!(typeof Set<"u"&&o instanceof Set)){if(l(o)||typeof o=="string"){var u=[];o=o.length;for(var h=0;h<o;h++)u.push(h);return u}u=[],h=0;for(let f in o)u[h++]=f;return u}}}function mh(o,u){if(o.forEach&&typeof o.forEach=="function")o.forEach(u,void 0);else if(l(o)||typeof o=="string")Array.prototype.forEach.call(o,u,void 0);else for(var h=qg(o),f=Ug(o),A=f.length,S=0;S<A;S++)u.call(void 0,f[S],h&&h[S],o)}var gh=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Bg(o,u){if(o){o=o.split("&");for(var h=0;h<o.length;h++){var f=o[h].indexOf("="),A=null;if(0<=f){var S=o[h].substring(0,f);A=o[h].substring(f+1)}else S=o[h];u(S,A?decodeURIComponent(A.replace(/\+/g," ")):"")}}}function nn(o){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,o instanceof nn){this.h=o.h,Li(this,o.j),this.o=o.o,this.g=o.g,Mi(this,o.s),this.l=o.l;var u=o.i,h=new Pr;h.i=u.i,u.g&&(h.g=new Map(u.g),h.h=u.h),_h(this,h),this.m=o.m}else o&&(u=String(o).match(gh))?(this.h=!1,Li(this,u[1]||"",!0),this.o=Sr(u[2]||""),this.g=Sr(u[3]||"",!0),Mi(this,u[4]),this.l=Sr(u[5]||"",!0),_h(this,u[6]||"",!0),this.m=Sr(u[7]||"")):(this.h=!1,this.i=new Pr(null,this.h))}nn.prototype.toString=function(){var o=[],u=this.j;u&&o.push(Rr(u,yh,!0),":");var h=this.g;return(h||u=="file")&&(o.push("//"),(u=this.o)&&o.push(Rr(u,yh,!0),"@"),o.push(encodeURIComponent(String(h)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),h=this.s,h!=null&&o.push(":",String(h))),(h=this.l)&&(this.g&&h.charAt(0)!="/"&&o.push("/"),o.push(Rr(h,h.charAt(0)=="/"?zg:jg,!0))),(h=this.i.toString())&&o.push("?",h),(h=this.m)&&o.push("#",Rr(h,Gg)),o.join("")};function ht(o){return new nn(o)}function Li(o,u,h){o.j=h?Sr(u,!0):u,o.j&&(o.j=o.j.replace(/:$/,""))}function Mi(o,u){if(u){if(u=Number(u),isNaN(u)||0>u)throw Error("Bad port number "+u);o.s=u}else o.s=null}function _h(o,u,h){u instanceof Pr?(o.i=u,Kg(o.i,o.h)):(h||(u=Rr(u,Wg)),o.i=new Pr(u,o.h))}function ee(o,u,h){o.i.set(u,h)}function Fi(o){return ee(o,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),o}function Sr(o,u){return o?u?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function Rr(o,u,h){return typeof o=="string"?(o=encodeURI(o).replace(u,$g),h&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function $g(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var yh=/[#\/\?@]/g,jg=/[#\?:]/g,zg=/[#\?]/g,Wg=/[#\?@]/g,Gg=/#/g;function Pr(o,u){this.h=this.g=null,this.i=o||null,this.j=!!u}function Ct(o){o.g||(o.g=new Map,o.h=0,o.i&&Bg(o.i,function(u,h){o.add(decodeURIComponent(u.replace(/\+/g," ")),h)}))}n=Pr.prototype,n.add=function(o,u){Ct(this),this.i=null,o=Nn(this,o);var h=this.g.get(o);return h||this.g.set(o,h=[]),h.push(u),this.h+=1,this};function vh(o,u){Ct(o),u=Nn(o,u),o.g.has(u)&&(o.i=null,o.h-=o.g.get(u).length,o.g.delete(u))}function Ih(o,u){return Ct(o),u=Nn(o,u),o.g.has(u)}n.forEach=function(o,u){Ct(this),this.g.forEach(function(h,f){h.forEach(function(A){o.call(u,A,f,this)},this)},this)},n.na=function(){Ct(this);let o=Array.from(this.g.values()),u=Array.from(this.g.keys()),h=[];for(let f=0;f<u.length;f++){let A=o[f];for(let S=0;S<A.length;S++)h.push(u[f])}return h},n.V=function(o){Ct(this);let u=[];if(typeof o=="string")Ih(this,o)&&(u=u.concat(this.g.get(Nn(this,o))));else{o=Array.from(this.g.values());for(let h=0;h<o.length;h++)u=u.concat(o[h])}return u},n.set=function(o,u){return Ct(this),this.i=null,o=Nn(this,o),Ih(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[u]),this.h+=1,this},n.get=function(o,u){return o?(o=this.V(o),0<o.length?String(o[0]):u):u};function wh(o,u,h){vh(o,u),0<h.length&&(o.i=null,o.g.set(Nn(o,u),x(h)),o.h+=h.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let o=[],u=Array.from(this.g.keys());for(var h=0;h<u.length;h++){var f=u[h];let S=encodeURIComponent(String(f)),N=this.V(f);for(f=0;f<N.length;f++){var A=S;N[f]!==""&&(A+="="+encodeURIComponent(String(N[f]))),o.push(A)}}return this.i=o.join("&")};function Nn(o,u){return u=String(u),o.j&&(u=u.toLowerCase()),u}function Kg(o,u){u&&!o.j&&(Ct(o),o.i=null,o.g.forEach(function(h,f){var A=f.toLowerCase();f!=A&&(vh(this,f),wh(this,A,h))},o)),o.j=u}function Hg(o,u){let h=new Ar;if(c.Image){let f=new Image;f.onload=R(kt,h,"TestLoadImage: loaded",!0,u,f),f.onerror=R(kt,h,"TestLoadImage: error",!1,u,f),f.onabort=R(kt,h,"TestLoadImage: abort",!1,u,f),f.ontimeout=R(kt,h,"TestLoadImage: timeout",!1,u,f),c.setTimeout(function(){f.ontimeout&&f.ontimeout()},1e4),f.src=o}else u(!1)}function Qg(o,u){let h=new Ar,f=new AbortController,A=setTimeout(()=>{f.abort(),kt(h,"TestPingServer: timeout",!1,u)},1e4);fetch(o,{signal:f.signal}).then(S=>{clearTimeout(A),S.ok?kt(h,"TestPingServer: ok",!0,u):kt(h,"TestPingServer: server error",!1,u)}).catch(()=>{clearTimeout(A),kt(h,"TestPingServer: error",!1,u)})}function kt(o,u,h,f,A){try{A&&(A.onload=null,A.onerror=null,A.onabort=null,A.ontimeout=null),f(h)}catch{}}function Jg(){this.g=new Ng}function Yg(o,u,h){let f=h||"";try{mh(o,function(A,S){let N=A;d(A)&&(N=Fo(A)),u.push(f+S+"="+encodeURIComponent(N))})}catch(A){throw u.push(f+"type="+encodeURIComponent("_badmap")),A}}function Cr(o){this.l=o.Ub||null,this.j=o.eb||!1}k(Cr,Uo),Cr.prototype.g=function(){return new Ui(this.l,this.j)},Cr.prototype.i=(function(o){return function(){return o}})({});function Ui(o,u){Ie.call(this),this.D=o,this.o=u,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}k(Ui,Ie),n=Ui.prototype,n.open=function(o,u){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=o,this.A=u,this.readyState=1,Dr(this)},n.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let u={headers:this.u,method:this.B,credentials:this.m,cache:void 0};o&&(u.body=o),(this.D||c).fetch(new Request(this.A,u)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,kr(this)),this.readyState=0},n.Sa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,Dr(this)),this.g&&(this.readyState=3,Dr(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof c.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Eh(this)}else o.text().then(this.Ra.bind(this),this.ga.bind(this))};function Eh(o){o.j.read().then(o.Pa.bind(o)).catch(o.ga.bind(o))}n.Pa=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var u=o.value?o.value:new Uint8Array(0);(u=this.v.decode(u,{stream:!o.done}))&&(this.response=this.responseText+=u)}o.done?kr(this):Dr(this),this.readyState==3&&Eh(this)}},n.Ra=function(o){this.g&&(this.response=this.responseText=o,kr(this))},n.Qa=function(o){this.g&&(this.response=o,kr(this))},n.ga=function(){this.g&&kr(this)};function kr(o){o.readyState=4,o.l=null,o.j=null,o.v=null,Dr(o)}n.setRequestHeader=function(o,u){this.u.append(o,u)},n.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let o=[],u=this.h.entries();for(var h=u.next();!h.done;)h=h.value,o.push(h[0]+": "+h[1]),h=u.next();return o.join(`\r
`)};function Dr(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(Ui.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function Th(o){let u="";return Y(o,function(h,f){u+=f,u+=":",u+=h,u+=`\r
`}),u}function Qo(o,u,h){e:{for(f in h){var f=!1;break e}f=!0}f||(h=Th(h),typeof o=="string"?h!=null&&encodeURIComponent(String(h)):ee(o,u,h))}function ie(o){Ie.call(this),this.headers=new Map,this.o=o||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}k(ie,Ie);var Xg=/^https?$/i,Zg=["POST","PUT"];n=ie.prototype,n.Ha=function(o){this.J=o},n.ea=function(o,u,h,f){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);u=u?u.toUpperCase():"GET",this.D=o,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():$o.g(),this.v=this.o?Xl(this.o):Xl($o),this.g.onreadystatechange=I(this.Ea,this);try{this.B=!0,this.g.open(u,String(o),!0),this.B=!1}catch(S){Ah(this,S);return}if(o=h||"",h=new Map(this.headers),f)if(Object.getPrototypeOf(f)===Object.prototype)for(var A in f)h.set(A,f[A]);else if(typeof f.keys=="function"&&typeof f.get=="function")for(let S of f.keys())h.set(S,f.get(S));else throw Error("Unknown input type for opt_headers: "+String(f));f=Array.from(h.keys()).find(S=>S.toLowerCase()=="content-type"),A=c.FormData&&o instanceof c.FormData,!(0<=Array.prototype.indexOf.call(Zg,u,void 0))||f||A||h.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[S,N]of h)this.g.setRequestHeader(S,N);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Rh(this),this.u=!0,this.g.send(o),this.u=!1}catch(S){Ah(this,S)}};function Ah(o,u){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=u,o.m=5,bh(o),qi(o)}function bh(o){o.A||(o.A=!0,Se(o,"complete"),Se(o,"error"))}n.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=o||7,Se(this,"complete"),Se(this,"abort"),qi(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),qi(this,!0)),ie.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Sh(this):this.bb())},n.bb=function(){Sh(this)};function Sh(o){if(o.h&&typeof a<"u"&&(!o.v[1]||dt(o)!=4||o.Z()!=2)){if(o.u&&dt(o)==4)Hl(o.Ea,0,o);else if(Se(o,"readystatechange"),dt(o)==4){o.h=!1;try{let N=o.Z();e:switch(N){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var u=!0;break e;default:u=!1}var h;if(!(h=u)){var f;if(f=N===0){var A=String(o.D).match(gh)[1]||null;!A&&c.self&&c.self.location&&(A=c.self.location.protocol.slice(0,-1)),f=!Xg.test(A?A.toLowerCase():"")}h=f}if(h)Se(o,"complete"),Se(o,"success");else{o.m=6;try{var S=2<dt(o)?o.g.statusText:""}catch{S=""}o.l=S+" ["+o.Z()+"]",bh(o)}}finally{qi(o)}}}}function qi(o,u){if(o.g){Rh(o);let h=o.g,f=o.v[0]?()=>{}:null;o.g=null,o.v=null,u||Se(o,"ready");try{h.onreadystatechange=f}catch{}}}function Rh(o){o.I&&(c.clearTimeout(o.I),o.I=null)}n.isActive=function(){return!!this.g};function dt(o){return o.g?o.g.readyState:0}n.Z=function(){try{return 2<dt(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(o){if(this.g){var u=this.g.responseText;return o&&u.indexOf(o)==0&&(u=u.substring(o.length)),Dg(u)}};function Ph(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.H){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function e_(o){let u={};o=(o.g&&2<=dt(o)&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let f=0;f<o.length;f++){if(U(o[f]))continue;var h=T(o[f]);let A=h[0];if(h=h[1],typeof h!="string")continue;h=h.trim();let S=u[A]||[];u[A]=S,S.push(h)}E(u,function(f){return f.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Nr(o,u,h){return h&&h.internalChannelParams&&h.internalChannelParams[o]||u}function Ch(o){this.Aa=0,this.i=[],this.j=new Ar,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Nr("failFast",!1,o),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Nr("baseRetryDelayMs",5e3,o),this.cb=Nr("retryDelaySeedMs",1e4,o),this.Wa=Nr("forwardChannelMaxRetries",2,o),this.wa=Nr("forwardChannelRequestTimeoutMs",2e4,o),this.pa=o&&o.xmlHttpFactory||void 0,this.Xa=o&&o.Tb||void 0,this.Ca=o&&o.useFetchStreams||!1,this.L=void 0,this.J=o&&o.supportsCrossDomainXhr||!1,this.K="",this.h=new lh(o&&o.concurrentRequestLimit),this.Da=new Jg,this.P=o&&o.fastHandshake||!1,this.O=o&&o.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=o&&o.Rb||!1,o&&o.xa&&this.j.xa(),o&&o.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&o&&o.detectBufferingProxy||!1,this.ja=void 0,o&&o.longPollingTimeout&&0<o.longPollingTimeout&&(this.ja=o.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Ch.prototype,n.la=8,n.G=1,n.connect=function(o,u,h,f){Re(0),this.W=o,this.H=u||{},h&&f!==void 0&&(this.H.OSID=h,this.H.OAID=f),this.F=this.X,this.I=Fh(this,null,this.W),$i(this)};function Jo(o){if(kh(o),o.G==3){var u=o.U++,h=ht(o.I);if(ee(h,"SID",o.K),ee(h,"RID",u),ee(h,"TYPE","terminate"),Or(o,h),u=new Pt(o,o.j,u),u.L=2,u.v=Fi(ht(h)),h=!1,c.navigator&&c.navigator.sendBeacon)try{h=c.navigator.sendBeacon(u.v.toString(),"")}catch{}!h&&c.Image&&(new Image().src=u.v,h=!0),h||(u.g=Uh(u.j,null),u.g.ea(u.v)),u.F=Date.now(),Vi(u)}Mh(o)}function Bi(o){o.g&&(Xo(o),o.g.cancel(),o.g=null)}function kh(o){Bi(o),o.u&&(c.clearTimeout(o.u),o.u=null),ji(o),o.h.cancel(),o.s&&(typeof o.s=="number"&&c.clearTimeout(o.s),o.s=null)}function $i(o){if(!hh(o.h)&&!o.s){o.s=!0;var u=o.Ga;gr||$l(),_r||(gr(),_r=!0),Co.add(u,o),o.B=0}}function t_(o,u){return dh(o.h)>=o.h.j-(o.s?1:0)?!1:o.s?(o.i=u.D.concat(o.i),!0):o.G==1||o.G==2||o.B>=(o.Va?0:o.Wa)?!1:(o.s=Tr(I(o.Ga,o,u),Lh(o,o.B)),o.B++,!0)}n.Ga=function(o){if(this.s)if(this.s=null,this.G==1){if(!o){this.U=Math.floor(1e5*Math.random()),o=this.U++;let A=new Pt(this,this.j,o),S=this.o;if(this.S&&(S?(S=g(S),w(S,this.S)):S=this.S),this.m!==null||this.O||(A.H=S,S=null),this.P)e:{for(var u=0,h=0;h<this.i.length;h++){t:{var f=this.i[h];if("__data__"in f.map&&(f=f.map.__data__,typeof f=="string")){f=f.length;break t}f=void 0}if(f===void 0)break;if(u+=f,4096<u){u=h;break e}if(u===4096||h===this.i.length-1){u=h+1;break e}}u=1e3}else u=1e3;u=Nh(this,A,u),h=ht(this.I),ee(h,"RID",o),ee(h,"CVER",22),this.D&&ee(h,"X-HTTP-Session-Id",this.D),Or(this,h),S&&(this.O?u="headers="+encodeURIComponent(String(Th(S)))+"&"+u:this.m&&Qo(h,this.m,S)),Ho(this.h,A),this.Ua&&ee(h,"TYPE","init"),this.P?(ee(h,"$req",u),ee(h,"SID","null"),A.T=!0,zo(A,h,null)):zo(A,h,u),this.G=2}}else this.G==3&&(o?Dh(this,o):this.i.length==0||hh(this.h)||Dh(this))};function Dh(o,u){var h;u?h=u.l:h=o.U++;let f=ht(o.I);ee(f,"SID",o.K),ee(f,"RID",h),ee(f,"AID",o.T),Or(o,f),o.m&&o.o&&Qo(f,o.m,o.o),h=new Pt(o,o.j,h,o.B+1),o.m===null&&(h.H=o.o),u&&(o.i=u.D.concat(o.i)),u=Nh(o,h,1e3),h.I=Math.round(.5*o.wa)+Math.round(.5*o.wa*Math.random()),Ho(o.h,h),zo(h,f,u)}function Or(o,u){o.H&&Y(o.H,function(h,f){ee(u,f,h)}),o.l&&mh({},function(h,f){ee(u,f,h)})}function Nh(o,u,h){h=Math.min(o.i.length,h);var f=o.l?I(o.l.Na,o.l,o):null;e:{var A=o.i;let S=-1;for(;;){let N=["count="+h];S==-1?0<h?(S=A[0].g,N.push("ofs="+S)):S=0:N.push("ofs="+S);let Z=!0;for(let ye=0;ye<h;ye++){let Q=A[ye].g,we=A[ye].map;if(Q-=S,0>Q)S=Math.max(0,A[ye].g-100),Z=!1;else try{Yg(we,N,"req"+Q+"_")}catch{f&&f(we)}}if(Z){f=N.join("&");break e}}}return o=o.i.splice(0,h),u.D=o,f}function Oh(o){if(!o.g&&!o.u){o.Y=1;var u=o.Fa;gr||$l(),_r||(gr(),_r=!0),Co.add(u,o),o.v=0}}function Yo(o){return o.g||o.u||3<=o.v?!1:(o.Y++,o.u=Tr(I(o.Fa,o),Lh(o,o.v)),o.v++,!0)}n.Fa=function(){if(this.u=null,xh(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var o=2*this.R;this.j.info("BP detection timer enabled: "+o),this.A=Tr(I(this.ab,this),o)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Re(10),Bi(this),xh(this))};function Xo(o){o.A!=null&&(c.clearTimeout(o.A),o.A=null)}function xh(o){o.g=new Pt(o,o.j,"rpc",o.Y),o.m===null&&(o.g.H=o.o),o.g.O=0;var u=ht(o.qa);ee(u,"RID","rpc"),ee(u,"SID",o.K),ee(u,"AID",o.T),ee(u,"CI",o.F?"0":"1"),!o.F&&o.ja&&ee(u,"TO",o.ja),ee(u,"TYPE","xmlhttp"),Or(o,u),o.m&&o.o&&Qo(u,o.m,o.o),o.L&&(o.g.I=o.L);var h=o.g;o=o.ia,h.L=1,h.v=Fi(ht(u)),h.m=null,h.P=!0,ah(h,o)}n.Za=function(){this.C!=null&&(this.C=null,Bi(this),Yo(this),Re(19))};function ji(o){o.C!=null&&(c.clearTimeout(o.C),o.C=null)}function Vh(o,u){var h=null;if(o.g==u){ji(o),Xo(o),o.g=null;var f=2}else if(Ko(o.h,u))h=u.D,fh(o.h,u),f=1;else return;if(o.G!=0){if(u.o)if(f==1){h=u.m?u.m.length:0,u=Date.now()-u.F;var A=o.B;f=Ni(),Se(f,new rh(f,h)),$i(o)}else Oh(o);else if(A=u.s,A==3||A==0&&0<u.X||!(f==1&&t_(o,u)||f==2&&Yo(o)))switch(h&&0<h.length&&(u=o.h,u.i=u.i.concat(h)),A){case 1:rn(o,5);break;case 4:rn(o,10);break;case 3:rn(o,6);break;default:rn(o,2)}}}function Lh(o,u){let h=o.Ta+Math.floor(Math.random()*o.cb);return o.isActive()||(h*=2),h*u}function rn(o,u){if(o.j.info("Error code "+u),u==2){var h=I(o.fb,o),f=o.Xa;let A=!f;f=new nn(f||"//www.google.com/images/cleardot.gif"),c.location&&c.location.protocol=="http"||Li(f,"https"),Fi(f),A?Hg(f.toString(),h):Qg(f.toString(),h)}else Re(2);o.G=0,o.l&&o.l.sa(u),Mh(o),kh(o)}n.fb=function(o){o?(this.j.info("Successfully pinged google.com"),Re(2)):(this.j.info("Failed to ping google.com"),Re(1))};function Mh(o){if(o.G=0,o.ka=[],o.l){let u=ph(o.h);(u.length!=0||o.i.length!=0)&&(D(o.ka,u),D(o.ka,o.i),o.h.i.length=0,x(o.i),o.i.length=0),o.l.ra()}}function Fh(o,u,h){var f=h instanceof nn?ht(h):new nn(h);if(f.g!="")u&&(f.g=u+"."+f.g),Mi(f,f.s);else{var A=c.location;f=A.protocol,u=u?u+"."+A.hostname:A.hostname,A=+A.port;var S=new nn(null);f&&Li(S,f),u&&(S.g=u),A&&Mi(S,A),h&&(S.l=h),f=S}return h=o.D,u=o.ya,h&&u&&ee(f,h,u),ee(f,"VER",o.la),Or(o,f),f}function Uh(o,u,h){if(u&&!o.J)throw Error("Can't create secondary domain capable XhrIo object.");return u=o.Ca&&!o.pa?new ie(new Cr({eb:h})):new ie(o.pa),u.Ha(o.J),u}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function qh(){}n=qh.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function zi(){}zi.prototype.g=function(o,u){return new Oe(o,u)};function Oe(o,u){Ie.call(this),this.g=new Ch(u),this.l=o,this.h=u&&u.messageUrlParams||null,o=u&&u.messageHeaders||null,u&&u.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=u&&u.initMessageHeaders||null,u&&u.messageContentType&&(o?o["X-WebChannel-Content-Type"]=u.messageContentType:o={"X-WebChannel-Content-Type":u.messageContentType}),u&&u.va&&(o?o["X-WebChannel-Client-Profile"]=u.va:o={"X-WebChannel-Client-Profile":u.va}),this.g.S=o,(o=u&&u.Sb)&&!U(o)&&(this.g.m=o),this.v=u&&u.supportsCrossDomainXhr||!1,this.u=u&&u.sendRawJson||!1,(u=u&&u.httpSessionIdParam)&&!U(u)&&(this.g.D=u,o=this.h,o!==null&&u in o&&(o=this.h,u in o&&delete o[u])),this.j=new On(this)}k(Oe,Ie),Oe.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Oe.prototype.close=function(){Jo(this.g)},Oe.prototype.o=function(o){var u=this.g;if(typeof o=="string"){var h={};h.__data__=o,o=h}else this.u&&(h={},h.__data__=Fo(o),o=h);u.i.push(new Fg(u.Ya++,o)),u.G==3&&$i(u)},Oe.prototype.N=function(){this.g.l=null,delete this.j,Jo(this.g),delete this.g,Oe.aa.N.call(this)};function Bh(o){qo.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var u=o.__sm__;if(u){e:{for(let h in u){o=h;break e}o=void 0}(this.i=o)&&(o=this.i,u=u!==null&&o in u?u[o]:void 0),this.data=u}else this.data=o}k(Bh,qo);function $h(){Bo.call(this),this.status=1}k($h,Bo);function On(o){this.g=o}k(On,qh),On.prototype.ua=function(){Se(this.g,"a")},On.prototype.ta=function(o){Se(this.g,new Bh(o))},On.prototype.sa=function(o){Se(this.g,new $h)},On.prototype.ra=function(){Se(this.g,"b")},zi.prototype.createWebChannel=zi.prototype.g,Oe.prototype.send=Oe.prototype.o,Oe.prototype.open=Oe.prototype.m,Oe.prototype.close=Oe.prototype.close,bc=vt.createWebChannelTransport=function(){return new zi},Ac=vt.getStatEventTarget=function(){return Ni()},Tc=vt.Event=en,bs=vt.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Oi.NO_ERROR=0,Oi.TIMEOUT=8,Oi.HTTP_ERROR=6,ti=vt.ErrorCode=Oi,ih.COMPLETE="complete",Ec=vt.EventType=ih,Zl.EventType=wr,wr.OPEN="a",wr.CLOSE="b",wr.ERROR="c",wr.MESSAGE="d",Ie.prototype.listen=Ie.prototype.K,zn=vt.WebChannel=Zl,kw=vt.FetchXmlHttpFactory=Cr,ie.prototype.listenOnce=ie.prototype.L,ie.prototype.getLastError=ie.prototype.Ka,ie.prototype.getLastErrorCode=ie.prototype.Ba,ie.prototype.getStatus=ie.prototype.Z,ie.prototype.getResponseJson=ie.prototype.Oa,ie.prototype.getResponseText=ie.prototype.oa,ie.prototype.send=ie.prototype.ea,ie.prototype.setWithCredentials=ie.prototype.Ha,wc=vt.XhrIo=ie}).apply(typeof As<"u"?As:typeof self<"u"?self:typeof window<"u"?window:{});var Mf="@firebase/firestore",Ff="4.8.0";var ge=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};ge.UNAUTHENTICATED=new ge(null),ge.GOOGLE_CREDENTIALS=new ge("google-credentials-uid"),ge.FIRST_PARTY=new ge("first-party-uid"),ge.MOCK_USER=new ge("mock-user");var lr="11.10.0";var In=new Ze("@firebase/firestore");function Wn(){return In.logLevel}function V(n,...e){if(In.logLevel<=W.DEBUG){let t=e.map(fl);In.debug(`Firestore (${lr}): ${n}`,...t)}}function It(n,...e){if(In.logLevel<=W.ERROR){let t=e.map(fl);In.error(`Firestore (${lr}): ${n}`,...t)}}function Ht(n,...e){if(In.logLevel<=W.WARN){let t=e.map(fl);In.warn(`Firestore (${lr}): ${n}`,...t)}}function fl(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function M(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,kp(n,r,t)}function kp(n,e,t){let r=`FIRESTORE (${lr}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw It(r),new Error(r)}function J(n,e,t,r){let i="Unexpected state";typeof t=="string"?i=t:r=t,n||kp(e,i,r)}function q(n,e){return n}var P={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},O=class extends xe{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var Ke=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var Ns=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},kc=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ge.UNAUTHENTICATED))}shutdown(){}},Dc=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},Nc=class{constructor(e){this.t=e,this.currentUser=ge.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){J(this.o===void 0,42304);let r=this.i,i=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve(),s=new Ke;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Ke,e.enqueueRetryable(()=>i(this.currentUser))};let a=()=>{let l=s;e.enqueueRetryable(()=>m(this,null,function*(){yield l.promise,yield i(this.currentUser)}))},c=l=>{V("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(l=>c(l)),setTimeout(()=>{if(!this.auth){let l=this.t.getImmediate({optional:!0});l?c(l):(V("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Ke)}},0),a()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(V("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(J(typeof r.accessToken=="string",31837,{l:r}),new Ns(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return J(e===null||typeof e=="string",2055,{h:e}),new ge(e)}},Oc=class{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=ge.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}},xc=class{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new Oc(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(ge.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Os=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Vc=class{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,ke(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){J(this.o===void 0,3512);let r=s=>{s.error!=null&&V("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let a=s.token!==this.m;return this.m=s.token,V("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{V("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.V.getImmediate({optional:!0});s?i(s):V("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Os(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(J(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Os(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function Dw(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}function Dp(){return new TextEncoder}var ai=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516),r="";for(;r.length<20;){let i=Dw(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%62))}return r}};function z(n,e){return n<e?-1:n>e?1:0}function Lc(n,e){let t=0;for(;t<n.length&&t<e.length;){let r=n.codePointAt(t),i=e.codePointAt(t);if(r!==i){if(r<128&&i<128)return z(r,i);{let s=Dp(),a=Nw(s.encode(Uf(n,t)),s.encode(Uf(e,t)));return a!==0?a:z(r,i)}}t+=r>65535?2:1}return z(n.length,e.length)}function Uf(n,e){return n.codePointAt(e)>65535?n.substring(e,e+2):n.substring(e,e+1)}function Nw(n,e){for(let t=0;t<n.length&&t<e.length;++t)if(n[t]!==e[t])return z(n[t],e[t]);return z(n.length,e.length)}function Xn(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}var qf="__name__",xs=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&M(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&M(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=n.compareSegments(e.get(i),t.get(i));if(s!==0)return s}return z(e.length,t.length)}static compareSegments(e,t){let r=n.isNumericId(e),i=n.isNumericId(t);return r&&!i?-1:!r&&i?1:r&&i?n.extractNumericId(e).compare(n.extractNumericId(t)):Lc(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return yt.fromString(e.substring(4,e.length-2))}},re=class n extends xs{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new O(P.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},Ow=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Le=class n extends xs{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return Ow.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===qf}static keyField(){return new n([qf])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new O(P.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},a=!1;for(;i<e.length;){let c=e[i];if(c==="\\"){if(i+1===e.length)throw new O(P.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let l=e[i+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new O(P.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,i+=2}else c==="`"?(a=!a,i++):c!=="."||a?(r+=c,i++):(s(),i++)}if(s(),a)throw new O(P.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var L=class n{constructor(e){this.path=e}static fromPath(e){return new n(re.fromString(e))}static fromName(e){return new n(re.fromString(e).popFirst(5))}static empty(){return new n(re.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&re.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return re.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new re(e.slice()))}};function Np(n,e,t){if(!t)throw new O(P.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function xw(n,e,t,r){if(e===!0&&r===!0)throw new O(P.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Bf(n){if(!L.isDocumentKey(n))throw new O(P.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function $f(n){if(L.isDocumentKey(n))throw new O(P.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Op(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function fo(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=(function(r){return r.constructor?r.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":M(12329,{type:typeof n})}function De(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new O(P.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=fo(n);throw new O(P.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function Vw(n,e){if(e<=0)throw new O(P.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}function de(n,e){let t={typeString:n};return e&&(t.value=e),t}function Ti(n,e){if(!Op(n))throw new O(P.INVALID_ARGUMENT,"JSON must be an object");let t;for(let r in e)if(e[r]){let i=e[r].typeString,s="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}let a=n[r];if(i&&typeof a!==i){t=`JSON field '${r}' must be a ${i}.`;break}if(s!==void 0&&a!==s.value){t=`Expected '${r}' field to equal '${s.value}'`;break}}if(t)throw new O(P.INVALID_ARGUMENT,t);return!0}var jf=-62135596800,zf=1e6,K=class n{static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*zf);return new n(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new O(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new O(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<jf)throw new O(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new O(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/zf}_compareTo(e){return this.seconds===e.seconds?z(this.nanoseconds,e.nanoseconds):z(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:n._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Ti(e,n._jsonSchema))return new n(e.seconds,e.nanoseconds)}valueOf(){let e=this.seconds-jf;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};K._jsonSchemaVersion="firestore/timestamp/1.0",K._jsonSchema={type:de("string",K._jsonSchemaVersion),seconds:de("number"),nanoseconds:de("number")};var B=class n{static fromTimestamp(e){return new n(e)}static min(){return new n(new K(0,0))}static max(){return new n(new K(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var ci=-1,Mc=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};Mc.UNKNOWN_ID=-1;function Lw(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=B.fromTimestamp(r===1e9?new K(t+1,0):new K(t,r));return new wn(i,L.empty(),e)}function Mw(n){return new wn(n.readTime,n.key,ci)}var wn=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(B.min(),L.empty(),ci)}static max(){return new n(B.max(),L.empty(),ci)}};function Fw(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=L.comparator(n.documentKey,e.documentKey),t!==0?t:z(n.largestBatchId,e.largestBatchId))}var Uw="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Fc=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function hr(n){return m(this,null,function*(){if(n.code!==P.FAILED_PRECONDITION||n.message!==Uw)throw n;V("LocalStore","Unexpectedly lost primary lease")})}var C=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&M(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,a=!1;e.forEach(c=>{++i,c.next(()=>{++s,a&&s===i&&t()},l=>r(l))}),a=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,a=new Array(s),c=0;for(let l=0;l<s;l++){let d=l;t(e[d]).next(p=>{a[d]=p,++c,c===s&&r(a)},p=>i(p))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};function qw(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function dr(n){return n.name==="IndexedDbTransactionError"}var pl=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this._e(i),this.ae=i=>r.writeSequenceNumber(i))}_e(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.ae&&this.ae(t),t}}n.ue=-1;return n})(),ml=-1;function po(n){return n==null}function ui(n){return n===0&&1/n==-1/0}function Bw(n){return typeof n=="number"&&Number.isInteger(n)&&!ui(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var xp="";function $w(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Wf(e)),e=jw(n.get(t),e);return Wf(e)}function jw(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+="";break;case xp:t+="";break;default:t+=s}}return t}function Wf(n){return n+xp+""}var zw="remoteDocuments",Vp="owner";var Lp="mutationQueues";var Mp="mutations";var Fp="documentMutations",Ww="remoteDocumentsV14";var Up="remoteDocumentGlobal";var qp="targets";var Bp="targetDocuments";var $p="targetGlobal",jp="collectionParents";var zp="clientMetadata";var Wp="bundles";var Gp="namedQueries";var Gw="indexConfiguration";var Kw="indexState";var Hw="indexEntries";var Kp="documentOverlays";var Qw="globals";var Jw=[Lp,Mp,Fp,zw,qp,Vp,$p,Bp,zp,Up,jp,Wp,Gp],D0=[...Jw,Kp],Yw=[Lp,Mp,Fp,Ww,qp,Vp,$p,Bp,zp,Up,jp,Wp,Gp,Kp],Xw=Yw,Zw=[...Xw,Gw,Kw,Hw];var N0=[...Zw,Qw];function Gf(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Zt(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Hp(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var oe=class n{constructor(e,t){this.comparator=e,this.root=t||rt.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,rt.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,rt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Qn(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Qn(this.root,e,this.comparator,!1)}getReverseIterator(){return new Qn(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Qn(this.root,e,this.comparator,!0)}},Qn=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},rt=class n{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new n(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw M(43730,{key:this.key,value:this.value});if(this.right.isRed())throw M(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw M(27949);return e+(this.isRed()?0:1)}};rt.EMPTY=null,rt.RED=!0,rt.BLACK=!1;rt.EMPTY=new class{constructor(){this.size=0}get key(){throw M(57766)}get value(){throw M(16141)}get color(){throw M(16727)}get left(){throw M(29726)}get right(){throw M(36894)}copy(e,t,r,i,s){return this}insert(e,t,r){return new rt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var _e=class n{constructor(e){this.comparator=e,this.data=new oe(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Vs(this.data.getIterator())}getIteratorFrom(e){return new Vs(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},Vs=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var Be=class n{constructor(e){this.fields=e,e.sort(Le.comparator)}static empty(){return new n([])}unionWith(e){let t=new _e(Le.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Xn(this.fields,e.fields,(t,r)=>t.isEqual(r))}};var Ls=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var Ae=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=(function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Ls("Invalid base64 string: "+s):s}})(e);return new n(t)}static fromUint8Array(e){let t=(function(i){let s="";for(let a=0;a<i.length;++a)s+=String.fromCharCode(i[a]);return s})(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return z(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Ae.EMPTY_BYTE_STRING=new Ae("");var eE=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function wt(n){if(J(!!n,39018),typeof n=="string"){let e=0,t=eE.exec(n);if(J(!!t,46558,{timestamp:n}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:ne(n.seconds),nanos:ne(n.nanos)}}function ne(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Et(n){return typeof n=="string"?Ae.fromBase64String(n):Ae.fromUint8Array(n)}var Qp="server_timestamp",Jp="__type__",Yp="__previous_value__",Xp="__local_write_time__";function gl(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[Jp])===null||t===void 0?void 0:t.stringValue)===Qp}function mo(n){let e=n.mapValue.fields[Yp];return gl(e)?mo(e):e}function li(n){let e=wt(n.mapValue.fields[Xp].timestampValue);return new K(e.seconds,e.nanos)}var Uc=class{constructor(e,t,r,i,s,a,c,l,d,p){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=c,this.longPollingOptions=l,this.useFetchStreams=d,this.isUsingEmulator=p}},Ms="(default)",Fs=class n{constructor(e,t){this.projectId=e,this.database=t||Ms}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===Ms}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var _l="__type__",Zp="__max__",Ss={mapValue:{fields:{__type__:{stringValue:Zp}}}},yl="__vector__",Zn="value";function Qt(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?gl(n)?4:tm(n)?9007199254740991:em(n)?10:11:M(28295,{value:n})}function at(n,e){if(n===e)return!0;let t=Qt(n);if(t!==Qt(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return li(n).isEqual(li(e));case 3:return(function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let a=wt(i.timestampValue),c=wt(s.timestampValue);return a.seconds===c.seconds&&a.nanos===c.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(i,s){return Et(i.bytesValue).isEqual(Et(s.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(i,s){return ne(i.geoPointValue.latitude)===ne(s.geoPointValue.latitude)&&ne(i.geoPointValue.longitude)===ne(s.geoPointValue.longitude)})(n,e);case 2:return(function(i,s){if("integerValue"in i&&"integerValue"in s)return ne(i.integerValue)===ne(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let a=ne(i.doubleValue),c=ne(s.doubleValue);return a===c?ui(a)===ui(c):isNaN(a)&&isNaN(c)}return!1})(n,e);case 9:return Xn(n.arrayValue.values||[],e.arrayValue.values||[],at);case 10:case 11:return(function(i,s){let a=i.mapValue.fields||{},c=s.mapValue.fields||{};if(Gf(a)!==Gf(c))return!1;for(let l in a)if(a.hasOwnProperty(l)&&(c[l]===void 0||!at(a[l],c[l])))return!1;return!0})(n,e);default:return M(52216,{left:n})}}function hi(n,e){return(n.values||[]).find(t=>at(t,e))!==void 0}function er(n,e){if(n===e)return 0;let t=Qt(n),r=Qt(e);if(t!==r)return z(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return z(n.booleanValue,e.booleanValue);case 2:return(function(s,a){let c=ne(s.integerValue||s.doubleValue),l=ne(a.integerValue||a.doubleValue);return c<l?-1:c>l?1:c===l?0:isNaN(c)?isNaN(l)?0:-1:1})(n,e);case 3:return Kf(n.timestampValue,e.timestampValue);case 4:return Kf(li(n),li(e));case 5:return Lc(n.stringValue,e.stringValue);case 6:return(function(s,a){let c=Et(s),l=Et(a);return c.compareTo(l)})(n.bytesValue,e.bytesValue);case 7:return(function(s,a){let c=s.split("/"),l=a.split("/");for(let d=0;d<c.length&&d<l.length;d++){let p=z(c[d],l[d]);if(p!==0)return p}return z(c.length,l.length)})(n.referenceValue,e.referenceValue);case 8:return(function(s,a){let c=z(ne(s.latitude),ne(a.latitude));return c!==0?c:z(ne(s.longitude),ne(a.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return Hf(n.arrayValue,e.arrayValue);case 10:return(function(s,a){var c,l,d,p;let _=s.fields||{},I=a.fields||{},R=(c=_[Zn])===null||c===void 0?void 0:c.arrayValue,k=(l=I[Zn])===null||l===void 0?void 0:l.arrayValue,x=z(((d=R?.values)===null||d===void 0?void 0:d.length)||0,((p=k?.values)===null||p===void 0?void 0:p.length)||0);return x!==0?x:Hf(R,k)})(n.mapValue,e.mapValue);case 11:return(function(s,a){if(s===Ss.mapValue&&a===Ss.mapValue)return 0;if(s===Ss.mapValue)return 1;if(a===Ss.mapValue)return-1;let c=s.fields||{},l=Object.keys(c),d=a.fields||{},p=Object.keys(d);l.sort(),p.sort();for(let _=0;_<l.length&&_<p.length;++_){let I=Lc(l[_],p[_]);if(I!==0)return I;let R=er(c[l[_]],d[p[_]]);if(R!==0)return R}return z(l.length,p.length)})(n.mapValue,e.mapValue);default:throw M(23264,{le:t})}}function Kf(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return z(n,e);let t=wt(n),r=wt(e),i=z(t.seconds,r.seconds);return i!==0?i:z(t.nanos,r.nanos)}function Hf(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=er(t[i],r[i]);if(s)return s}return z(t.length,r.length)}function tr(n){return qc(n)}function qc(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){let r=wt(t);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return Et(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return L.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let r="[",i=!0;for(let s of t.values||[])i?i=!1:r+=",",r+=qc(s);return r+"]"})(n.arrayValue):"mapValue"in n?(function(t){let r=Object.keys(t.fields||{}).sort(),i="{",s=!0;for(let a of r)s?s=!1:i+=",",i+=`${a}:${qc(t.fields[a])}`;return i+"}"})(n.mapValue):M(61005,{value:n})}function Cs(n){switch(Qt(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let e=mo(n);return e?16+Cs(e):16;case 5:return 2*n.stringValue.length;case 6:return Et(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce((i,s)=>i+Cs(s),0)})(n.arrayValue);case 10:case 11:return(function(r){let i=0;return Zt(r.fields,(s,a)=>{i+=s.length+Cs(a)}),i})(n.mapValue);default:throw M(13486,{value:n})}}function Qf(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Bc(n){return!!n&&"integerValue"in n}function vl(n){return!!n&&"arrayValue"in n}function Jf(n){return!!n&&"nullValue"in n}function Yf(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function ks(n){return!!n&&"mapValue"in n}function em(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[_l])===null||t===void 0?void 0:t.stringValue)===yl}function ri(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return Zt(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=ri(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=ri(n.arrayValue.values[t]);return e}return Object.assign({},n)}function tm(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===Zp}var x0={mapValue:{fields:{[_l]:{stringValue:yl},[Zn]:{arrayValue:{}}}}};var Ve=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!ks(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ri(t)}setAll(e){let t=Le.emptyPath(),r={},i=[];e.forEach((a,c)=>{if(!t.isImmediateParentOf(c)){let l=this.getFieldsMap(t);this.applyChanges(l,r,i),r={},i=[],t=c.popLast()}a?r[c.lastSegment()]=ri(a):i.push(c.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());ks(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return at(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];ks(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Zt(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(ri(this.value))}};function nm(n){let e=[];return Zt(n.fields,(t,r)=>{let i=new Le([t]);if(ks(r)){let s=nm(r.mapValue).fields;if(s.length===0)e.push(i);else for(let a of s)e.push(i.child(a))}else e.push(i)}),new Be(e)}var He=class n{constructor(e,t,r,i,s,a,c){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=a,this.documentState=c}static newInvalidDocument(e){return new n(e,0,B.min(),B.min(),B.min(),Ve.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,B.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,B.min(),B.min(),Ve.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,B.min(),B.min(),Ve.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(B.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ve.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ve.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=B.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var nr=class{constructor(e,t){this.position=e,this.inclusive=t}};function Xf(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],a=n.position[i];if(s.field.isKeyField()?r=L.comparator(L.fromName(a.referenceValue),t.key):r=er(a,t.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function Zf(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!at(n.position[t],e.position[t]))return!1;return!0}var En=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function tE(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var Us=class{},he=class n extends Us{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new jc(e,t,r):t==="array-contains"?new Gc(e,r):t==="in"?new Kc(e,r):t==="not-in"?new Hc(e,r):t==="array-contains-any"?new Qc(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new zc(e,r):new Wc(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(er(t,this.value)):t!==null&&Qt(this.value)===Qt(t)&&this.matchesComparison(er(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return M(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Qe=class n extends Us{constructor(e,t){super(),this.filters=e,this.op=t,this.he=null}static create(e,t){return new n(e,t)}matches(e){return rm(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.he!==null||(this.he=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.he}getFilters(){return Object.assign([],this.filters)}};function rm(n){return n.op==="and"}function im(n){return nE(n)&&rm(n)}function nE(n){for(let e of n.filters)if(e instanceof Qe)return!1;return!0}function $c(n){if(n instanceof he)return n.field.canonicalString()+n.op.toString()+tr(n.value);if(im(n))return n.filters.map(e=>$c(e)).join(",");{let e=n.filters.map(t=>$c(t)).join(",");return`${n.op}(${e})`}}function sm(n,e){return n instanceof he?(function(r,i){return i instanceof he&&r.op===i.op&&r.field.isEqual(i.field)&&at(r.value,i.value)})(n,e):n instanceof Qe?(function(r,i){return i instanceof Qe&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,a,c)=>s&&sm(a,i.filters[c]),!0):!1})(n,e):void M(19439)}function om(n){return n instanceof he?(function(t){return`${t.field.canonicalString()} ${t.op} ${tr(t.value)}`})(n):n instanceof Qe?(function(t){return t.op.toString()+" {"+t.getFilters().map(om).join(" ,")+"}"})(n):"Filter"}var jc=class extends he{constructor(e,t,r){super(e,t,r),this.key=L.fromName(r.referenceValue)}matches(e){let t=L.comparator(e.key,this.key);return this.matchesComparison(t)}},zc=class extends he{constructor(e,t){super(e,"in",t),this.keys=am("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},Wc=class extends he{constructor(e,t){super(e,"not-in",t),this.keys=am("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function am(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>L.fromName(r.referenceValue))}var Gc=class extends he{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return vl(t)&&hi(t.arrayValue,this.value)}},Kc=class extends he{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&hi(this.value.arrayValue,t)}},Hc=class extends he{constructor(e,t){super(e,"not-in",t)}matches(e){if(hi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!hi(this.value.arrayValue,t)}},Qc=class extends he{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!vl(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>hi(this.value.arrayValue,r))}};var Jc=class{constructor(e,t=null,r=[],i=[],s=null,a=null,c=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=a,this.endAt=c,this.Pe=null}};function ep(n,e=null,t=[],r=[],i=null,s=null,a=null){return new Jc(n,e,t,r,i,s,a)}function Il(n){let e=q(n);if(e.Pe===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>$c(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>(function(s){return s.field.canonicalString()+s.dir})(r)).join(","),po(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>tr(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>tr(r)).join(",")),e.Pe=t}return e.Pe}function wl(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!tE(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!sm(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Zf(n.startAt,e.startAt)&&Zf(n.endAt,e.endAt)}function Yc(n){return L.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}var Jt=class{constructor(e,t=null,r=[],i=[],s=null,a="F",c=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=a,this.startAt=c,this.endAt=l,this.Te=null,this.Ie=null,this.de=null,this.startAt,this.endAt}};function rE(n,e,t,r,i,s,a,c){return new Jt(n,e,t,r,i,s,a,c)}function go(n){return new Jt(n)}function tp(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function cm(n){return n.collectionGroup!==null}function ii(n){let e=q(n);if(e.Te===null){e.Te=[];let t=new Set;for(let s of e.explicitOrderBy)e.Te.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let c=new _e(Le.comparator);return a.filters.forEach(l=>{l.getFlattenedFilters().forEach(d=>{d.isInequality()&&(c=c.add(d.field))})}),c})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.Te.push(new En(s,r))}),t.has(Le.keyField().canonicalString())||e.Te.push(new En(Le.keyField(),r))}return e.Te}function it(n){let e=q(n);return e.Ie||(e.Ie=iE(e,ii(n))),e.Ie}function iE(n,e){if(n.limitType==="F")return ep(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new En(i.field,s)});let t=n.endAt?new nr(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new nr(n.startAt.position,n.startAt.inclusive):null;return ep(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Xc(n,e){let t=n.filters.concat([e]);return new Jt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function qs(n,e,t){return new Jt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function _o(n,e){return wl(it(n),it(e))&&n.limitType===e.limitType}function um(n){return`${Il(it(n))}|lt:${n.limitType}`}function Gn(n){return`Query(target=${(function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>om(i)).join(", ")}]`),po(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>tr(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>tr(i)).join(",")),`Target(${r})`})(it(n))}; limitType=${n.limitType})`}function yo(n,e){return e.isFoundDocument()&&(function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):L.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)})(n,e)&&(function(r,i){for(let s of ii(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0})(n,e)&&(function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0})(n,e)&&(function(r,i){return!(r.startAt&&!(function(a,c,l){let d=Xf(a,c,l);return a.inclusive?d<=0:d<0})(r.startAt,ii(r),i)||r.endAt&&!(function(a,c,l){let d=Xf(a,c,l);return a.inclusive?d>=0:d>0})(r.endAt,ii(r),i))})(n,e)}function sE(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function lm(n){return(e,t)=>{let r=!1;for(let i of ii(n)){let s=oE(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function oE(n,e,t){let r=n.field.isKeyField()?L.comparator(e.key,t.key):(function(s,a,c){let l=a.data.field(s),d=c.data.field(s);return l!==null&&d!==null?er(l,d):M(42886)})(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return M(19790,{direction:n.dir})}}var Tt=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Zt(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return Hp(this.inner)}size(){return this.innerSize}};var aE=new oe(L.comparator);function At(){return aE}var hm=new oe(L.comparator);function ni(...n){let e=hm;for(let t of n)e=e.insert(t.key,t);return e}function dm(n){let e=hm;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function mn(){return si()}function fm(){return si()}function si(){return new Tt(n=>n.toString(),(n,e)=>n.isEqual(e))}var cE=new oe(L.comparator),uE=new _e(L.comparator);function G(...n){let e=uE;for(let t of n)e=e.add(t);return e}var lE=new _e(z);function hE(){return lE}function El(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ui(e)?"-0":e}}function pm(n){return{integerValue:""+n}}function dE(n,e){return Bw(e)?pm(e):El(n,e)}var rr=class{constructor(){this._=void 0}};function fE(n,e,t){return n instanceof ir?(function(i,s){let a={fields:{[Jp]:{stringValue:Qp},[Xp]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&gl(s)&&(s=mo(s)),s&&(a.fields[Yp]=s),{mapValue:a}})(t,e):n instanceof Tn?gm(n,e):n instanceof An?_m(n,e):(function(i,s){let a=mm(i,s),c=np(a)+np(i.Ee);return Bc(a)&&Bc(i.Ee)?pm(c):El(i.serializer,c)})(n,e)}function pE(n,e,t){return n instanceof Tn?gm(n,e):n instanceof An?_m(n,e):t}function mm(n,e){return n instanceof sr?(function(r){return Bc(r)||(function(s){return!!s&&"doubleValue"in s})(r)})(e)?e:{integerValue:0}:null}var ir=class extends rr{},Tn=class extends rr{constructor(e){super(),this.elements=e}};function gm(n,e){let t=ym(e);for(let r of n.elements)t.some(i=>at(i,r))||t.push(r);return{arrayValue:{values:t}}}var An=class extends rr{constructor(e){super(),this.elements=e}};function _m(n,e){let t=ym(e);for(let r of n.elements)t=t.filter(i=>!at(i,r));return{arrayValue:{values:t}}}var sr=class extends rr{constructor(e,t){super(),this.serializer=e,this.Ee=t}};function np(n){return ne(n.integerValue||n.doubleValue)}function ym(n){return vl(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function mE(n,e){return n.field.isEqual(e.field)&&(function(r,i){return r instanceof Tn&&i instanceof Tn||r instanceof An&&i instanceof An?Xn(r.elements,i.elements,at):r instanceof sr&&i instanceof sr?at(r.Ee,i.Ee):r instanceof ir&&i instanceof ir})(n.transform,e.transform)}var Zc=class{constructor(e,t){this.version=e,this.transformResults=t}},st=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function Ds(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var or=class{};function vm(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new di(n.key,st.none()):new bn(n.key,n.data,st.none());{let t=n.data,r=Ve.empty(),i=new _e(Le.comparator);for(let s of e.fields)if(!i.has(s)){let a=t.field(s);a===null&&s.length>1&&(s=s.popLast(),a=t.field(s)),a===null?r.delete(s):r.set(s,a),i=i.add(s)}return new ct(n.key,r,new Be(i.toArray()),st.none())}}function gE(n,e,t){n instanceof bn?(function(i,s,a){let c=i.value.clone(),l=ip(i.fieldTransforms,s,a.transformResults);c.setAll(l),s.convertToFoundDocument(a.version,c).setHasCommittedMutations()})(n,e,t):n instanceof ct?(function(i,s,a){if(!Ds(i.precondition,s))return void s.convertToUnknownDocument(a.version);let c=ip(i.fieldTransforms,s,a.transformResults),l=s.data;l.setAll(Im(i)),l.setAll(c),s.convertToFoundDocument(a.version,l).setHasCommittedMutations()})(n,e,t):(function(i,s,a){s.convertToNoDocument(a.version).setHasCommittedMutations()})(0,e,t)}function oi(n,e,t,r){return n instanceof bn?(function(s,a,c,l){if(!Ds(s.precondition,a))return c;let d=s.value.clone(),p=sp(s.fieldTransforms,l,a);return d.setAll(p),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null})(n,e,t,r):n instanceof ct?(function(s,a,c,l){if(!Ds(s.precondition,a))return c;let d=sp(s.fieldTransforms,l,a),p=a.data;return p.setAll(Im(s)),p.setAll(d),a.convertToFoundDocument(a.version,p).setHasLocalMutations(),c===null?null:c.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(_=>_.field))})(n,e,t,r):(function(s,a,c){return Ds(s.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):c})(n,e,t)}function _E(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=mm(r.transform,i||null);s!=null&&(t===null&&(t=Ve.empty()),t.set(r.field,s))}return t||null}function rp(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&Xn(r,i,(s,a)=>mE(s,a))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var bn=class extends or{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},ct=class extends or{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function Im(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function ip(n,e,t){let r=new Map;J(n.length===t.length,32656,{Ae:t.length,Re:n.length});for(let i=0;i<t.length;i++){let s=n[i],a=s.transform,c=e.data.field(s.field);r.set(s.field,pE(a,c,t[i]))}return r}function sp(n,e,t){let r=new Map;for(let i of n){let s=i.transform,a=t.data.field(i.field);r.set(i.field,fE(s,a,e))}return r}var di=class extends or{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},eu=class extends or{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var tu=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&gE(s,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=oi(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=oi(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=fm();return this.mutations.forEach(i=>{let s=e.get(i.key),a=s.overlayedDocument,c=this.applyToLocalView(a,s.mutatedFields);c=t.has(i.key)?null:c;let l=vm(a,c);l!==null&&r.set(i.key,l),a.isValidDocument()||a.convertToNoDocument(B.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),G())}isEqual(e){return this.batchId===e.batchId&&Xn(this.mutations,e.mutations,(t,r)=>rp(t,r))&&Xn(this.baseMutations,e.baseMutations,(t,r)=>rp(t,r))}},nu=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){J(e.mutations.length===r.length,58842,{Ve:e.mutations.length,me:r.length});let i=(function(){return cE})(),s=e.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,r[a].version);return new n(e,t,r,i)}};var ru=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var iu=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var ue,H;function yE(n){switch(n){case P.OK:return M(64938);case P.CANCELLED:case P.UNKNOWN:case P.DEADLINE_EXCEEDED:case P.RESOURCE_EXHAUSTED:case P.INTERNAL:case P.UNAVAILABLE:case P.UNAUTHENTICATED:return!1;case P.INVALID_ARGUMENT:case P.NOT_FOUND:case P.ALREADY_EXISTS:case P.PERMISSION_DENIED:case P.FAILED_PRECONDITION:case P.ABORTED:case P.OUT_OF_RANGE:case P.UNIMPLEMENTED:case P.DATA_LOSS:return!0;default:return M(15467,{code:n})}}function wm(n){if(n===void 0)return It("GRPC error has no .code"),P.UNKNOWN;switch(n){case ue.OK:return P.OK;case ue.CANCELLED:return P.CANCELLED;case ue.UNKNOWN:return P.UNKNOWN;case ue.DEADLINE_EXCEEDED:return P.DEADLINE_EXCEEDED;case ue.RESOURCE_EXHAUSTED:return P.RESOURCE_EXHAUSTED;case ue.INTERNAL:return P.INTERNAL;case ue.UNAVAILABLE:return P.UNAVAILABLE;case ue.UNAUTHENTICATED:return P.UNAUTHENTICATED;case ue.INVALID_ARGUMENT:return P.INVALID_ARGUMENT;case ue.NOT_FOUND:return P.NOT_FOUND;case ue.ALREADY_EXISTS:return P.ALREADY_EXISTS;case ue.PERMISSION_DENIED:return P.PERMISSION_DENIED;case ue.FAILED_PRECONDITION:return P.FAILED_PRECONDITION;case ue.ABORTED:return P.ABORTED;case ue.OUT_OF_RANGE:return P.OUT_OF_RANGE;case ue.UNIMPLEMENTED:return P.UNIMPLEMENTED;case ue.DATA_LOSS:return P.DATA_LOSS;default:return M(39323,{code:n})}}(H=ue||(ue={}))[H.OK=0]="OK",H[H.CANCELLED=1]="CANCELLED",H[H.UNKNOWN=2]="UNKNOWN",H[H.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",H[H.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",H[H.NOT_FOUND=5]="NOT_FOUND",H[H.ALREADY_EXISTS=6]="ALREADY_EXISTS",H[H.PERMISSION_DENIED=7]="PERMISSION_DENIED",H[H.UNAUTHENTICATED=16]="UNAUTHENTICATED",H[H.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",H[H.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",H[H.ABORTED=10]="ABORTED",H[H.OUT_OF_RANGE=11]="OUT_OF_RANGE",H[H.UNIMPLEMENTED=12]="UNIMPLEMENTED",H[H.INTERNAL=13]="INTERNAL",H[H.UNAVAILABLE=14]="UNAVAILABLE",H[H.DATA_LOSS=15]="DATA_LOSS";var op=null;var vE=new yt([4294967295,4294967295],0);function ap(n){let e=Dp().encode(n),t=new Ic;return t.update(e),new Uint8Array(t.digest())}function cp(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new yt([t,r],0),new yt([i,s],0)]}var su=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new gn(`Invalid padding: ${t}`);if(r<0)throw new gn(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new gn(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new gn(`Invalid padding when bitmap length is 0: ${t}`);this.fe=8*e.length-t,this.ge=yt.fromNumber(this.fe)}pe(e,t,r){let i=e.add(t.multiply(yt.fromNumber(r)));return i.compare(vE)===1&&(i=new yt([i.getBits(0),i.getBits(1)],0)),i.modulo(this.ge).toNumber()}ye(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.fe===0)return!1;let t=ap(e),[r,i]=cp(t);for(let s=0;s<this.hashCount;s++){let a=this.pe(r,i,s);if(!this.ye(a))return!1}return!0}static create(e,t,r){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),a=new n(s,i,t);return r.forEach(c=>a.insert(c)),a}insert(e){if(this.fe===0)return;let t=ap(e),[r,i]=cp(t);for(let s=0;s<this.hashCount;s++){let a=this.pe(r,i,s);this.we(a)}}we(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},gn=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Bs=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,fi.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(B.min(),i,new oe(z),At(),G())}},fi=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,G(),G(),G())}};var Jn=class{constructor(e,t,r,i){this.Se=e,this.removedTargetIds=t,this.key=r,this.be=i}},$s=class{constructor(e,t){this.targetId=e,this.De=t}},js=class{constructor(e,t,r=Ae.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},zs=class{constructor(){this.ve=0,this.Ce=up(),this.Fe=Ae.EMPTY_BYTE_STRING,this.Me=!1,this.xe=!0}get current(){return this.Me}get resumeToken(){return this.Fe}get Oe(){return this.ve!==0}get Ne(){return this.xe}Be(e){e.approximateByteSize()>0&&(this.xe=!0,this.Fe=e)}Le(){let e=G(),t=G(),r=G();return this.Ce.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:M(38017,{changeType:s})}}),new fi(this.Fe,this.Me,e,t,r)}ke(){this.xe=!1,this.Ce=up()}qe(e,t){this.xe=!0,this.Ce=this.Ce.insert(e,t)}Qe(e){this.xe=!0,this.Ce=this.Ce.remove(e)}$e(){this.ve+=1}Ue(){this.ve-=1,J(this.ve>=0,3241,{ve:this.ve})}Ke(){this.xe=!0,this.Me=!0}},ou=class{constructor(e){this.We=e,this.Ge=new Map,this.ze=At(),this.je=Rs(),this.Je=Rs(),this.He=new oe(z)}Ye(e){for(let t of e.Se)e.be&&e.be.isFoundDocument()?this.Ze(t,e.be):this.Xe(t,e.key,e.be);for(let t of e.removedTargetIds)this.Xe(t,e.key,e.be)}et(e){this.forEachTarget(e,t=>{let r=this.tt(t);switch(e.state){case 0:this.nt(t)&&r.Be(e.resumeToken);break;case 1:r.Ue(),r.Oe||r.ke(),r.Be(e.resumeToken);break;case 2:r.Ue(),r.Oe||this.removeTarget(t);break;case 3:this.nt(t)&&(r.Ke(),r.Be(e.resumeToken));break;case 4:this.nt(t)&&(this.rt(t),r.Be(e.resumeToken));break;default:M(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Ge.forEach((r,i)=>{this.nt(i)&&t(i)})}it(e){let t=e.targetId,r=e.De.count,i=this.st(t);if(i){let s=i.target;if(Yc(s))if(r===0){let a=new L(s.path);this.Xe(t,a,He.newNoDocument(a,B.min()))}else J(r===1,20013,{expectedCount:r});else{let a=this.ot(t);if(a!==r){let c=this._t(e),l=c?this.ut(c,e,a):1;if(l!==0){this.rt(t);let d=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.He=this.He.insert(t,d)}op?.ct((function(p,_,I,R,k){var x,D,$,U,j,X;let be={localCacheCount:p,existenceFilterCount:_.count,databaseId:I.database,projectId:I.projectId},Y=_.unchangedNames;return Y&&(be.bloomFilter={applied:k===0,hashCount:(x=Y?.hashCount)!==null&&x!==void 0?x:0,bitmapLength:(U=($=(D=Y?.bits)===null||D===void 0?void 0:D.bitmap)===null||$===void 0?void 0:$.length)!==null&&U!==void 0?U:0,padding:(X=(j=Y?.bits)===null||j===void 0?void 0:j.padding)!==null&&X!==void 0?X:0,mightContain:E=>{var g;return(g=R?.mightContain(E))!==null&&g!==void 0&&g}}),be})(a,e.De,this.We.lt(),c,l))}}}}_t(e){let t=e.De.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,a,c;try{a=Et(r).toUint8Array()}catch(l){if(l instanceof Ls)return Ht("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{c=new su(a,i,s)}catch(l){return Ht(l instanceof gn?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return c.fe===0?null:c}ut(e,t,r){return t.De.count===r-this.ht(e,t.targetId)?0:2}ht(e,t){let r=this.We.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let a=this.We.lt(),c=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;e.mightContain(c)||(this.Xe(t,s,null),i++)}),i}Pt(e){let t=new Map;this.Ge.forEach((s,a)=>{let c=this.st(a);if(c){if(s.current&&Yc(c.target)){let l=new L(c.target.path);this.Tt(l).has(a)||this.It(a,l)||this.Xe(a,l,He.newNoDocument(l,e))}s.Ne&&(t.set(a,s.Le()),s.ke())}});let r=G();this.Je.forEach((s,a)=>{let c=!0;a.forEachWhile(l=>{let d=this.st(l);return!d||d.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)}),c&&(r=r.add(s))}),this.ze.forEach((s,a)=>a.setReadTime(e));let i=new Bs(e,t,this.He,this.ze,r);return this.ze=At(),this.je=Rs(),this.Je=Rs(),this.He=new oe(z),i}Ze(e,t){if(!this.nt(e))return;let r=this.It(e,t.key)?2:0;this.tt(e).qe(t.key,r),this.ze=this.ze.insert(t.key,t),this.je=this.je.insert(t.key,this.Tt(t.key).add(e)),this.Je=this.Je.insert(t.key,this.dt(t.key).add(e))}Xe(e,t,r){if(!this.nt(e))return;let i=this.tt(e);this.It(e,t)?i.qe(t,1):i.Qe(t),this.Je=this.Je.insert(t,this.dt(t).delete(e)),this.Je=this.Je.insert(t,this.dt(t).add(e)),r&&(this.ze=this.ze.insert(t,r))}removeTarget(e){this.Ge.delete(e)}ot(e){let t=this.tt(e).Le();return this.We.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.tt(e).$e()}tt(e){let t=this.Ge.get(e);return t||(t=new zs,this.Ge.set(e,t)),t}dt(e){let t=this.Je.get(e);return t||(t=new _e(z),this.Je=this.Je.insert(e,t)),t}Tt(e){let t=this.je.get(e);return t||(t=new _e(z),this.je=this.je.insert(e,t)),t}nt(e){let t=this.st(e)!==null;return t||V("WatchChangeAggregator","Detected inactive target",e),t}st(e){let t=this.Ge.get(e);return t&&t.Oe?null:this.We.Et(e)}rt(e){this.Ge.set(e,new zs),this.We.getRemoteKeysForTarget(e).forEach(t=>{this.Xe(e,t,null)})}It(e,t){return this.We.getRemoteKeysForTarget(e).has(t)}};function Rs(){return new oe(L.comparator)}function up(){return new oe(L.comparator)}var IE={asc:"ASCENDING",desc:"DESCENDING"},wE={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},EE={and:"AND",or:"OR"},au=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function cu(n,e){return n.useProto3Json||po(e)?e:{value:e}}function Ws(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Em(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function TE(n,e){return Ws(n,e.toTimestamp())}function ot(n){return J(!!n,49232),B.fromTimestamp((function(t){let r=wt(t);return new K(r.seconds,r.nanos)})(n))}function Tl(n,e){return uu(n,e).canonicalString()}function uu(n,e){let t=(function(i){return new re(["projects",i.projectId,"databases",i.database])})(n).child("documents");return e===void 0?t:t.child(e)}function Tm(n){let e=re.fromString(n);return J(Pm(e),10190,{key:e.toString()}),e}function lu(n,e){return Tl(n.databaseId,e.path)}function Sc(n,e){let t=Tm(e);if(t.get(1)!==n.databaseId.projectId)throw new O(P.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new O(P.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new L(bm(t))}function Am(n,e){return Tl(n.databaseId,e)}function AE(n){let e=Tm(n);return e.length===4?re.emptyPath():bm(e)}function hu(n){return new re(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function bm(n){return J(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function lp(n,e,t){return{name:lu(n,e),fields:t.value.mapValue.fields}}function bE(n,e){let t;if("targetChange"in e){e.targetChange;let r=(function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:M(39313,{state:d})})(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=(function(d,p){return d.useProto3Json?(J(p===void 0||typeof p=="string",58123),Ae.fromBase64String(p||"")):(J(p===void 0||p instanceof Buffer||p instanceof Uint8Array,16193),Ae.fromUint8Array(p||new Uint8Array))})(n,e.targetChange.resumeToken),a=e.targetChange.cause,c=a&&(function(d){let p=d.code===void 0?P.UNKNOWN:wm(d.code);return new O(p,d.message||"")})(a);t=new js(r,i,s,c||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=Sc(n,r.document.name),s=ot(r.document.updateTime),a=r.document.createTime?ot(r.document.createTime):B.min(),c=new Ve({mapValue:{fields:r.document.fields}}),l=He.newFoundDocument(i,s,a,c),d=r.targetIds||[],p=r.removedTargetIds||[];t=new Jn(d,p,l.key,l)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=Sc(n,r.document),s=r.readTime?ot(r.readTime):B.min(),a=He.newNoDocument(i,s),c=r.removedTargetIds||[];t=new Jn([],c,a.key,a)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=Sc(n,r.document),s=r.removedTargetIds||[];t=new Jn([],s,i,null)}else{if(!("filter"in e))return M(11601,{At:e});{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,a=new iu(i,s),c=r.targetId;t=new $s(c,a)}}return t}function SE(n,e){let t;if(e instanceof bn)t={update:lp(n,e.key,e.value)};else if(e instanceof di)t={delete:lu(n,e.key)};else if(e instanceof ct)t={update:lp(n,e.key,e.data),updateMask:VE(e.fieldMask)};else{if(!(e instanceof eu))return M(16599,{Rt:e.type});t={verify:lu(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>(function(s,a){let c=a.transform;if(c instanceof ir)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof Tn)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof An)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof sr)return{fieldPath:a.field.canonicalString(),increment:c.Ee};throw M(20930,{transform:a.transform})})(0,r))),e.precondition.isNone||(t.currentDocument=(function(i,s){return s.updateTime!==void 0?{updateTime:TE(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:M(27497)})(n,e.precondition)),t}function RE(n,e){return n&&n.length>0?(J(e!==void 0,14353),n.map(t=>(function(i,s){let a=i.updateTime?ot(i.updateTime):ot(s);return a.isEqual(B.min())&&(a=ot(s)),new Zc(a,i.transformResults||[])})(t,e))):[]}function PE(n,e){return{documents:[Am(n,e.path)]}}function CE(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=Am(n,i);let s=(function(d){if(d.length!==0)return Rm(Qe.create(d,"and"))})(e.filters);s&&(t.structuredQuery.where=s);let a=(function(d){if(d.length!==0)return d.map(p=>(function(I){return{field:Kn(I.field),direction:NE(I.dir)}})(p))})(e.orderBy);a&&(t.structuredQuery.orderBy=a);let c=cu(n,e.limit);return c!==null&&(t.structuredQuery.limit=c),e.startAt&&(t.structuredQuery.startAt=(function(d){return{before:d.inclusive,values:d.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(d){return{before:!d.inclusive,values:d.position}})(e.endAt)),{Vt:t,parent:i}}function kE(n){let e=AE(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){J(r===1,65062);let p=t.from[0];p.allDescendants?i=p.collectionId:e=e.child(p.collectionId)}let s=[];t.where&&(s=(function(_){let I=Sm(_);return I instanceof Qe&&im(I)?I.getFilters():[I]})(t.where));let a=[];t.orderBy&&(a=(function(_){return _.map(I=>(function(k){return new En(Hn(k.field),(function(D){switch(D){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(k.direction))})(I))})(t.orderBy));let c=null;t.limit&&(c=(function(_){let I;return I=typeof _=="object"?_.value:_,po(I)?null:I})(t.limit));let l=null;t.startAt&&(l=(function(_){let I=!!_.before,R=_.values||[];return new nr(R,I)})(t.startAt));let d=null;return t.endAt&&(d=(function(_){let I=!_.before,R=_.values||[];return new nr(R,I)})(t.endAt)),rE(e,i,a,s,c,"F",l,d)}function DE(n,e){let t=(function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return M(28987,{purpose:i})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Sm(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=Hn(t.unaryFilter.field);return he.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=Hn(t.unaryFilter.field);return he.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=Hn(t.unaryFilter.field);return he.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let a=Hn(t.unaryFilter.field);return he.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return M(61313);default:return M(60726)}})(n):n.fieldFilter!==void 0?(function(t){return he.create(Hn(t.fieldFilter.field),(function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return M(58110);default:return M(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return Qe.create(t.compositeFilter.filters.map(r=>Sm(r)),(function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return M(1026)}})(t.compositeFilter.op))})(n):M(30097,{filter:n})}function NE(n){return IE[n]}function OE(n){return wE[n]}function xE(n){return EE[n]}function Kn(n){return{fieldPath:n.canonicalString()}}function Hn(n){return Le.fromServerFormat(n.fieldPath)}function Rm(n){return n instanceof he?(function(t){if(t.op==="=="){if(Yf(t.value))return{unaryFilter:{field:Kn(t.field),op:"IS_NAN"}};if(Jf(t.value))return{unaryFilter:{field:Kn(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Yf(t.value))return{unaryFilter:{field:Kn(t.field),op:"IS_NOT_NAN"}};if(Jf(t.value))return{unaryFilter:{field:Kn(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Kn(t.field),op:OE(t.op),value:t.value}}})(n):n instanceof Qe?(function(t){let r=t.getFilters().map(i=>Rm(i));return r.length===1?r[0]:{compositeFilter:{op:xE(t.op),filters:r}}})(n):M(54877,{filter:n})}function VE(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Pm(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var pi=class n{constructor(e,t,r,i,s=B.min(),a=B.min(),c=Ae.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=c,this.expectedCount=l}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var du=class{constructor(e){this.gt=e}};function LE(n){let e=kE({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?qs(e,e.limit,"L"):e}var Gs=class{constructor(){}bt(e,t){this.Dt(e,t),t.vt()}Dt(e,t){if("nullValue"in e)this.Ct(t,5);else if("booleanValue"in e)this.Ct(t,10),t.Ft(e.booleanValue?1:0);else if("integerValue"in e)this.Ct(t,15),t.Ft(ne(e.integerValue));else if("doubleValue"in e){let r=ne(e.doubleValue);isNaN(r)?this.Ct(t,13):(this.Ct(t,15),ui(r)?t.Ft(0):t.Ft(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ct(t,20),typeof r=="string"&&(r=wt(r)),t.Mt(`${r.seconds||""}`),t.Ft(r.nanos||0)}else if("stringValue"in e)this.xt(e.stringValue,t),this.Ot(t);else if("bytesValue"in e)this.Ct(t,30),t.Nt(Et(e.bytesValue)),this.Ot(t);else if("referenceValue"in e)this.Bt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Ct(t,45),t.Ft(r.latitude||0),t.Ft(r.longitude||0)}else"mapValue"in e?tm(e)?this.Ct(t,Number.MAX_SAFE_INTEGER):em(e)?this.Lt(e.mapValue,t):(this.kt(e.mapValue,t),this.Ot(t)):"arrayValue"in e?(this.qt(e.arrayValue,t),this.Ot(t)):M(19022,{Qt:e})}xt(e,t){this.Ct(t,25),this.$t(e,t)}$t(e,t){t.Mt(e)}kt(e,t){let r=e.fields||{};this.Ct(t,55);for(let i of Object.keys(r))this.xt(i,t),this.Dt(r[i],t)}Lt(e,t){var r,i;let s=e.fields||{};this.Ct(t,53);let a=Zn,c=((i=(r=s[a].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.length)||0;this.Ct(t,15),t.Ft(ne(c)),this.xt(a,t),this.Dt(s[a],t)}qt(e,t){let r=e.values||[];this.Ct(t,50);for(let i of r)this.Dt(i,t)}Bt(e,t){this.Ct(t,37),L.fromName(e).path.forEach(r=>{this.Ct(t,60),this.$t(r,t)})}Ct(e,t){e.Ft(t)}Ot(e){e.Ft(2)}};Gs.Ut=new Gs;var fu=class{constructor(){this.Dn=new pu}addToCollectionParentIndex(e,t){return this.Dn.add(t),C.resolve()}getCollectionParents(e,t){return C.resolve(this.Dn.getEntries(t))}addFieldIndex(e,t){return C.resolve()}deleteFieldIndex(e,t){return C.resolve()}deleteAllFieldIndexes(e){return C.resolve()}createTargetIndexes(e,t){return C.resolve()}getDocumentsMatchingTarget(e,t){return C.resolve(null)}getIndexType(e,t){return C.resolve(0)}getFieldIndexes(e,t){return C.resolve([])}getNextCollectionGroupToUpdate(e){return C.resolve(null)}getMinOffset(e,t){return C.resolve(wn.min())}getMinOffsetFromCollectionGroup(e,t){return C.resolve(wn.min())}updateCollectionGroup(e,t,r){return C.resolve()}updateIndexEntries(e,t){return C.resolve()}},pu=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new _e(re.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new _e(re.comparator)).toArray()}};var V0=new Uint8Array(0);var hp={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Cm=41943040,qe=class n{static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}};qe.DEFAULT_COLLECTION_PERCENTILE=10,qe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,qe.DEFAULT=new qe(Cm,qe.DEFAULT_COLLECTION_PERCENTILE,qe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),qe.DISABLED=new qe(-1,0,0);var mi=class n{constructor(e){this._r=e}next(){return this._r+=2,this._r}static ar(){return new n(0)}static ur(){return new n(-1)}};var dp="LruGarbageCollector",ME=1048576;function fp([n,e],[t,r]){let i=z(n,t);return i===0?z(e,r):i}var mu=class{constructor(e){this.Tr=e,this.buffer=new _e(fp),this.Ir=0}dr(){return++this.Ir}Er(e){let t=[e,this.dr()];if(this.buffer.size<this.Tr)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();fp(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},gu=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Ar=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Rr(6e4)}stop(){this.Ar&&(this.Ar.cancel(),this.Ar=null)}get started(){return this.Ar!==null}Rr(e){V(dp,`Garbage collection scheduled in ${e}ms`),this.Ar=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>m(this,null,function*(){this.Ar=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){dr(t)?V(dp,"Ignoring IndexedDB error during garbage collection: ",t):yield hr(t)}yield this.Rr(3e5)}))}},_u=class{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.mr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return C.resolve(pl.ue);let r=new mu(t);return this.Vr.forEachTarget(e,i=>r.Er(i.sequenceNumber)).next(()=>this.Vr.gr(e,i=>r.Er(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Vr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(V("LruGarbageCollector","Garbage collection skipped; disabled"),C.resolve(hp)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(V("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),hp):this.pr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}pr(e,t){let r,i,s,a,c,l,d,p=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(_=>(_>this.params.maximumSequenceNumbersToCollect?(V("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${_}`),i=this.params.maximumSequenceNumbersToCollect):i=_,a=Date.now(),this.nthSequenceNumber(e,i))).next(_=>(r=_,c=Date.now(),this.removeTargets(e,r,t))).next(_=>(s=_,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(_=>(d=Date.now(),Wn()<=W.DEBUG&&V("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-p}ms
	Determined least recently used ${i} in `+(c-a)+`ms
	Removed ${s} targets in `+(l-c)+`ms
	Removed ${_} documents in `+(d-l)+`ms
Total Duration: ${d-p}ms`),C.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:_})))}};function FE(n,e){return new _u(n,e)}var yu=class{constructor(){this.changes=new Tt(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,He.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?C.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var vu=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Iu=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&oi(r.mutation,i,Be.empty(),K.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,G()).next(()=>r))}getLocalViewOfDocuments(e,t,r=G()){let i=mn();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let a=ni();return s.forEach((c,l)=>{a=a.insert(c,l.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){let r=mn();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,G()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((a,c)=>{t.set(a,c)})})}computeViews(e,t,r,i){let s=At(),a=si(),c=(function(){return si()})();return t.forEach((l,d)=>{let p=r.get(d.key);i.has(d.key)&&(p===void 0||p.mutation instanceof ct)?s=s.insert(d.key,d):p!==void 0?(a.set(d.key,p.mutation.getFieldMask()),oi(p.mutation,d,p.mutation.getFieldMask(),K.now())):a.set(d.key,Be.empty())}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((d,p)=>a.set(d,p)),t.forEach((d,p)=>{var _;return c.set(d,new vu(p,(_=a.get(d))!==null&&_!==void 0?_:null))}),c))}recalculateAndSaveOverlays(e,t){let r=si(),i=new oe((a,c)=>a-c),s=G();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(let c of a)c.keys().forEach(l=>{let d=t.get(l);if(d===null)return;let p=r.get(l)||Be.empty();p=c.applyToLocalView(d,p),r.set(l,p);let _=(i.get(c.batchId)||G()).add(l);i=i.insert(c.batchId,_)})}).next(()=>{let a=[],c=i.getReverseIterator();for(;c.hasNext();){let l=c.getNext(),d=l.key,p=l.value,_=fm();p.forEach(I=>{if(!s.has(I)){let R=vm(t.get(I),r.get(I));R!==null&&_.set(I,R),s=s.add(I)}}),a.push(this.documentOverlayCache.saveOverlays(e,d,_))}return C.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return(function(a){return L.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):cm(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):C.resolve(mn()),c=ci,l=s;return a.next(d=>C.forEach(d,(p,_)=>(c<_.largestBatchId&&(c=_.largestBatchId),s.get(p)?C.resolve():this.remoteDocumentCache.getEntry(e,p).next(I=>{l=l.insert(p,I)}))).next(()=>this.populateOverlays(e,d,s)).next(()=>this.computeViews(e,l,d,G())).next(p=>({batchId:c,changes:dm(p)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new L(t)).next(r=>{let i=ni();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,a=ni();return this.indexManager.getCollectionParents(e,s).next(c=>C.forEach(c,l=>{let d=(function(_,I){return new Jt(I,null,_.explicitOrderBy.slice(),_.filters.slice(),_.limit,_.limitType,_.startAt,_.endAt)})(t,l.child(s));return this.getDocumentsMatchingCollectionQuery(e,d,r,i).next(p=>{p.forEach((_,I)=>{a=a.insert(_,I)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(a=>{s.forEach((l,d)=>{let p=d.getKey();a.get(p)===null&&(a=a.insert(p,He.newInvalidDocument(p)))});let c=ni();return a.forEach((l,d)=>{let p=s.get(l);p!==void 0&&oi(p.mutation,d,Be.empty(),K.now()),yo(t,d)&&(c=c.insert(l,d))}),c})}};var wu=class{constructor(e){this.serializer=e,this.Br=new Map,this.Lr=new Map}getBundleMetadata(e,t){return C.resolve(this.Br.get(t))}saveBundleMetadata(e,t){return this.Br.set(t.id,(function(i){return{id:i.id,version:i.version,createTime:ot(i.createTime)}})(t)),C.resolve()}getNamedQuery(e,t){return C.resolve(this.Lr.get(t))}saveNamedQuery(e,t){return this.Lr.set(t.name,(function(i){return{name:i.name,query:LE(i.bundledQuery),readTime:ot(i.readTime)}})(t)),C.resolve()}};var Eu=class{constructor(){this.overlays=new oe(L.comparator),this.kr=new Map}getOverlay(e,t){return C.resolve(this.overlays.get(t))}getOverlays(e,t){let r=mn();return C.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.wt(e,t,s)}),C.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.kr.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.kr.delete(r)),C.resolve()}getOverlaysForCollection(e,t,r){let i=mn(),s=t.length+1,a=new L(t.child("")),c=this.overlays.getIteratorFrom(a);for(;c.hasNext();){let l=c.getNext().value,d=l.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===s&&l.largestBatchId>r&&i.set(l.getKey(),l)}return C.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new oe((d,p)=>d-p),a=this.overlays.getIterator();for(;a.hasNext();){let d=a.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>r){let p=s.get(d.largestBatchId);p===null&&(p=mn(),s=s.insert(d.largestBatchId,p)),p.set(d.getKey(),d)}}let c=mn(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((d,p)=>c.set(d,p)),!(c.size()>=i)););return C.resolve(c)}wt(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let a=this.kr.get(i.largestBatchId).delete(r.key);this.kr.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new ru(t,r));let s=this.kr.get(t);s===void 0&&(s=G(),this.kr.set(t,s)),this.kr.set(t,s.add(r.key))}};var Tu=class{constructor(){this.sessionToken=Ae.EMPTY_BYTE_STRING}getSessionToken(e){return C.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,C.resolve()}};var gi=class{constructor(){this.qr=new _e(le.Qr),this.$r=new _e(le.Ur)}isEmpty(){return this.qr.isEmpty()}addReference(e,t){let r=new le(e,t);this.qr=this.qr.add(r),this.$r=this.$r.add(r)}Kr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Wr(new le(e,t))}Gr(e,t){e.forEach(r=>this.removeReference(r,t))}zr(e){let t=new L(new re([])),r=new le(t,e),i=new le(t,e+1),s=[];return this.$r.forEachInRange([r,i],a=>{this.Wr(a),s.push(a.key)}),s}jr(){this.qr.forEach(e=>this.Wr(e))}Wr(e){this.qr=this.qr.delete(e),this.$r=this.$r.delete(e)}Jr(e){let t=new L(new re([])),r=new le(t,e),i=new le(t,e+1),s=G();return this.$r.forEachInRange([r,i],a=>{s=s.add(a.key)}),s}containsKey(e){let t=new le(e,0),r=this.qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},le=class{constructor(e,t){this.key=e,this.Hr=t}static Qr(e,t){return L.comparator(e.key,t.key)||z(e.Hr,t.Hr)}static Ur(e,t){return z(e.Hr,t.Hr)||L.comparator(e.key,t.key)}};var Au=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.er=1,this.Yr=new _e(le.Qr)}checkEmpty(e){return C.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.er;this.er++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new tu(s,t,r,i);this.mutationQueue.push(a);for(let c of i)this.Yr=this.Yr.add(new le(c.key,s)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return C.resolve(a)}lookupMutationBatch(e,t){return C.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.Xr(r),s=i<0?0:i;return C.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return C.resolve(this.mutationQueue.length===0?ml:this.er-1)}getAllMutationBatches(e){return C.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new le(t,0),i=new le(t,Number.POSITIVE_INFINITY),s=[];return this.Yr.forEachInRange([r,i],a=>{let c=this.Zr(a.Hr);s.push(c)}),C.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new _e(z);return t.forEach(i=>{let s=new le(i,0),a=new le(i,Number.POSITIVE_INFINITY);this.Yr.forEachInRange([s,a],c=>{r=r.add(c.Hr)})}),C.resolve(this.ei(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;L.isDocumentKey(s)||(s=s.child(""));let a=new le(new L(s),0),c=new _e(z);return this.Yr.forEachWhile(l=>{let d=l.key.path;return!!r.isPrefixOf(d)&&(d.length===i&&(c=c.add(l.Hr)),!0)},a),C.resolve(this.ei(c))}ei(e){let t=[];return e.forEach(r=>{let i=this.Zr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){J(this.ti(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Yr;return C.forEach(t.mutations,i=>{let s=new le(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Yr=r})}rr(e){}containsKey(e,t){let r=new le(t,0),i=this.Yr.firstAfterOrEqual(r);return C.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,C.resolve()}ti(e,t){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){let t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var bu=class{constructor(e){this.ni=e,this.docs=(function(){return new oe(L.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,a=this.ni(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return C.resolve(r?r.document.mutableCopy():He.newInvalidDocument(t))}getEntries(e,t){let r=At();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():He.newInvalidDocument(i))}),C.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=At(),a=t.path,c=new L(a.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(c);for(;l.hasNext();){let{key:d,value:{document:p}}=l.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||Fw(Mw(p),r)<=0||(i.has(p.key)||yo(t,p))&&(s=s.insert(p.key,p.mutableCopy()))}return C.resolve(s)}getAllFromCollectionGroup(e,t,r,i){M(9500)}ri(e,t){return C.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Su(this)}getSize(e){return C.resolve(this.size)}},Su=class extends yu{constructor(e){super(),this.Or=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.Or.addEntry(e,i)):this.Or.removeEntry(r)}),C.waitFor(t)}getFromCache(e,t){return this.Or.getEntry(e,t)}getAllFromCache(e,t){return this.Or.getEntries(e,t)}};var Ru=class{constructor(e){this.persistence=e,this.ii=new Tt(t=>Il(t),wl),this.lastRemoteSnapshotVersion=B.min(),this.highestTargetId=0,this.si=0,this.oi=new gi,this.targetCount=0,this._i=mi.ar()}forEachTarget(e,t){return this.ii.forEach((r,i)=>t(i)),C.resolve()}getLastRemoteSnapshotVersion(e){return C.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return C.resolve(this.si)}allocateTargetId(e){return this.highestTargetId=this._i.next(),C.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.si&&(this.si=t),C.resolve()}hr(e){this.ii.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this._i=new mi(t),this.highestTargetId=t),e.sequenceNumber>this.si&&(this.si=e.sequenceNumber)}addTargetData(e,t){return this.hr(t),this.targetCount+=1,C.resolve()}updateTargetData(e,t){return this.hr(t),C.resolve()}removeTargetData(e,t){return this.ii.delete(t.target),this.oi.zr(t.targetId),this.targetCount-=1,C.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.ii.forEach((a,c)=>{c.sequenceNumber<=t&&r.get(c.targetId)===null&&(this.ii.delete(a),s.push(this.removeMatchingKeysForTargetId(e,c.targetId)),i++)}),C.waitFor(s).next(()=>i)}getTargetCount(e){return C.resolve(this.targetCount)}getTargetData(e,t){let r=this.ii.get(t)||null;return C.resolve(r)}addMatchingKeys(e,t,r){return this.oi.Kr(t,r),C.resolve()}removeMatchingKeys(e,t,r){this.oi.Gr(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(a=>{s.push(i.markPotentiallyOrphaned(e,a))}),C.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.oi.zr(t),C.resolve()}getMatchingKeysForTargetId(e,t){let r=this.oi.Jr(t);return C.resolve(r)}containsKey(e,t){return C.resolve(this.oi.containsKey(t))}};var Ks=class{constructor(e,t){this.ai={},this.overlays={},this.ui=new pl(0),this.ci=!1,this.ci=!0,this.li=new Tu,this.referenceDelegate=e(this),this.hi=new Ru(this),this.indexManager=new fu,this.remoteDocumentCache=(function(i){return new bu(i)})(r=>this.referenceDelegate.Pi(r)),this.serializer=new du(t),this.Ti=new wu(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ci=!1,Promise.resolve()}get started(){return this.ci}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Eu,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ai[e.toKey()];return r||(r=new Au(t,this.referenceDelegate),this.ai[e.toKey()]=r),r}getGlobalsCache(){return this.li}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ti}runTransaction(e,t,r){V("MemoryPersistence","Starting transaction:",e);let i=new Pu(this.ui.next());return this.referenceDelegate.Ii(),r(i).next(s=>this.referenceDelegate.di(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Ei(e,t){return C.or(Object.values(this.ai).map(r=>()=>r.containsKey(e,t)))}},Pu=class extends Fc{constructor(e){super(),this.currentSequenceNumber=e}},Cu=class n{constructor(e){this.persistence=e,this.Ai=new gi,this.Ri=null}static Vi(e){return new n(e)}get mi(){if(this.Ri)return this.Ri;throw M(60996)}addReference(e,t,r){return this.Ai.addReference(r,t),this.mi.delete(r.toString()),C.resolve()}removeReference(e,t,r){return this.Ai.removeReference(r,t),this.mi.add(r.toString()),C.resolve()}markPotentiallyOrphaned(e,t){return this.mi.add(t.toString()),C.resolve()}removeTarget(e,t){this.Ai.zr(t.targetId).forEach(i=>this.mi.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.mi.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}Ii(){this.Ri=new Set}di(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return C.forEach(this.mi,r=>{let i=L.fromPath(r);return this.fi(e,i).next(s=>{s||t.removeEntry(i,B.min())})}).next(()=>(this.Ri=null,t.apply(e)))}updateLimboDocument(e,t){return this.fi(e,t).next(r=>{r?this.mi.delete(t.toString()):this.mi.add(t.toString())})}Pi(e){return 0}fi(e,t){return C.or([()=>C.resolve(this.Ai.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}},Hs=class n{constructor(e,t){this.persistence=e,this.gi=new Tt(r=>$w(r.path),(r,i)=>r.isEqual(i)),this.garbageCollector=FE(this,t)}static Vi(e,t){return new n(e,t)}Ii(){}di(e){return C.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}mr(e){let t=this.yr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}yr(e){let t=0;return this.gr(e,r=>{t++}).next(()=>t)}gr(e,t){return C.forEach(this.gi,(r,i)=>this.Sr(e,r,i).next(s=>s?C.resolve():t(i)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.ri(e,a=>this.Sr(e,a,t).next(c=>{c||(r++,s.removeEntry(a,B.min()))})).next(()=>s.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.gi.set(t,e.currentSequenceNumber),C.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.gi.set(r,e.currentSequenceNumber),C.resolve()}removeReference(e,t,r){return this.gi.set(r,e.currentSequenceNumber),C.resolve()}updateLimboDocument(e,t){return this.gi.set(t,e.currentSequenceNumber),C.resolve()}Pi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Cs(e.data.value)),t}Sr(e,t,r){return C.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let i=this.gi.get(t);return C.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}};var ku=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.Is=r,this.ds=i}static Es(e,t){let r=G(),i=G();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new n(e,t.fromCache,r,i)}};var Du=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var Nu=class{constructor(){this.As=!1,this.Rs=!1,this.Vs=100,this.fs=(function(){return od()?8:qw(me())>0?6:4})()}initialize(e,t){this.gs=e,this.indexManager=t,this.As=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.ps(e,t).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.ys(e,t,i,r).next(a=>{s.result=a})}).next(()=>{if(s.result)return;let a=new Du;return this.ws(e,t,a).next(c=>{if(s.result=c,this.Rs)return this.Ss(e,t,a,c.size)})}).next(()=>s.result)}Ss(e,t,r,i){return r.documentReadCount<this.Vs?(Wn()<=W.DEBUG&&V("QueryEngine","SDK will not create cache indexes for query:",Gn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),C.resolve()):(Wn()<=W.DEBUG&&V("QueryEngine","Query:",Gn(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.fs*i?(Wn()<=W.DEBUG&&V("QueryEngine","The SDK decides to create cache indexes for query:",Gn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,it(t))):C.resolve())}ps(e,t){if(tp(t))return C.resolve(null);let r=it(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=qs(t,null,"F"),r=it(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let a=G(...s);return this.gs.getDocuments(e,a).next(c=>this.indexManager.getMinOffset(e,r).next(l=>{let d=this.bs(t,c);return this.Ds(t,d,a,l.readTime)?this.ps(e,qs(t,null,"F")):this.vs(e,d,t,l)}))})))}ys(e,t,r,i){return tp(t)||i.isEqual(B.min())?C.resolve(null):this.gs.getDocuments(e,r).next(s=>{let a=this.bs(t,s);return this.Ds(t,a,r,i)?C.resolve(null):(Wn()<=W.DEBUG&&V("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Gn(t)),this.vs(e,a,t,Lw(i,ci)).next(c=>c))})}bs(e,t){let r=new _e(lm(e));return t.forEach((i,s)=>{yo(e,s)&&(r=r.add(s))}),r}Ds(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}ws(e,t,r){return Wn()<=W.DEBUG&&V("QueryEngine","Using full collection scan to execute query:",Gn(t)),this.gs.getDocumentsMatchingQuery(e,t,wn.min(),r)}vs(e,t,r,i){return this.gs.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(a=>{s=s.insert(a.key,a)}),s))}};var Al="LocalStore",UE=3e8,Ou=class{constructor(e,t,r,i){this.persistence=e,this.Cs=t,this.serializer=i,this.Fs=new oe(z),this.Ms=new Tt(s=>Il(s),wl),this.xs=new Map,this.Os=e.getRemoteDocumentCache(),this.hi=e.getTargetCache(),this.Ti=e.getBundleCache(),this.Ns(r)}Ns(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Iu(this.Os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Os.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Fs))}};function qE(n,e,t,r){return new Ou(n,e,t,r)}function km(n,e){return m(this,null,function*(){let t=q(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.Ns(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{let a=[],c=[],l=G();for(let d of i){a.push(d.batchId);for(let p of d.mutations)l=l.add(p.key)}for(let d of s){c.push(d.batchId);for(let p of d.mutations)l=l.add(p.key)}return t.localDocuments.getDocuments(r,l).next(d=>({Bs:d,removedBatchIds:a,addedBatchIds:c}))})})})}function BE(n,e){let t=q(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.Os.newChangeBuffer({trackRemovals:!0});return(function(c,l,d,p){let _=d.batch,I=_.keys(),R=C.resolve();return I.forEach(k=>{R=R.next(()=>p.getEntry(l,k)).next(x=>{let D=d.docVersions.get(k);J(D!==null,48541),x.version.compareTo(D)<0&&(_.applyToRemoteDocument(x,d),x.isValidDocument()&&(x.setReadTime(d.commitVersion),p.addEntry(x)))})}),R.next(()=>c.mutationQueue.removeMutationBatch(l,_))})(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(c){let l=G();for(let d=0;d<c.mutationResults.length;++d)c.mutationResults[d].transformResults.length>0&&(l=l.add(c.batch.mutations[d].key));return l})(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function Dm(n){let e=q(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.hi.getLastRemoteSnapshotVersion(t))}function $E(n,e){let t=q(n),r=e.snapshotVersion,i=t.Fs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let a=t.Os.newChangeBuffer({trackRemovals:!0});i=t.Fs;let c=[];e.targetChanges.forEach((p,_)=>{let I=i.get(_);if(!I)return;c.push(t.hi.removeMatchingKeys(s,p.removedDocuments,_).next(()=>t.hi.addMatchingKeys(s,p.addedDocuments,_)));let R=I.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(_)!==null?R=R.withResumeToken(Ae.EMPTY_BYTE_STRING,B.min()).withLastLimboFreeSnapshotVersion(B.min()):p.resumeToken.approximateByteSize()>0&&(R=R.withResumeToken(p.resumeToken,r)),i=i.insert(_,R),(function(x,D,$){return x.resumeToken.approximateByteSize()===0||D.snapshotVersion.toMicroseconds()-x.snapshotVersion.toMicroseconds()>=UE?!0:$.addedDocuments.size+$.modifiedDocuments.size+$.removedDocuments.size>0})(I,R,p)&&c.push(t.hi.updateTargetData(s,R))});let l=At(),d=G();if(e.documentUpdates.forEach(p=>{e.resolvedLimboDocuments.has(p)&&c.push(t.persistence.referenceDelegate.updateLimboDocument(s,p))}),c.push(jE(s,a,e.documentUpdates).next(p=>{l=p.Ls,d=p.ks})),!r.isEqual(B.min())){let p=t.hi.getLastRemoteSnapshotVersion(s).next(_=>t.hi.setTargetsMetadata(s,s.currentSequenceNumber,r));c.push(p)}return C.waitFor(c).next(()=>a.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,l,d)).next(()=>l)}).then(s=>(t.Fs=i,s))}function jE(n,e,t){let r=G(),i=G();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let a=At();return t.forEach((c,l)=>{let d=s.get(c);l.isFoundDocument()!==d.isFoundDocument()&&(i=i.add(c)),l.isNoDocument()&&l.version.isEqual(B.min())?(e.removeEntry(c,l.readTime),a=a.insert(c,l)):!d.isValidDocument()||l.version.compareTo(d.version)>0||l.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(l),a=a.insert(c,l)):V(Al,"Ignoring outdated watch update for ",c,". Current version:",d.version," Watch version:",l.version)}),{Ls:a,ks:i}})}function zE(n,e){let t=q(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=ml),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function WE(n,e){let t=q(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.hi.getTargetData(r,e).next(s=>s?(i=s,C.resolve(i)):t.hi.allocateTargetId(r).next(a=>(i=new pi(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.hi.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.Fs.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Fs=t.Fs.insert(r.targetId,r),t.Ms.set(e,r.targetId)),r})}function xu(n,e,t){return m(this,null,function*(){let r=q(n),i=r.Fs.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,a=>r.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!dr(a))throw a;V(Al,`Failed to update sequence numbers for target ${e}: ${a}`)}r.Fs=r.Fs.remove(e),r.Ms.delete(i.target)})}function pp(n,e,t){let r=q(n),i=B.min(),s=G();return r.persistence.runTransaction("Execute query","readwrite",a=>(function(l,d,p){let _=q(l),I=_.Ms.get(p);return I!==void 0?C.resolve(_.Fs.get(I)):_.hi.getTargetData(d,p)})(r,a,it(e)).next(c=>{if(c)return i=c.lastLimboFreeSnapshotVersion,r.hi.getMatchingKeysForTargetId(a,c.targetId).next(l=>{s=l})}).next(()=>r.Cs.getDocumentsMatchingQuery(a,e,t?i:B.min(),t?s:G())).next(c=>(GE(r,sE(e),c),{documents:c,qs:s})))}function GE(n,e,t){let r=n.xs.get(e)||B.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.xs.set(e,r)}var Qs=class{constructor(){this.activeTargetIds=hE()}Gs(e){this.activeTargetIds=this.activeTargetIds.add(e)}zs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}};var Vu=class{constructor(){this.Fo=new Qs,this.Mo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Fo.Gs(e),this.Mo[e]||"not-current"}updateQueryState(e,t,r){this.Mo[e]=t}removeLocalQueryTarget(e){this.Fo.zs(e)}isLocalQueryTarget(e){return this.Fo.activeTargetIds.has(e)}clearQueryState(e){delete this.Mo[e]}getAllActiveQueryTargets(){return this.Fo.activeTargetIds}isActiveQueryTarget(e){return this.Fo.activeTargetIds.has(e)}start(){return this.Fo=new Qs,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var Lu=class{xo(e){}shutdown(){}};var mp="ConnectivityMonitor",Js=class{constructor(){this.Oo=()=>this.No(),this.Bo=()=>this.Lo(),this.ko=[],this.qo()}xo(e){this.ko.push(e)}shutdown(){window.removeEventListener("online",this.Oo),window.removeEventListener("offline",this.Bo)}qo(){window.addEventListener("online",this.Oo),window.addEventListener("offline",this.Bo)}No(){V(mp,"Network connectivity changed: AVAILABLE");for(let e of this.ko)e(0)}Lo(){V(mp,"Network connectivity changed: UNAVAILABLE");for(let e of this.ko)e(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Ps=null;function Mu(){return Ps===null?Ps=(function(){return 268435456+Math.round(2147483648*Math.random())})():Ps++,"0x"+Ps.toString(16)}var Rc="RestConnection",KE={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},Fu=class{get Qo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.$o=t+"://"+e.host,this.Uo=`projects/${r}/databases/${i}`,this.Ko=this.databaseId.database===Ms?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Wo(e,t,r,i,s){let a=Mu(),c=this.Go(e,t.toUriEncodedString());V(Rc,`Sending RPC '${e}' ${a}:`,c,r);let l={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.Ko};this.zo(l,i,s);let{host:d}=new URL(c),p=Ot(d);return this.jo(e,c,l,r,p).then(_=>(V(Rc,`Received RPC '${e}' ${a}: `,_),_),_=>{throw Ht(Rc,`RPC '${e}' ${a} failed with error: `,_,"url: ",c,"request:",r),_})}Jo(e,t,r,i,s,a){return this.Wo(e,t,r,i,s)}zo(e,t,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+lr})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,s)=>e[s]=i),r&&r.headers.forEach((i,s)=>e[s]=i)}Go(e,t){let r=KE[e];return`${this.$o}/v1/${t}:${r}`}terminate(){}};var Uu=class{constructor(e){this.Ho=e.Ho,this.Yo=e.Yo}Zo(e){this.Xo=e}e_(e){this.t_=e}n_(e){this.r_=e}onMessage(e){this.i_=e}close(){this.Yo()}send(e){this.Ho(e)}s_(){this.Xo()}o_(){this.t_()}__(e){this.r_(e)}a_(e){this.i_(e)}};var Te="WebChannelConnection",qu=class extends Fu{constructor(e){super(e),this.u_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}jo(e,t,r,i,s){let a=Mu();return new Promise((c,l)=>{let d=new wc;d.setWithCredentials(!0),d.listenOnce(Ec.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case ti.NO_ERROR:let _=d.getResponseJson();V(Te,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(_)),c(_);break;case ti.TIMEOUT:V(Te,`RPC '${e}' ${a} timed out`),l(new O(P.DEADLINE_EXCEEDED,"Request time out"));break;case ti.HTTP_ERROR:let I=d.getStatus();if(V(Te,`RPC '${e}' ${a} failed with status:`,I,"response text:",d.getResponseText()),I>0){let R=d.getResponseJson();Array.isArray(R)&&(R=R[0]);let k=R?.error;if(k&&k.status&&k.message){let x=(function($){let U=$.toLowerCase().replace(/_/g,"-");return Object.values(P).indexOf(U)>=0?U:P.UNKNOWN})(k.status);l(new O(x,k.message))}else l(new O(P.UNKNOWN,"Server responded with status "+d.getStatus()))}else l(new O(P.UNAVAILABLE,"Connection failed."));break;default:M(9055,{c_:e,streamId:a,l_:d.getLastErrorCode(),h_:d.getLastError()})}}finally{V(Te,`RPC '${e}' ${a} completed.`)}});let p=JSON.stringify(i);V(Te,`RPC '${e}' ${a} sending request:`,i),d.send(t,"POST",p,r,15)})}P_(e,t,r){let i=Mu(),s=[this.$o,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=bc(),c=Ac(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(l.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(l.useFetchStreams=!0),this.zo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;let p=s.join("");V(Te,`Creating RPC '${e}' stream ${i}: ${p}`,l);let _=a.createWebChannel(p,l);this.T_(_);let I=!1,R=!1,k=new Uu({Ho:D=>{R?V(Te,`Not sending because RPC '${e}' stream ${i} is closed:`,D):(I||(V(Te,`Opening RPC '${e}' stream ${i} transport.`),_.open(),I=!0),V(Te,`RPC '${e}' stream ${i} sending:`,D),_.send(D))},Yo:()=>_.close()}),x=(D,$,U)=>{D.listen($,j=>{try{U(j)}catch(X){setTimeout(()=>{throw X},0)}})};return x(_,zn.EventType.OPEN,()=>{R||(V(Te,`RPC '${e}' stream ${i} transport opened.`),k.s_())}),x(_,zn.EventType.CLOSE,()=>{R||(R=!0,V(Te,`RPC '${e}' stream ${i} transport closed`),k.__(),this.I_(_))}),x(_,zn.EventType.ERROR,D=>{R||(R=!0,Ht(Te,`RPC '${e}' stream ${i} transport errored. Name:`,D.name,"Message:",D.message),k.__(new O(P.UNAVAILABLE,"The operation could not be completed")))}),x(_,zn.EventType.MESSAGE,D=>{var $;if(!R){let U=D.data[0];J(!!U,16349);let j=U,X=j?.error||(($=j[0])===null||$===void 0?void 0:$.error);if(X){V(Te,`RPC '${e}' stream ${i} received error:`,X);let be=X.status,Y=(function(v){let w=ue[v];if(w!==void 0)return wm(w)})(be),E=X.message;Y===void 0&&(Y=P.INTERNAL,E="Unknown error status: "+be+" with message "+X.message),R=!0,k.__(new O(Y,E)),_.close()}else V(Te,`RPC '${e}' stream ${i} received:`,U),k.a_(U)}}),x(c,Tc.STAT_EVENT,D=>{D.stat===bs.PROXY?V(Te,`RPC '${e}' stream ${i} detected buffering proxy`):D.stat===bs.NOPROXY&&V(Te,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{k.o_()},0),k}terminate(){this.u_.forEach(e=>e.close()),this.u_=[]}T_(e){this.u_.push(e)}I_(e){this.u_=this.u_.filter(t=>t===e)}};function Pc(){return typeof document<"u"?document:null}function vo(n){return new au(n,!0)}var Ys=class{constructor(e,t,r=1e3,i=1.5,s=6e4){this.Fi=e,this.timerId=t,this.d_=r,this.E_=i,this.A_=s,this.R_=0,this.V_=null,this.m_=Date.now(),this.reset()}reset(){this.R_=0}f_(){this.R_=this.A_}g_(e){this.cancel();let t=Math.floor(this.R_+this.p_()),r=Math.max(0,Date.now()-this.m_),i=Math.max(0,t-r);i>0&&V("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.R_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.V_=this.Fi.enqueueAfterDelay(this.timerId,i,()=>(this.m_=Date.now(),e())),this.R_*=this.E_,this.R_<this.d_&&(this.R_=this.d_),this.R_>this.A_&&(this.R_=this.A_)}y_(){this.V_!==null&&(this.V_.skipDelay(),this.V_=null)}cancel(){this.V_!==null&&(this.V_.cancel(),this.V_=null)}p_(){return(Math.random()-.5)*this.R_}};var gp="PersistentStream",Xs=class{constructor(e,t,r,i,s,a,c,l){this.Fi=e,this.w_=r,this.S_=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=c,this.listener=l,this.state=0,this.b_=0,this.D_=null,this.v_=null,this.stream=null,this.C_=0,this.F_=new Ys(e,t)}M_(){return this.state===1||this.state===5||this.x_()}x_(){return this.state===2||this.state===3}start(){this.C_=0,this.state!==4?this.auth():this.O_()}stop(){return m(this,null,function*(){this.M_()&&(yield this.close(0))})}N_(){this.state=0,this.F_.reset()}B_(){this.x_()&&this.D_===null&&(this.D_=this.Fi.enqueueAfterDelay(this.w_,6e4,()=>this.L_()))}k_(e){this.q_(),this.stream.send(e)}L_(){return m(this,null,function*(){if(this.x_())return this.close(0)})}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}Q_(){this.v_&&(this.v_.cancel(),this.v_=null)}close(e,t){return m(this,null,function*(){this.q_(),this.Q_(),this.F_.cancel(),this.b_++,e!==4?this.F_.reset():t&&t.code===P.RESOURCE_EXHAUSTED?(It(t.toString()),It("Using maximum backoff delay to prevent overloading the backend."),this.F_.f_()):t&&t.code===P.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.U_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.n_(t)})}U_(){}auth(){this.state=1;let e=this.K_(this.b_),t=this.b_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.b_===t&&this.W_(r,i)},r=>{e(()=>{let i=new O(P.UNKNOWN,"Fetching auth token failed: "+r.message);return this.G_(i)})})}W_(e,t){let r=this.K_(this.b_);this.stream=this.z_(e,t),this.stream.Zo(()=>{r(()=>this.listener.Zo())}),this.stream.e_(()=>{r(()=>(this.state=2,this.v_=this.Fi.enqueueAfterDelay(this.S_,1e4,()=>(this.x_()&&(this.state=3),Promise.resolve())),this.listener.e_()))}),this.stream.n_(i=>{r(()=>this.G_(i))}),this.stream.onMessage(i=>{r(()=>++this.C_==1?this.j_(i):this.onNext(i))})}O_(){this.state=5,this.F_.g_(()=>m(this,null,function*(){this.state=0,this.start()}))}G_(e){return V(gp,`close with error: ${e}`),this.stream=null,this.close(4,e)}K_(e){return t=>{this.Fi.enqueueAndForget(()=>this.b_===e?t():(V(gp,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Bu=class extends Xs{constructor(e,t,r,i,s,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,a),this.serializer=s}z_(e,t){return this.connection.P_("Listen",e,t)}j_(e){return this.onNext(e)}onNext(e){this.F_.reset();let t=bE(this.serializer,e),r=(function(s){if(!("targetChange"in s))return B.min();let a=s.targetChange;return a.targetIds&&a.targetIds.length?B.min():a.readTime?ot(a.readTime):B.min()})(e);return this.listener.J_(t,r)}H_(e){let t={};t.database=hu(this.serializer),t.addTarget=(function(s,a){let c,l=a.target;if(c=Yc(l)?{documents:PE(s,l)}:{query:CE(s,l).Vt},c.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){c.resumeToken=Em(s,a.resumeToken);let d=cu(s,a.expectedCount);d!==null&&(c.expectedCount=d)}else if(a.snapshotVersion.compareTo(B.min())>0){c.readTime=Ws(s,a.snapshotVersion.toTimestamp());let d=cu(s,a.expectedCount);d!==null&&(c.expectedCount=d)}return c})(this.serializer,e);let r=DE(this.serializer,e);r&&(t.labels=r),this.k_(t)}Y_(e){let t={};t.database=hu(this.serializer),t.removeTarget=e,this.k_(t)}},$u=class extends Xs{constructor(e,t,r,i,s,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,a),this.serializer=s}get Z_(){return this.C_>0}start(){this.lastStreamToken=void 0,super.start()}U_(){this.Z_&&this.X_([])}z_(e,t){return this.connection.P_("Write",e,t)}j_(e){return J(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,J(!e.writeResults||e.writeResults.length===0,55816),this.listener.ea()}onNext(e){J(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.F_.reset();let t=RE(e.writeResults,e.commitTime),r=ot(e.commitTime);return this.listener.ta(r,t)}na(){let e={};e.database=hu(this.serializer),this.k_(e)}X_(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>SE(this.serializer,r))};this.k_(t)}};var ju=class{},zu=class extends ju{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.ra=!1}ia(){if(this.ra)throw new O(P.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,r,i){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Wo(e,uu(t,r),i,s,a)).catch(s=>{throw s.name==="FirebaseError"?(s.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new O(P.UNKNOWN,s.toString())})}Jo(e,t,r,i,s){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,c])=>this.connection.Jo(e,uu(t,r),i,a,c,s)).catch(a=>{throw a.name==="FirebaseError"?(a.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new O(P.UNKNOWN,a.toString())})}terminate(){this.ra=!0,this.connection.terminate()}},Wu=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.sa=0,this.oa=null,this._a=!0}aa(){this.sa===0&&(this.ua("Unknown"),this.oa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.oa=null,this.ca("Backend didn't respond within 10 seconds."),this.ua("Offline"),Promise.resolve())))}la(e){this.state==="Online"?this.ua("Unknown"):(this.sa++,this.sa>=1&&(this.ha(),this.ca(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ua("Offline")))}set(e){this.ha(),this.sa=0,e==="Online"&&(this._a=!1),this.ua(e)}ua(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ca(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this._a?(It(t),this._a=!1):V("OnlineStateTracker",t)}ha(){this.oa!==null&&(this.oa.cancel(),this.oa=null)}};var Sn="RemoteStore",Gu=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Pa=[],this.Ta=new Map,this.Ia=new Set,this.da=[],this.Ea=s,this.Ea.xo(a=>{r.enqueueAndForget(()=>m(this,null,function*(){Rn(this)&&(V(Sn,"Restarting streams for network reachability change."),yield(function(l){return m(this,null,function*(){let d=q(l);d.Ia.add(4),yield Ai(d),d.Aa.set("Unknown"),d.Ia.delete(4),yield Io(d)})})(this))}))}),this.Aa=new Wu(r,i)}};function Io(n){return m(this,null,function*(){if(Rn(n))for(let e of n.da)yield e(!0)})}function Ai(n){return m(this,null,function*(){for(let e of n.da)yield e(!1)})}function Nm(n,e){let t=q(n);t.Ta.has(e.targetId)||(t.Ta.set(e.targetId,e),Pl(t)?Rl(t):fr(t).x_()&&Sl(t,e))}function bl(n,e){let t=q(n),r=fr(t);t.Ta.delete(e),r.x_()&&Om(t,e),t.Ta.size===0&&(r.x_()?r.B_():Rn(t)&&t.Aa.set("Unknown"))}function Sl(n,e){if(n.Ra.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(B.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}fr(n).H_(e)}function Om(n,e){n.Ra.$e(e),fr(n).Y_(e)}function Rl(n){n.Ra=new ou({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),Et:e=>n.Ta.get(e)||null,lt:()=>n.datastore.serializer.databaseId}),fr(n).start(),n.Aa.aa()}function Pl(n){return Rn(n)&&!fr(n).M_()&&n.Ta.size>0}function Rn(n){return q(n).Ia.size===0}function xm(n){n.Ra=void 0}function HE(n){return m(this,null,function*(){n.Aa.set("Online")})}function QE(n){return m(this,null,function*(){n.Ta.forEach((e,t)=>{Sl(n,e)})})}function JE(n,e){return m(this,null,function*(){xm(n),Pl(n)?(n.Aa.la(e),Rl(n)):n.Aa.set("Unknown")})}function YE(n,e,t){return m(this,null,function*(){if(n.Aa.set("Online"),e instanceof js&&e.state===2&&e.cause)try{yield(function(i,s){return m(this,null,function*(){let a=s.cause;for(let c of s.targetIds)i.Ta.has(c)&&(yield i.remoteSyncer.rejectListen(c,a),i.Ta.delete(c),i.Ra.removeTarget(c))})})(n,e)}catch(r){V(Sn,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Zs(n,r)}else if(e instanceof Jn?n.Ra.Ye(e):e instanceof $s?n.Ra.it(e):n.Ra.et(e),!t.isEqual(B.min()))try{let r=yield Dm(n.localStore);t.compareTo(r)>=0&&(yield(function(s,a){let c=s.Ra.Pt(a);return c.targetChanges.forEach((l,d)=>{if(l.resumeToken.approximateByteSize()>0){let p=s.Ta.get(d);p&&s.Ta.set(d,p.withResumeToken(l.resumeToken,a))}}),c.targetMismatches.forEach((l,d)=>{let p=s.Ta.get(l);if(!p)return;s.Ta.set(l,p.withResumeToken(Ae.EMPTY_BYTE_STRING,p.snapshotVersion)),Om(s,l);let _=new pi(p.target,l,d,p.sequenceNumber);Sl(s,_)}),s.remoteSyncer.applyRemoteEvent(c)})(n,t))}catch(r){V(Sn,"Failed to raise snapshot:",r),yield Zs(n,r)}})}function Zs(n,e,t){return m(this,null,function*(){if(!dr(e))throw e;n.Ia.add(1),yield Ai(n),n.Aa.set("Offline"),t||(t=()=>Dm(n.localStore)),n.asyncQueue.enqueueRetryable(()=>m(null,null,function*(){V(Sn,"Retrying IndexedDB access"),yield t(),n.Ia.delete(1),yield Io(n)}))})}function Vm(n,e){return e().catch(t=>Zs(n,t,e))}function wo(n){return m(this,null,function*(){let e=q(n),t=Yt(e),r=e.Pa.length>0?e.Pa[e.Pa.length-1].batchId:ml;for(;XE(e);)try{let i=yield zE(e.localStore,r);if(i===null){e.Pa.length===0&&t.B_();break}r=i.batchId,ZE(e,i)}catch(i){yield Zs(e,i)}Lm(e)&&Mm(e)})}function XE(n){return Rn(n)&&n.Pa.length<10}function ZE(n,e){n.Pa.push(e);let t=Yt(n);t.x_()&&t.Z_&&t.X_(e.mutations)}function Lm(n){return Rn(n)&&!Yt(n).M_()&&n.Pa.length>0}function Mm(n){Yt(n).start()}function eT(n){return m(this,null,function*(){Yt(n).na()})}function tT(n){return m(this,null,function*(){let e=Yt(n);for(let t of n.Pa)e.X_(t.mutations)})}function nT(n,e,t){return m(this,null,function*(){let r=n.Pa.shift(),i=nu.from(r,e,t);yield Vm(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield wo(n)})}function rT(n,e){return m(this,null,function*(){e&&Yt(n).Z_&&(yield(function(r,i){return m(this,null,function*(){if((function(a){return yE(a)&&a!==P.ABORTED})(i.code)){let s=r.Pa.shift();Yt(r).N_(),yield Vm(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield wo(r)}})})(n,e)),Lm(n)&&Mm(n)})}function _p(n,e){return m(this,null,function*(){let t=q(n);t.asyncQueue.verifyOperationInProgress(),V(Sn,"RemoteStore received new credentials");let r=Rn(t);t.Ia.add(3),yield Ai(t),r&&t.Aa.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.Ia.delete(3),yield Io(t)})}function iT(n,e){return m(this,null,function*(){let t=q(n);e?(t.Ia.delete(2),yield Io(t)):e||(t.Ia.add(2),yield Ai(t),t.Aa.set("Unknown"))})}function fr(n){return n.Va||(n.Va=(function(t,r,i){let s=q(t);return s.ia(),new Bu(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)})(n.datastore,n.asyncQueue,{Zo:HE.bind(null,n),e_:QE.bind(null,n),n_:JE.bind(null,n),J_:YE.bind(null,n)}),n.da.push(e=>m(null,null,function*(){e?(n.Va.N_(),Pl(n)?Rl(n):n.Aa.set("Unknown")):(yield n.Va.stop(),xm(n))}))),n.Va}function Yt(n){return n.ma||(n.ma=(function(t,r,i){let s=q(t);return s.ia(),new $u(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)})(n.datastore,n.asyncQueue,{Zo:()=>Promise.resolve(),e_:eT.bind(null,n),n_:rT.bind(null,n),ea:tT.bind(null,n),ta:nT.bind(null,n)}),n.da.push(e=>m(null,null,function*(){e?(n.ma.N_(),yield wo(n)):(yield n.ma.stop(),n.Pa.length>0&&(V(Sn,`Stopping write stream with ${n.Pa.length} pending writes`),n.Pa=[]))}))),n.ma}var Ku=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Ke,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let a=Date.now()+r,c=new n(e,t,a,i,s);return c.start(r),c}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new O(P.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Cl(n,e){if(It("AsyncQueue",`${e}: ${n}`),dr(n))return new O(P.UNAVAILABLE,`${e}: ${n}`);throw n}var eo=class n{static emptySet(e){return new n(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||L.comparator(t.key,r.key):(t,r)=>L.comparator(t.key,r.key),this.keyedMap=ni(),this.sortedSet=new oe(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var to=class{constructor(){this.fa=new oe(L.comparator)}track(e){let t=e.doc.key,r=this.fa.get(t);r?e.type!==0&&r.type===3?this.fa=this.fa.insert(t,e):e.type===3&&r.type!==1?this.fa=this.fa.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.fa=this.fa.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.fa=this.fa.remove(t):e.type===1&&r.type===2?this.fa=this.fa.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):M(63341,{At:e,ga:r}):this.fa=this.fa.insert(t,e)}pa(){let e=[];return this.fa.inorderTraversal((t,r)=>{e.push(r)}),e}},ar=class n{constructor(e,t,r,i,s,a,c,l,d){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=c,this.excludesMetadataChanges=l,this.hasCachedResults=d}static fromInitialDocuments(e,t,r,i,s){let a=[];return t.forEach(c=>{a.push({type:0,doc:c})}),new n(e,t,eo.emptySet(t),a,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&_o(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var Hu=class{constructor(){this.ya=void 0,this.wa=[]}Sa(){return this.wa.some(e=>e.ba())}},Qu=class{constructor(){this.queries=yp(),this.onlineState="Unknown",this.Da=new Set}terminate(){(function(t,r){let i=q(t),s=i.queries;i.queries=yp(),s.forEach((a,c)=>{for(let l of c.wa)l.onError(r)})})(this,new O(P.ABORTED,"Firestore shutting down"))}};function yp(){return new Tt(n=>um(n),_o)}function kl(n,e){return m(this,null,function*(){let t=q(n),r=3,i=e.query,s=t.queries.get(i);s?!s.Sa()&&e.ba()&&(r=2):(s=new Hu,r=e.ba()?0:1);try{switch(r){case 0:s.ya=yield t.onListen(i,!0);break;case 1:s.ya=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(a){let c=Cl(a,`Initialization of query '${Gn(e.query)}' failed`);return void e.onError(c)}t.queries.set(i,s),s.wa.push(e),e.va(t.onlineState),s.ya&&e.Ca(s.ya)&&Nl(t)})}function Dl(n,e){return m(this,null,function*(){let t=q(n),r=e.query,i=3,s=t.queries.get(r);if(s){let a=s.wa.indexOf(e);a>=0&&(s.wa.splice(a,1),s.wa.length===0?i=e.ba()?0:1:!s.Sa()&&e.ba()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function sT(n,e){let t=q(n),r=!1;for(let i of e){let s=i.query,a=t.queries.get(s);if(a){for(let c of a.wa)c.Ca(i)&&(r=!0);a.ya=i}}r&&Nl(t)}function oT(n,e,t){let r=q(n),i=r.queries.get(e);if(i)for(let s of i.wa)s.onError(t);r.queries.delete(e)}function Nl(n){n.Da.forEach(e=>{e.next()})}var Ju,vp;(vp=Ju||(Ju={})).Fa="default",vp.Cache="cache";var _i=class{constructor(e,t,r){this.query=e,this.Ma=t,this.xa=!1,this.Oa=null,this.onlineState="Unknown",this.options=r||{}}Ca(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new ar(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.xa?this.Na(e)&&(this.Ma.next(e),t=!0):this.Ba(e,this.onlineState)&&(this.La(e),t=!0),this.Oa=e,t}onError(e){this.Ma.error(e)}va(e){this.onlineState=e;let t=!1;return this.Oa&&!this.xa&&this.Ba(this.Oa,e)&&(this.La(this.Oa),t=!0),t}Ba(e,t){if(!e.fromCache||!this.ba())return!0;let r=t!=="Offline";return(!this.options.ka||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Na(e){if(e.docChanges.length>0)return!0;let t=this.Oa&&this.Oa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}La(e){e=ar.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.xa=!0,this.Ma.next(e)}ba(){return this.options.source!==Ju.Cache}};var no=class{constructor(e){this.key=e}},ro=class{constructor(e){this.key=e}},Yu=class{constructor(e,t){this.query=e,this.Ha=t,this.Ya=null,this.hasCachedResults=!1,this.current=!1,this.Za=G(),this.mutatedKeys=G(),this.Xa=lm(e),this.eu=new eo(this.Xa)}get tu(){return this.Ha}nu(e,t){let r=t?t.ru:new to,i=t?t.eu:this.eu,s=t?t.mutatedKeys:this.mutatedKeys,a=i,c=!1,l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,d=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((p,_)=>{let I=i.get(p),R=yo(this.query,_)?_:null,k=!!I&&this.mutatedKeys.has(I.key),x=!!R&&(R.hasLocalMutations||this.mutatedKeys.has(R.key)&&R.hasCommittedMutations),D=!1;I&&R?I.data.isEqual(R.data)?k!==x&&(r.track({type:3,doc:R}),D=!0):this.iu(I,R)||(r.track({type:2,doc:R}),D=!0,(l&&this.Xa(R,l)>0||d&&this.Xa(R,d)<0)&&(c=!0)):!I&&R?(r.track({type:0,doc:R}),D=!0):I&&!R&&(r.track({type:1,doc:I}),D=!0,(l||d)&&(c=!0)),D&&(R?(a=a.add(R),s=x?s.add(p):s.delete(p)):(a=a.delete(p),s=s.delete(p)))}),this.query.limit!==null)for(;a.size>this.query.limit;){let p=this.query.limitType==="F"?a.last():a.first();a=a.delete(p.key),s=s.delete(p.key),r.track({type:1,doc:p})}return{eu:a,ru:r,Ds:c,mutatedKeys:s}}iu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.eu;this.eu=e.eu,this.mutatedKeys=e.mutatedKeys;let a=e.ru.pa();a.sort((p,_)=>(function(R,k){let x=D=>{switch(D){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return M(20277,{At:D})}};return x(R)-x(k)})(p.type,_.type)||this.Xa(p.doc,_.doc)),this.su(r),i=i!=null&&i;let c=t&&!i?this.ou():[],l=this.Za.size===0&&this.current&&!i?1:0,d=l!==this.Ya;return this.Ya=l,a.length!==0||d?{snapshot:new ar(this.query,e.eu,s,a,e.mutatedKeys,l===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),_u:c}:{_u:c}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({eu:this.eu,ru:new to,mutatedKeys:this.mutatedKeys,Ds:!1},!1)):{_u:[]}}au(e){return!this.Ha.has(e)&&!!this.eu.has(e)&&!this.eu.get(e).hasLocalMutations}su(e){e&&(e.addedDocuments.forEach(t=>this.Ha=this.Ha.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ha=this.Ha.delete(t)),this.current=e.current)}ou(){if(!this.current)return[];let e=this.Za;this.Za=G(),this.eu.forEach(r=>{this.au(r.key)&&(this.Za=this.Za.add(r.key))});let t=[];return e.forEach(r=>{this.Za.has(r)||t.push(new ro(r))}),this.Za.forEach(r=>{e.has(r)||t.push(new no(r))}),t}uu(e){this.Ha=e.qs,this.Za=G();let t=this.nu(e.documents);return this.applyChanges(t,!0)}cu(){return ar.fromInitialDocuments(this.query,this.eu,this.mutatedKeys,this.Ya===0,this.hasCachedResults)}},Ol="SyncEngine",Xu=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},Zu=class{constructor(e){this.key=e,this.lu=!1}},el=class{constructor(e,t,r,i,s,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.hu={},this.Pu=new Tt(c=>um(c),_o),this.Tu=new Map,this.Iu=new Set,this.du=new oe(L.comparator),this.Eu=new Map,this.Au=new gi,this.Ru={},this.Vu=new Map,this.mu=mi.ur(),this.onlineState="Unknown",this.fu=void 0}get isPrimaryClient(){return this.fu===!0}};function aT(n,e,t=!0){return m(this,null,function*(){let r=jm(n),i,s=r.Pu.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.cu()):i=yield Fm(r,e,t,!0),i})}function cT(n,e){return m(this,null,function*(){let t=jm(n);yield Fm(t,e,!0,!1)})}function Fm(n,e,t,r){return m(this,null,function*(){let i=yield WE(n.localStore,it(e)),s=i.targetId,a=n.sharedClientState.addLocalQueryTarget(s,t),c;return r&&(c=yield uT(n,e,s,a==="current",i.resumeToken)),n.isPrimaryClient&&t&&Nm(n.remoteStore,i),c})}function uT(n,e,t,r,i){return m(this,null,function*(){n.gu=(_,I,R)=>(function(x,D,$,U){return m(this,null,function*(){let j=D.view.nu($);j.Ds&&(j=yield pp(x.localStore,D.query,!1).then(({documents:E})=>D.view.nu(E,j)));let X=U&&U.targetChanges.get(D.targetId),be=U&&U.targetMismatches.get(D.targetId)!=null,Y=D.view.applyChanges(j,x.isPrimaryClient,X,be);return wp(x,D.targetId,Y._u),Y.snapshot})})(n,_,I,R);let s=yield pp(n.localStore,e,!0),a=new Yu(e,s.qs),c=a.nu(s.documents),l=fi.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),d=a.applyChanges(c,n.isPrimaryClient,l);wp(n,t,d._u);let p=new Xu(e,t,a);return n.Pu.set(e,p),n.Tu.has(t)?n.Tu.get(t).push(e):n.Tu.set(t,[e]),d.snapshot})}function lT(n,e,t){return m(this,null,function*(){let r=q(n),i=r.Pu.get(e),s=r.Tu.get(i.targetId);if(s.length>1)return r.Tu.set(i.targetId,s.filter(a=>!_o(a,e))),void r.Pu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield xu(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&bl(r.remoteStore,i.targetId),tl(r,i.targetId)}).catch(hr))):(tl(r,i.targetId),yield xu(r.localStore,i.targetId,!0))})}function hT(n,e){return m(this,null,function*(){let t=q(n),r=t.Pu.get(e),i=t.Tu.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),bl(t.remoteStore,r.targetId))})}function dT(n,e,t){return m(this,null,function*(){let r=vT(n);try{let i=yield(function(a,c){let l=q(a),d=K.now(),p=c.reduce((R,k)=>R.add(k.key),G()),_,I;return l.persistence.runTransaction("Locally write mutations","readwrite",R=>{let k=At(),x=G();return l.Os.getEntries(R,p).next(D=>{k=D,k.forEach(($,U)=>{U.isValidDocument()||(x=x.add($))})}).next(()=>l.localDocuments.getOverlayedDocuments(R,k)).next(D=>{_=D;let $=[];for(let U of c){let j=_E(U,_.get(U.key).overlayedDocument);j!=null&&$.push(new ct(U.key,j,nm(j.value.mapValue),st.exists(!0)))}return l.mutationQueue.addMutationBatch(R,d,$,c)}).next(D=>{I=D;let $=D.applyToLocalDocumentSet(_,x);return l.documentOverlayCache.saveOverlays(R,D.batchId,$)})}).then(()=>({batchId:I.batchId,changes:dm(_)}))})(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),(function(a,c,l){let d=a.Ru[a.currentUser.toKey()];d||(d=new oe(z)),d=d.insert(c,l),a.Ru[a.currentUser.toKey()]=d})(r,i.batchId,t),yield bi(r,i.changes),yield wo(r.remoteStore)}catch(i){let s=Cl(i,"Failed to persist write");t.reject(s)}})}function Um(n,e){return m(this,null,function*(){let t=q(n);try{let r=yield $E(t.localStore,e);e.targetChanges.forEach((i,s)=>{let a=t.Eu.get(s);a&&(J(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?a.lu=!0:i.modifiedDocuments.size>0?J(a.lu,14607):i.removedDocuments.size>0&&(J(a.lu,42227),a.lu=!1))}),yield bi(t,r,e)}catch(r){yield hr(r)}})}function Ip(n,e,t){let r=q(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.Pu.forEach((s,a)=>{let c=a.view.va(e);c.snapshot&&i.push(c.snapshot)}),(function(a,c){let l=q(a);l.onlineState=c;let d=!1;l.queries.forEach((p,_)=>{for(let I of _.wa)I.va(c)&&(d=!0)}),d&&Nl(l)})(r.eventManager,e),i.length&&r.hu.J_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function fT(n,e,t){return m(this,null,function*(){let r=q(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.Eu.get(e),s=i&&i.key;if(s){let a=new oe(L.comparator);a=a.insert(s,He.newNoDocument(s,B.min()));let c=G().add(s),l=new Bs(B.min(),new Map,new oe(z),a,c);yield Um(r,l),r.du=r.du.remove(s),r.Eu.delete(e),xl(r)}else yield xu(r.localStore,e,!1).then(()=>tl(r,e,t)).catch(hr)})}function pT(n,e){return m(this,null,function*(){let t=q(n),r=e.batch.batchId;try{let i=yield BE(t.localStore,e);Bm(t,r,null),qm(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield bi(t,i)}catch(i){yield hr(i)}})}function mT(n,e,t){return m(this,null,function*(){let r=q(n);try{let i=yield(function(a,c){let l=q(a);return l.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let p;return l.mutationQueue.lookupMutationBatch(d,c).next(_=>(J(_!==null,37113),p=_.keys(),l.mutationQueue.removeMutationBatch(d,_))).next(()=>l.mutationQueue.performConsistencyCheck(d)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(d,p,c)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,p)).next(()=>l.localDocuments.getDocuments(d,p))})})(r.localStore,e);Bm(r,e,t),qm(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield bi(r,i)}catch(i){yield hr(i)}})}function qm(n,e){(n.Vu.get(e)||[]).forEach(t=>{t.resolve()}),n.Vu.delete(e)}function Bm(n,e,t){let r=q(n),i=r.Ru[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Ru[r.currentUser.toKey()]=i}}function tl(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.Tu.get(e))n.Pu.delete(r),t&&n.hu.pu(r,t);n.Tu.delete(e),n.isPrimaryClient&&n.Au.zr(e).forEach(r=>{n.Au.containsKey(r)||$m(n,r)})}function $m(n,e){n.Iu.delete(e.path.canonicalString());let t=n.du.get(e);t!==null&&(bl(n.remoteStore,t),n.du=n.du.remove(e),n.Eu.delete(t),xl(n))}function wp(n,e,t){for(let r of t)r instanceof no?(n.Au.addReference(r.key,e),gT(n,r)):r instanceof ro?(V(Ol,"Document no longer in limbo: "+r.key),n.Au.removeReference(r.key,e),n.Au.containsKey(r.key)||$m(n,r.key)):M(19791,{yu:r})}function gT(n,e){let t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Iu.has(r)||(V(Ol,"New document in limbo: "+t),n.Iu.add(r),xl(n))}function xl(n){for(;n.Iu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){let e=n.Iu.values().next().value;n.Iu.delete(e);let t=new L(re.fromString(e)),r=n.mu.next();n.Eu.set(r,new Zu(t)),n.du=n.du.insert(t,r),Nm(n.remoteStore,new pi(it(go(t.path)),r,"TargetPurposeLimboResolution",pl.ue))}}function bi(n,e,t){return m(this,null,function*(){let r=q(n),i=[],s=[],a=[];r.Pu.isEmpty()||(r.Pu.forEach((c,l)=>{a.push(r.gu(l,e,t).then(d=>{var p;if((d||t)&&r.isPrimaryClient){let _=d?!d.fromCache:(p=t?.targetChanges.get(l.targetId))===null||p===void 0?void 0:p.current;r.sharedClientState.updateQueryState(l.targetId,_?"current":"not-current")}if(d){i.push(d);let _=ku.Es(l.targetId,d);s.push(_)}}))}),yield Promise.all(a),r.hu.J_(i),yield(function(l,d){return m(this,null,function*(){let p=q(l);try{yield p.persistence.runTransaction("notifyLocalViewChanges","readwrite",_=>C.forEach(d,I=>C.forEach(I.Is,R=>p.persistence.referenceDelegate.addReference(_,I.targetId,R)).next(()=>C.forEach(I.ds,R=>p.persistence.referenceDelegate.removeReference(_,I.targetId,R)))))}catch(_){if(!dr(_))throw _;V(Al,"Failed to update sequence numbers: "+_)}for(let _ of d){let I=_.targetId;if(!_.fromCache){let R=p.Fs.get(I),k=R.snapshotVersion,x=R.withLastLimboFreeSnapshotVersion(k);p.Fs=p.Fs.insert(I,x)}}})})(r.localStore,s))})}function _T(n,e){return m(this,null,function*(){let t=q(n);if(!t.currentUser.isEqual(e)){V(Ol,"User change. New user:",e.toKey());let r=yield km(t.localStore,e);t.currentUser=e,(function(s,a){s.Vu.forEach(c=>{c.forEach(l=>{l.reject(new O(P.CANCELLED,a))})}),s.Vu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield bi(t,r.Bs)}})}function yT(n,e){let t=q(n),r=t.Eu.get(e);if(r&&r.lu)return G().add(r.key);{let i=G(),s=t.Tu.get(e);if(!s)return i;for(let a of s){let c=t.Pu.get(a);i=i.unionWith(c.view.tu)}return i}}function jm(n){let e=q(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Um.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=yT.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=fT.bind(null,e),e.hu.J_=sT.bind(null,e.eventManager),e.hu.pu=oT.bind(null,e.eventManager),e}function vT(n){let e=q(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=pT.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=mT.bind(null,e),e}var zm=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return m(this,null,function*(){this.serializer=vo(t.databaseInfo.databaseId),this.sharedClientState=this.bu(t),this.persistence=this.Du(t),yield this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Cu(t,this.localStore),this.indexBackfillerScheduler=this.Fu(t,this.localStore)})}Cu(t,r){return null}Fu(t,r){return null}vu(t){return qE(this.persistence,new Nu,t.initialUser,this.serializer)}Du(t){return new Ks(Cu.Vi,this.serializer)}bu(t){return new Vu}terminate(){return m(this,null,function*(){var t,r;(t=this.gcScheduler)===null||t===void 0||t.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})(),nl=class extends zm{constructor(e){super(),this.cacheSizeBytes=e}Cu(e,t){J(this.persistence.referenceDelegate instanceof Hs,46915);let r=this.persistence.referenceDelegate.garbageCollector;return new gu(r,e.asyncQueue,t)}Du(e){let t=this.cacheSizeBytes!==void 0?qe.withCacheSize(this.cacheSizeBytes):qe.DEFAULT;return new Ks(r=>Hs.Vi(r,t),this.serializer)}};var IT=(()=>{class n{initialize(t,r){return m(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>Ip(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=_T.bind(null,this.syncEngine),yield iT(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return(function(){return new Qu})()}createDatastore(t){let r=vo(t.databaseInfo.databaseId),i=(function(a){return new qu(a)})(t.databaseInfo);return(function(a,c,l,d){return new zu(a,c,l,d)})(t.authCredentials,t.appCheckCredentials,i,r)}createRemoteStore(t){return(function(i,s,a,c,l){return new Gu(i,s,a,c,l)})(this.localStore,this.datastore,t.asyncQueue,r=>Ip(this.syncEngine,r,0),(function(){return Js.C()?new Js:new Lu})())}createSyncEngine(t,r){return(function(s,a,c,l,d,p,_){let I=new el(s,a,c,l,d,p);return _&&(I.fu=!0),I})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,r)}terminate(){return m(this,null,function*(){var t,r;yield(function(s){return m(this,null,function*(){let a=q(s);V(Sn,"RemoteStore shutting down."),a.Ia.add(5),yield Ai(a),a.Ea.shutdown(),a.Aa.set("Unknown")})})(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()})}}return n.provider={build:()=>new n},n})();var yi=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.xu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.xu(this.observer.error,e):It("Uncaught Error in snapshot listener:",e.toString()))}Ou(){this.muted=!0}xu(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var Xt="FirestoreClient",rl=class{constructor(e,t,r,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=ge.UNAUTHENTICATED,this.clientId=ai.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,a=>m(this,null,function*(){V(Xt,"Received user=",a.uid),yield this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,a=>(V(Xt,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new Ke;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>m(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=Cl(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function Cc(n,e){return m(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),V(Xt,"Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>m(null,null,function*(){r.isEqual(i)||(yield km(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>{Ht("Terminating Firestore due to IndexedDb database deletion"),n.terminate().then(()=>{V("Terminating Firestore due to IndexedDb database deletion completed successfully")}).catch(i=>{Ht("Terminating Firestore due to IndexedDb database deletion failed",i)})}),n._offlineComponents=e})}function Ep(n,e){return m(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield wT(n);V(Xt,"Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>_p(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>_p(e.remoteStore,i)),n._onlineComponents=e})}function wT(n){return m(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){V(Xt,"Using user provided OfflineComponentProvider");try{yield Cc(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!(function(i){return i.name==="FirebaseError"?i.code===P.FAILED_PRECONDITION||i.code===P.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11})(t))throw t;Ht("Error using user provided cache. Falling back to memory cache: "+t),yield Cc(n,new zm)}}else V(Xt,"Using default OfflineComponentProvider"),yield Cc(n,new nl(void 0));return n._offlineComponents})}function Wm(n){return m(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(V(Xt,"Using user provided OnlineComponentProvider"),yield Ep(n,n._uninitializedComponentsProvider._online)):(V(Xt,"Using default OnlineComponentProvider"),yield Ep(n,new IT))),n._onlineComponents})}function ET(n){return Wm(n).then(e=>e.syncEngine)}function io(n){return m(this,null,function*(){let e=yield Wm(n),t=e.eventManager;return t.onListen=aT.bind(null,e.syncEngine),t.onUnlisten=lT.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=cT.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=hT.bind(null,e.syncEngine),t})}function TT(n,e,t={}){let r=new Ke;return n.asyncQueue.enqueueAndForget(()=>m(null,null,function*(){return(function(s,a,c,l,d){let p=new yi({next:I=>{p.Ou(),a.enqueueAndForget(()=>Dl(s,_));let R=I.docs.has(c);!R&&I.fromCache?d.reject(new O(P.UNAVAILABLE,"Failed to get document because the client is offline.")):R&&I.fromCache&&l&&l.source==="server"?d.reject(new O(P.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(I)},error:I=>d.reject(I)}),_=new _i(go(c.path),p,{includeMetadataChanges:!0,ka:!0});return kl(s,_)})(yield io(n),n.asyncQueue,e,t,r)})),r.promise}function AT(n,e,t={}){let r=new Ke;return n.asyncQueue.enqueueAndForget(()=>m(null,null,function*(){return(function(s,a,c,l,d){let p=new yi({next:I=>{p.Ou(),a.enqueueAndForget(()=>Dl(s,_)),I.fromCache&&l.source==="server"?d.reject(new O(P.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(I)},error:I=>d.reject(I)}),_=new _i(c,p,{includeMetadataChanges:!0,ka:!0});return kl(s,_)})(yield io(n),n.asyncQueue,e,t,r)})),r.promise}function Gm(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var Tp=new Map;var Km="firestore.googleapis.com",Ap=!0,so=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new O(P.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Km,this.ssl=Ap}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:Ap;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Cm;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<ME)throw new O(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}xw("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Gm((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),(function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new O(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new O(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new O(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,i){return r.timeoutSeconds===i.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},cr=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new so({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new O(P.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new O(P.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new so(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new kc;switch(r.type){case"firstParty":return new xc(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new O(P.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return m(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){let r=Tp.get(t);r&&(V("ComponentProvider","Removing Datastore"),Tp.delete(t),r.terminate())})(this),Promise.resolve()}};function Hm(n,e,t,r={}){var i;n=De(n,cr);let s=Ot(e),a=n._getSettings(),c=Object.assign(Object.assign({},a),{emulatorOptions:n._getEmulatorOptions()}),l=`${e}:${t}`;s&&(Xi(`https://${l}`),Zi("Firestore",!0)),a.host!==Km&&a.host!==l&&Ht("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let d=Object.assign(Object.assign({},a),{host:l,ssl:s,emulatorOptions:r});if(!Xe(d,c)&&(n._setSettings(d),r.mockUserToken)){let p,_;if(typeof r.mockUserToken=="string")p=r.mockUserToken,_=ge.MOCK_USER;else{p=ed(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let I=r.mockUserToken.sub||r.mockUserToken.user_id;if(!I)throw new O(P.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");_=new ge(I)}n._authCredentials=new Dc(new Ns(p,_))}}var bt=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},pe=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new zt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}toJSON(){return{type:n._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(Ti(t,n._jsonSchema))return new n(e,r||null,new L(re.fromString(t.referencePath)))}};pe._jsonSchemaVersion="firestore/documentReference/1.0",pe._jsonSchema={type:de("string",pe._jsonSchemaVersion),referencePath:de("string")};var zt=class n extends bt{constructor(e,t,r){super(e,t,go(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new pe(this.firestore,null,new L(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function Qm(n,e,...t){if(n=ce(n),Np("collection","path",e),n instanceof cr){let r=re.fromString(e,...t);return $f(r),new zt(n,null,r)}{if(!(n instanceof pe||n instanceof zt))throw new O(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(re.fromString(e,...t));return $f(r),new zt(n.firestore,null,r)}}function Vl(n,e,...t){if(n=ce(n),arguments.length===1&&(e=ai.newId()),Np("doc","path",e),n instanceof cr){let r=re.fromString(e,...t);return Bf(r),new pe(n,null,new L(r))}{if(!(n instanceof pe||n instanceof zt))throw new O(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(re.fromString(e,...t));return Bf(r),new pe(n.firestore,n instanceof zt?n.converter:null,new L(r))}}var bp="AsyncQueue",oo=class{constructor(e=Promise.resolve()){this.Zu=[],this.Xu=!1,this.ec=[],this.tc=null,this.nc=!1,this.rc=!1,this.sc=[],this.F_=new Ys(this,"async_queue_retry"),this.oc=()=>{let r=Pc();r&&V(bp,"Visibility state changed to "+r.visibilityState),this.F_.y_()},this._c=e;let t=Pc();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.oc)}get isShuttingDown(){return this.Xu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.ac(),this.uc(e)}enterRestrictedMode(e){if(!this.Xu){this.Xu=!0,this.rc=e||!1;let t=Pc();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.oc)}}enqueue(e){if(this.ac(),this.Xu)return new Promise(()=>{});let t=new Ke;return this.uc(()=>this.Xu&&this.rc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Zu.push(e),this.cc()))}cc(){return m(this,null,function*(){if(this.Zu.length!==0){try{yield this.Zu[0](),this.Zu.shift(),this.F_.reset()}catch(e){if(!dr(e))throw e;V(bp,"Operation failed with retryable error: "+e)}this.Zu.length>0&&this.F_.g_(()=>this.cc())}})}uc(e){let t=this._c.then(()=>(this.nc=!0,e().catch(r=>{throw this.tc=r,this.nc=!1,It("INTERNAL UNHANDLED ERROR: ",Sp(r)),r}).then(r=>(this.nc=!1,r))));return this._c=t,t}enqueueAfterDelay(e,t,r){this.ac(),this.sc.indexOf(e)>-1&&(t=0);let i=Ku.createAndSchedule(this,e,t,r,s=>this.lc(s));return this.ec.push(i),i}ac(){this.tc&&M(47125,{hc:Sp(this.tc)})}verifyOperationInProgress(){}Pc(){return m(this,null,function*(){let e;do e=this._c,yield e;while(e!==this._c)})}Tc(e){for(let t of this.ec)if(t.timerId===e)return!0;return!1}Ic(e){return this.Pc().then(()=>{this.ec.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.ec)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Pc()})}dc(e){this.sc.push(e)}lc(e){let t=this.ec.indexOf(e);this.ec.splice(t,1)}};function Sp(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}function Rp(n){return(function(t,r){if(typeof t!="object"||t===null)return!1;let i=t;for(let s of r)if(s in i&&typeof i[s]=="function")return!0;return!1})(n,["next","error","complete"])}var Je=class extends cr{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new oo,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return m(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new oo(e),this._firestoreClient=void 0,yield e}})}};function Jm(n,e){let t=typeof n=="object"?n:an(),r=typeof n=="string"?n:e||Ms,i=Un(t,"firestore").getImmediate({identifier:r});if(!i._initialized){let s=Zh("firestore");s&&Hm(i,...s)}return i}function Eo(n){if(n._terminated)throw new O(P.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||bT(n),n._firestoreClient}function bT(n){var e,t,r;let i=n._freezeSettings(),s=(function(c,l,d,p){return new Uc(c,l,d,p.host,p.ssl,p.experimentalForceLongPolling,p.experimentalAutoDetectLongPolling,Gm(p.experimentalLongPollingOptions),p.useFetchStreams,p.isUsingEmulator)})(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),n._firestoreClient=new rl(n._authCredentials,n._appCheckCredentials,n._queue,s,n._componentsProvider&&(function(c){let l=c?._online.build();return{_offline:c?._offline.build(l),_online:l}})(n._componentsProvider))}var Wt=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(Ae.fromBase64String(e))}catch(t){throw new O(P.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(Ae.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:n._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Ti(e,n._jsonSchema))return n.fromBase64String(e.bytes)}};Wt._jsonSchemaVersion="firestore/bytes/1.0",Wt._jsonSchema={type:de("string",Wt._jsonSchemaVersion),bytes:de("string")};var ur=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new O(P.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Le(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var vi=class{constructor(e){this._methodName=e}};var Gt=class n{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new O(P.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new O(P.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return z(this._lat,e._lat)||z(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:n._jsonSchemaVersion}}static fromJSON(e){if(Ti(e,n._jsonSchema))return new n(e.latitude,e.longitude)}};Gt._jsonSchemaVersion="firestore/geoPoint/1.0",Gt._jsonSchema={type:de("string",Gt._jsonSchemaVersion),latitude:de("number"),longitude:de("number")};var Kt=class n{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return(function(r,i){if(r.length!==i.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0})(this._values,e._values)}toJSON(){return{type:n._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Ti(e,n._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new n(e.vectorValues);throw new O(P.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}};Kt._jsonSchemaVersion="firestore/vectorValue/1.0",Kt._jsonSchema={type:de("string",Kt._jsonSchemaVersion),vectorValues:de("object")};var ST=/^__.*__$/,il=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new ct(e,this.data,this.fieldMask,t,this.fieldTransforms):new bn(e,this.data,t,this.fieldTransforms)}},ao=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new ct(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function Ym(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw M(40011,{Ec:n})}}var sl=class n{constructor(e,t,r,i,s,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.Ac(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ec(){return this.settings.Ec}Rc(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Vc(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Rc({path:r,mc:!1});return i.fc(e),i}gc(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Rc({path:r,mc:!1});return i.Ac(),i}yc(e){return this.Rc({path:void 0,mc:!0})}wc(e){return uo(e,this.settings.methodName,this.settings.Sc||!1,this.path,this.settings.bc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Ac(){if(this.path)for(let e=0;e<this.path.length;e++)this.fc(this.path.get(e))}fc(e){if(e.length===0)throw this.wc("Document fields must not be empty");if(Ym(this.Ec)&&ST.test(e))throw this.wc('Document fields cannot begin and end with "__"')}},ol=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||vo(e)}Dc(e,t,r,i=!1){return new sl({Ec:e,methodName:t,bc:r,path:Le.emptyPath(),mc:!1,Sc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function To(n){let e=n._freezeSettings(),t=vo(n._databaseId);return new ol(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Xm(n,e,t,r,i,s={}){let a=n.Dc(s.merge||s.mergeFields?2:0,e,t,i);Ll("Data must be an object, but it was:",a,r);let c=Zm(r,a),l,d;if(s.merge)l=new Be(a.fieldMask),d=a.fieldTransforms;else if(s.mergeFields){let p=[];for(let _ of s.mergeFields){let I=al(e,_,t);if(!a.contains(I))throw new O(P.INVALID_ARGUMENT,`Field '${I}' is specified in your field mask but missing from your input data.`);tg(p,I)||p.push(I)}l=new Be(p),d=a.fieldTransforms.filter(_=>l.covers(_.field))}else l=null,d=a.fieldTransforms;return new il(new Ve(c),l,d)}var co=class n extends vi{_toFieldTransform(e){if(e.Ec!==2)throw e.Ec===1?e.wc(`${this._methodName}() can only appear at the top level of your update data`):e.wc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}};function RT(n,e,t,r){let i=n.Dc(1,e,t);Ll("Data must be an object, but it was:",i,r);let s=[],a=Ve.empty();Zt(r,(l,d)=>{let p=Ml(e,l,t);d=ce(d);let _=i.gc(p);if(d instanceof co)s.push(p);else{let I=Si(d,_);I!=null&&(s.push(p),a.set(p,I))}});let c=new Be(s);return new ao(a,c,i.fieldTransforms)}function PT(n,e,t,r,i,s){let a=n.Dc(1,e,t),c=[al(e,r,t)],l=[i];if(s.length%2!=0)throw new O(P.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let I=0;I<s.length;I+=2)c.push(al(e,s[I])),l.push(s[I+1]);let d=[],p=Ve.empty();for(let I=c.length-1;I>=0;--I)if(!tg(d,c[I])){let R=c[I],k=l[I];k=ce(k);let x=a.gc(R);if(k instanceof co)d.push(R);else{let D=Si(k,x);D!=null&&(d.push(R),p.set(R,D))}}let _=new Be(d);return new ao(p,_,a.fieldTransforms)}function CT(n,e,t,r=!1){return Si(t,n.Dc(r?4:3,e))}function Si(n,e){if(eg(n=ce(n)))return Ll("Unsupported field value:",e,n),Zm(n,e);if(n instanceof vi)return(function(r,i){if(!Ym(i.Ec))throw i.wc(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.wc(`${r._methodName}() is not currently supported inside arrays`);let s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.mc&&e.Ec!==4)throw e.wc("Nested arrays are not supported");return(function(r,i){let s=[],a=0;for(let c of r){let l=Si(c,i.yc(a));l==null&&(l={nullValue:"NULL_VALUE"}),s.push(l),a++}return{arrayValue:{values:s}}})(n,e)}return(function(r,i){if((r=ce(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return dE(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let s=K.fromDate(r);return{timestampValue:Ws(i.serializer,s)}}if(r instanceof K){let s=new K(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Ws(i.serializer,s)}}if(r instanceof Gt)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Wt)return{bytesValue:Em(i.serializer,r._byteString)};if(r instanceof pe){let s=i.databaseId,a=r.firestore._databaseId;if(!a.isEqual(s))throw i.wc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Tl(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof Kt)return(function(a,c){return{mapValue:{fields:{[_l]:{stringValue:yl},[Zn]:{arrayValue:{values:a.toArray().map(d=>{if(typeof d!="number")throw c.wc("VectorValues must only contain numeric values.");return El(c.serializer,d)})}}}}}})(r,i);throw i.wc(`Unsupported field value: ${fo(r)}`)})(n,e)}function Zm(n,e){let t={};return Hp(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Zt(n,(r,i)=>{let s=Si(i,e.Vc(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function eg(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof K||n instanceof Gt||n instanceof Wt||n instanceof pe||n instanceof vi||n instanceof Kt)}function Ll(n,e,t){if(!eg(t)||!Op(t)){let r=fo(t);throw r==="an object"?e.wc(n+" a custom object"):e.wc(n+" "+r)}}function al(n,e,t){if((e=ce(e))instanceof ur)return e._internalPath;if(typeof e=="string")return Ml(n,e);throw uo("Field path arguments must be of type string or ",n,!1,void 0,t)}var kT=new RegExp("[~\\*/\\[\\]]");function Ml(n,e,t){if(e.search(kT)>=0)throw uo(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new ur(...e.split("."))._internalPath}catch{throw uo(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function uo(n,e,t,r,i){let s=r&&!r.isEmpty(),a=i!==void 0,c=`Function ${e}() called with invalid data`;t&&(c+=" (via `toFirestore()`)"),c+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${r}`),a&&(l+=` in document ${i}`),l+=")"),new O(P.INVALID_ARGUMENT,c+n+l)}function tg(n,e){return n.some(t=>t.isEqual(e))}var lo=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new pe(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new cl(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(Ao("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},cl=class extends lo{data(){return super.data()}};function Ao(n,e){return typeof e=="string"?Ml(n,e):e instanceof ur?e._internalPath:e._delegate._internalPath}function ng(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new O(P.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Ii=class{},wi=class extends Ii{};function rg(n,e,...t){let r=[];e instanceof Ii&&r.push(e),r=r.concat(t),(function(s){let a=s.filter(l=>l instanceof ul).length,c=s.filter(l=>l instanceof ho).length;if(a>1||a>0&&c>0)throw new O(P.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(let i of r)n=i._apply(n);return n}var ho=class n extends wi{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return ag(e._query,t),new bt(e.firestore,e.converter,Xc(e._query,t))}_parse(e){let t=To(e.firestore);return(function(s,a,c,l,d,p,_){let I;if(d.isKeyField()){if(p==="array-contains"||p==="array-contains-any")throw new O(P.INVALID_ARGUMENT,`Invalid Query. You can't perform '${p}' queries on documentId().`);if(p==="in"||p==="not-in"){Cp(_,p);let k=[];for(let x of _)k.push(Pp(l,s,x));I={arrayValue:{values:k}}}else I=Pp(l,s,_)}else p!=="in"&&p!=="not-in"&&p!=="array-contains-any"||Cp(_,p),I=CT(c,a,_,p==="in"||p==="not-in");return he.create(d,p,I)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function ig(n,e,t){let r=e,i=Ao("where",n);return ho._create(i,r,t)}var ul=class n extends Ii{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Qe.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:((function(i,s){let a=i,c=s.getFlattenedFilters();for(let l of c)ag(a,l),a=Xc(a,l)})(e._query,t),new bt(e.firestore,e.converter,Xc(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var ll=class n extends wi{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=(function(i,s,a){if(i.startAt!==null)throw new O(P.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new O(P.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new En(s,a)})(e._query,this._field,this._direction);return new bt(e.firestore,e.converter,(function(i,s){let a=i.explicitOrderBy.concat([s]);return new Jt(i.path,i.collectionGroup,a,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)})(e._query,t))}};function sg(n,e="asc"){let t=e,r=Ao("orderBy",n);return ll._create(r,t)}var hl=class n extends wi{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new bt(e.firestore,e.converter,qs(e._query,this._limit,this._limitType))}};function og(n){return Vw("limit",n),hl._create("limit",n,"F")}function Pp(n,e,t){if(typeof(t=ce(t))=="string"){if(t==="")throw new O(P.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!cm(e)&&t.indexOf("/")!==-1)throw new O(P.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(re.fromString(t));if(!L.isDocumentKey(r))throw new O(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Qf(n,new L(r))}if(t instanceof pe)return Qf(n,t._key);throw new O(P.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${fo(t)}.`)}function Cp(n,e){if(!Array.isArray(n)||n.length===0)throw new O(P.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function ag(n,e){let t=(function(i,s){for(let a of i)for(let c of a.getFlattenedFilters())if(s.indexOf(c.op)>=0)return c.op;return null})(n.filters,(function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new O(P.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new O(P.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var dl=class{convertValue(e,t="none"){switch(Qt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ne(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Et(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw M(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return Zt(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertVectorValue(e){var t,r,i;let s=(i=(r=(t=e.fields)===null||t===void 0?void 0:t[Zn].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(a=>ne(a.doubleValue));return new Kt(s)}convertGeoPoint(e){return new Gt(ne(e.latitude),ne(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=mo(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(li(e));default:return null}}convertTimestamp(e){let t=wt(e);return new K(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=re.fromString(e);J(Pm(r),9688,{name:e});let i=new Fs(r.get(1),r.get(3)),s=new L(r.popFirst(5));return i.isEqual(t)||It(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function cg(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}var _n=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},yn=class n extends lo{constructor(e,t,r,i,s,a){super(e,t,r,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new Yn(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(Ao("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new O(P.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=n._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}};yn._jsonSchemaVersion="firestore/documentSnapshot/1.0",yn._jsonSchema={type:de("string",yn._jsonSchemaVersion),bundleSource:de("string","DocumentSnapshot"),bundleName:de("string"),bundle:de("string")};var Yn=class extends yn{data(e={}){return super.data(e)}},vn=class n{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new _n(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Yn(this._firestore,this._userDataWriter,r.key,r,new _n(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new O(P.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(i,s){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(c=>{let l=new Yn(i._firestore,i._userDataWriter,c.doc.key,c.doc,new _n(i._snapshot.mutatedKeys.has(c.doc.key),i._snapshot.fromCache),i.query.converter);return c.doc,{type:"added",doc:l,oldIndex:-1,newIndex:a++}})}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(c=>s||c.type!==3).map(c=>{let l=new Yn(i._firestore,i._userDataWriter,c.doc.key,c.doc,new _n(i._snapshot.mutatedKeys.has(c.doc.key),i._snapshot.fromCache),i.query.converter),d=-1,p=-1;return c.type!==0&&(d=a.indexOf(c.doc.key),a=a.delete(c.doc.key)),c.type!==1&&(a=a.add(c.doc),p=a.indexOf(c.doc.key)),{type:DT(c.type),doc:l,oldIndex:d,newIndex:p}})}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new O(P.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=n._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=ai.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],r=[],i=[];return this.docs.forEach(s=>{s._document!==null&&(t.push(s._document),r.push(this._userDataWriter.convertObjectMap(s._document.data.value.mapValue.fields,"previous")),i.push(s.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}};function DT(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return M(61501,{type:n})}}function ug(n){n=De(n,pe);let e=De(n.firestore,Je);return TT(Eo(e),n._key).then(t=>mg(e,n,t))}vn._jsonSchemaVersion="firestore/querySnapshot/1.0",vn._jsonSchema={type:de("string",vn._jsonSchemaVersion),bundleSource:de("string","QuerySnapshot"),bundleName:de("string"),bundle:de("string")};var Ei=class extends dl{constructor(e){super(),this.firestore=e}convertBytes(e){return new Wt(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new pe(this.firestore,null,t)}};function lg(n){n=De(n,bt);let e=De(n.firestore,Je),t=Eo(e),r=new Ei(e);return ng(n._query),AT(t,n._query).then(i=>new vn(e,r,n,i))}function hg(n,e,t){n=De(n,pe);let r=De(n.firestore,Je),i=cg(n.converter,e,t);return So(r,[Xm(To(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,st.none())])}function dg(n,e,t,...r){n=De(n,pe);let i=De(n.firestore,Je),s=To(i),a;return a=typeof(e=ce(e))=="string"||e instanceof ur?PT(s,"updateDoc",n._key,e,t,r):RT(s,"updateDoc",n._key,e),So(i,[a.toMutation(n._key,st.exists(!0))])}function fg(n){return So(De(n.firestore,Je),[new di(n._key,st.none())])}function pg(n,e){let t=De(n.firestore,Je),r=Vl(n),i=cg(n.converter,e);return So(t,[Xm(To(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,st.exists(!1))]).then(()=>r)}function bo(n,...e){var t,r,i;n=ce(n);let s={includeMetadataChanges:!1,source:"default"},a=0;typeof e[a]!="object"||Rp(e[a])||(s=e[a++]);let c={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Rp(e[a])){let _=e[a];e[a]=(t=_.next)===null||t===void 0?void 0:t.bind(_),e[a+1]=(r=_.error)===null||r===void 0?void 0:r.bind(_),e[a+2]=(i=_.complete)===null||i===void 0?void 0:i.bind(_)}let l,d,p;if(n instanceof pe)d=De(n.firestore,Je),p=go(n._key.path),l={next:_=>{e[a]&&e[a](mg(d,n,_))},error:e[a+1],complete:e[a+2]};else{let _=De(n,bt);d=De(_.firestore,Je),p=_._query;let I=new Ei(d);l={next:R=>{e[a]&&e[a](new vn(d,I,_,R))},error:e[a+1],complete:e[a+2]},ng(n._query)}return(function(I,R,k,x){let D=new yi(x),$=new _i(R,D,k);return I.asyncQueue.enqueueAndForget(()=>m(null,null,function*(){return kl(yield io(I),$)})),()=>{D.Ou(),I.asyncQueue.enqueueAndForget(()=>m(null,null,function*(){return Dl(yield io(I),$)}))}})(Eo(d),p,c,l)}function So(n,e){return(function(r,i){let s=new Ke;return r.asyncQueue.enqueueAndForget(()=>m(null,null,function*(){return dT(yield ET(r),i,s)})),s.promise})(Eo(n),e)}function mg(n,e,t){let r=t.docs.get(e._key),i=new Ei(n);return new yn(n,i,e._key,r,new _n(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){(function(i){lr=i})(Vt),We(new Pe("firestore",(r,{instanceIdentifier:i,options:s})=>{let a=r.getProvider("app").getImmediate(),c=new Je(new Nc(r.getProvider("auth-internal")),new Vc(a,r.getProvider("app-check-internal")),(function(d,p){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new O(P.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Fs(d.options.projectId,p)})(a,i),a);return s=Object.assign({useFetchStreams:t},s),c._setSettings(s),c},"PUBLIC").setMultipleInstances(!0)),se(Mf,Ff,e),se(Mf,Ff,"esm2017")})();var Ro=function(){return Ro=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},Ro.apply(this,arguments)};var xT={includeMetadataChanges:!1};function gg(n,e){return e===void 0&&(e=xT),new Me(function(t){var r=bo(n,e,{next:t.next.bind(t),error:t.error.bind(t),complete:t.complete.bind(t)});return{unsubscribe:r}})}function _g(n,e){var t;e===void 0&&(e={});var r=n.data(e);return!n.exists()||typeof r!="object"||r===null||!e.idField?r:Ro(Ro({},r),(t={},t[e.idField]=n.id,t))}function yg(n){return gg(n,{includeMetadataChanges:!0}).pipe(xr(function(e){return e.docs}))}function vg(n,e){return e===void 0&&(e={}),yg(n).pipe(xr(function(t){return t.map(function(r){return _g(r,e)})}))}var Pn=class{constructor(e){return e}},Ig="firestore",Fl=class{constructor(){return Bn(Ig)}};var Ul=new Vn("angularfire2.firestore-instances");function VT(n,e){let t=Br(Ig,n,e);return t&&new Pn(t)}function LT(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new Pn(r)}}var MT={provide:Fl,deps:[[new Ue,Ul]]},FT={provide:Pn,useFactory:VT,deps:[[new Ue,Ul],pt]};function ZS(n,...e){return se("angularfire",Lt.full,"fst"),Ln([FT,MT,{provide:Ul,useFactory:LT(n),multi:!0,deps:[Ye,Nt,Mt,un,[new Ue,ei],[new Ue,$n],...e]}])}var Ri=te(vg,!0);var Cn=te(pg,!0,2);var ae=te(Qm,!0,2);var Po=te(fg,!0,2);var Ce=te(Vl,!0,2);var ut=te(ug,!0);var St=te(lg,!0);var eR=te(Jm,!0);var pr=te(og,!0,2);var ql=te(bo,!0);var kn=te(sg,!0,2),Ne=te(rg,!0,2);var Bl=te(hg,!0,2);var Pi=te(dg,!0,2);var fe=te(ig,!0,2);var wg=class n{firestore=Fe(Pn);auth=Fe(pn);createTournament(){return m(this,null,function*(){let e=this.auth.currentUser;if(!e)throw new Error("Not authenticated");let t=Ce(this.firestore,"users",e.uid),r=yield ut(t),i=r.exists()?r.data().nickname:e.email||"",s=ae(this.firestore,"tournaments"),a={player1Id:e.uid,player1Email:e.email||"",player1Nickname:i,status:"waiting",currentRound:1,player1Score:0,player2Score:0,rounds:this.initializeRounds(),createdAt:K.now(),updatedAt:K.now(),gameMode:"tournament"};return(yield Cn(s,a)).id})}createComputerTournament(){return m(this,null,function*(){let e=this.auth.currentUser;if(!e)throw new Error("Not authenticated");let t=Ce(this.firestore,"users",e.uid),r=yield ut(t),i=r.exists()?r.data().nickname:e.email,s=ae(this.firestore,"tournaments"),a={player1Id:e.uid,player1Email:e.email||"",player1Nickname:i,player2Id:"COMPUTER",player2Email:"\u{1F916} Computer",player2Nickname:"\u{1F916} Computer",isVsComputer:!0,status:"in-progress",currentRound:1,player1Score:0,player2Score:0,rounds:this.initializeRounds(),createdAt:K.now(),updatedAt:K.now(),gameMode:"tournament"};return(yield Cn(s,a)).id})}createCasualComputerGame(){return m(this,null,function*(){let e=this.auth.currentUser;if(!e)throw new Error("Not authenticated");let t=Ce(this.firestore,"users",e.uid),r=yield ut(t),i=r.exists()?r.data().nickname:e.email,s=ae(this.firestore,"tournaments"),a={player1Id:e.uid,player1Email:e.email||"",player1Nickname:i,player2Id:"COMPUTER",player2Email:"\u{1F916} Computer",player2Nickname:"\u{1F916} Computer",isVsComputer:!0,gameMode:"casual",status:"in-progress",currentRound:1,player1Score:0,player2Score:0,rounds:[{roundNumber:1,player1Choice:null,player2Choice:null,winner:null,completed:!1}],createdAt:K.now(),updatedAt:K.now()};return(yield Cn(s,a)).id})}createCasualGame(){return m(this,null,function*(){let e=this.auth.currentUser;if(!e)throw new Error("Not authenticated");let t=Ce(this.firestore,"users",e.uid),r=yield ut(t),i=r.exists()?r.data().nickname:e.email,s=ae(this.firestore,"tournaments"),a={player1Id:e.uid,player1Email:e.email||"",player1Nickname:i,player2Id:null,player2Email:null,player2Nickname:null,isVsComputer:!1,gameMode:"casual",status:"waiting",currentRound:1,player1Score:0,player2Score:0,rounds:[{roundNumber:1,player1Choice:null,player2Choice:null,winner:null,completed:!1}],createdAt:K.now(),updatedAt:K.now()};return(yield Cn(s,a)).id})}getInProgressCasualGames(e){let t=Ne(ae(this.firestore,"tournaments"),fe("gameMode","==","casual"),fe("status","==","in-progress"),kn("updatedAt","desc"));return Ri(t,{idField:"id"}).pipe(xr(r=>r.filter(i=>i.player1Id===e||i.player2Id===e)))}hasActiveGameWith(e){return m(this,null,function*(){let t=this.auth.currentUser;if(!t)return null;let r=Ne(ae(this.firestore,"tournaments"),fe("status","in",["waiting","in-progress"]),kn("updatedAt","desc")),s=(yield St(r)).docs.map(a=>je({id:a.id},a.data())).filter(a=>a.player1Id===t.uid&&a.player2Id===e||a.player2Id===t.uid&&a.player1Id===e);return s.length>0?s[0].id:null})}joinTournament(e){return m(this,null,function*(){let t=this.auth.currentUser;if(!t)throw new Error("Not authenticated");let r=Ce(this.firestore,"tournaments",e),i=yield ut(r);if(!i.exists())throw new Error("Tournament not found");let s=i.data(),a=yield this.hasActiveGameWith(s.player1Id);if(a&&a!==e)throw new Error("You already have an active game with this player");let c=Ce(this.firestore,"users",t.uid),l=yield ut(c),d=l.exists()?l.data().nickname:t.email||"";yield Pi(r,{player2Id:t.uid,player2Email:t.email||"",player2Nickname:d,status:"in-progress",updatedAt:K.now()})})}searchUsers(e){return m(this,null,function*(){let t=ae(this.firestore,"users"),r=Ne(t,fe("nickname",">=",e),fe("nickname","<=",e+"\uF8FF"),pr(10));return(yield St(r)).docs.map(s=>({uid:s.id,nickname:s.data().nickname}))})}makeChoice(e,t){return m(this,null,function*(){let r=Ce(this.firestore,"tournaments",e),i=yield ut(r);if(!i.exists())throw new Error("Tournament not found");let s=i.data(),a=this.auth.currentUser;if(!a)throw new Error("Not authenticated");let c=a.uid===s.player1Id,l=s.rounds[s.currentRound-1];if(c&&l.player1Choice){console.log("Player 1 already made choice");return}if(!c&&l.player2Choice){console.log("Player 2 already made choice");return}if(c?l.player1Choice=t:l.player2Choice=t,s.isVsComputer&&c&&!l.player2Choice){let d=["rock","paper","scissors"];l.player2Choice=d[Math.floor(Math.random()*d.length)]}if(l.player1Choice&&l.player2Choice){let d=this.determineWinner(l.player1Choice,l.player2Choice);l.winner=d==="player1"?s.player1Id:d==="player2"?s.player2Id||"COMPUTER":null,l.completed=!0,d==="player1"&&s.player1Score++,d==="player2"&&s.player2Score++,s.gameMode==="casual"?(s.currentRound++,s.rounds.push({roundNumber:s.currentRound,player1Choice:null,player2Choice:null,winner:null,completed:!1})):s.currentRound<5?s.currentRound++:(s.status="completed",yield this.updatePlayerStats(s))}s.updatedAt=K.now(),yield Pi(r,s)})}determineWinner(e,t){return e===t?null:e==="rock"&&t==="scissors"||e==="paper"&&t==="rock"||e==="scissors"&&t==="paper"?"player1":"player2"}updatePlayerStats(e){return m(this,null,function*(){return Promise.resolve()})}getComputerChoice(){return["rock","paper","scissors"][Math.floor(Math.random()*3)]}determineRoundWinner(e,t,r,i){return e===t?null:e==="rock"&&t==="scissors"||e==="paper"&&t==="rock"||e==="scissors"&&t==="paper"?r:i}initializeRounds(){return Array.from({length:5},(e,t)=>({roundNumber:t+1,player1Choice:null,player2Choice:null,winner:null,completed:!1}))}getTournament(e){return new Me(t=>{let r=Ce(this.firestore,"tournaments",e),i=ql(r,s=>{s.exists()?t.next(je({id:s.id},s.data())):t.next(null)},s=>{t.error(s)});return()=>i()})}getAvailableTournaments(){return new Me(e=>{let t=ae(this.firestore,"tournaments"),r=Ne(t,fe("status","==","waiting"),pr(20)),i=ql(r,s=>{let a=s.docs.map(c=>je({id:c.id},c.data()));e.next(a)},s=>{e.error(s)});return()=>i()})}deleteTournament(e){return m(this,null,function*(){let t=Ce(this.firestore,"tournaments",e);yield Po(t)})}getUserGameHistory(e){return m(this,null,function*(){let t=ae(this.firestore,"tournaments"),r=Ne(t,fe("status","==","completed"),pr(50));return(yield St(r)).docs.map(a=>je({id:a.id},a.data())).filter(a=>a.player1Id===e||a.player2Id===e).sort((a,c)=>c.updatedAt?.toMillis()-a.updatedAt?.toMillis())})}getUserStats(e,t){let r=0,i=0,s=0,a=0,c=0;return t.forEach(l=>{let d=l.player1Id===e,p=d?l.player1Score:l.player2Score,_=d?l.player2Score:l.player1Score;p>_?r++:p<_?i++:s++,a+=p,c+=_}),{totalGames:t.length,wins:r,losses:i,draws:s,winRate:t.length>0?(r/t.length*100).toFixed(1):"0.0",totalRoundsWon:a,totalRoundsLost:c}}getLeaderboardData(e){return m(this,null,function*(){let t=ae(this.firestore,"tournaments"),r=new Date;switch(e){case"day":r.setDate(r.getDate()-1);break;case"week":r.setDate(r.getDate()-7);break;case"month":r.setMonth(r.getMonth()-1);break;case"year":r.setFullYear(r.getFullYear()-1);break;case"all":r=new Date(0);break}let i=Ne(t,fe("status","==","completed"),pr(500)),c=(yield St(i)).docs.map(d=>je({id:d.id},d.data())).filter(d=>d.updatedAt&&d.updatedAt.toDate()>=r),l=new Map;return c.forEach(d=>{if(d.player1Id&&!d.isVsComputer){let p=l.get(d.player1Id)||{userId:d.player1Id,email:d.player1Email,wins:0,losses:0,draws:0,totalGames:0,roundsWon:0,roundsLost:0,winRate:0};p.totalGames++,p.roundsWon+=d.player1Score,p.roundsLost+=d.player2Score,d.player1Score>d.player2Score?p.wins++:d.player1Score<d.player2Score?p.losses++:p.draws++,p.winRate=p.wins/p.totalGames*100,l.set(d.player1Id,p)}if(d.player2Id&&d.player2Id!=="COMPUTER"){let p=l.get(d.player2Id)||{userId:d.player2Id,email:d.player2Email||"Unknown",wins:0,losses:0,draws:0,totalGames:0,roundsWon:0,roundsLost:0,winRate:0};p.totalGames++,p.roundsWon+=d.player2Score,p.roundsLost+=d.player1Score,d.player2Score>d.player1Score?p.wins++:d.player2Score<d.player1Score?p.losses++:p.draws++,p.winRate=p.wins/p.totalGames*100,l.set(d.player2Id,p)}}),Array.from(l.values()).sort((d,p)=>p.wins!==d.wins?p.wins-d.wins:p.winRate-d.winRate).slice(0,10)})}addFriend(e,t,r){return m(this,null,function*(){if(yield this.getFriend(e,t))throw new Error("Already friends");let s=ae(this.firestore,"friends");yield Cn(s,{userId:e,friendId:t,friendEmail:"",friendNickname:r,addedAt:K.now()})})}removeFriend(e){return m(this,null,function*(){let t=this.auth.currentUser;if(!t)throw new Error("Not authenticated");let r=ae(this.firestore,"friends"),i=Ne(r,fe("userId","==",t.uid),fe("friendId","==",e));(yield St(i)).forEach(a=>m(this,null,function*(){yield Po(a.ref)}))})}getFriends(e){return m(this,null,function*(){let t=ae(this.firestore,"friends"),r=Ne(t,fe("userId","==",e),kn("addedAt","desc"));return(yield St(r)).docs.map(s=>je({id:s.id},s.data()))})}getFriend(e,t){return m(this,null,function*(){let r=ae(this.firestore,"friends"),i=Ne(r,fe("userId","==",e),fe("friendId","==",t)),s=yield St(i);return s.empty?null:je({id:s.docs[0].id},s.docs[0].data())})}isFriend(e){return m(this,null,function*(){let t=this.auth.currentUser;return t?(yield this.getFriend(t.uid,e))!==null:!1})}sendGameRequest(e,t,r){return m(this,null,function*(){let i=this.auth.currentUser?.uid;if(!i)throw new Error("Not authenticated");let s=this.auth.currentUser?.email||"",a=yield this.getUserNickname(i),c=Ce(ae(this.firestore,"gameRequests"));yield Bl(c,{id:c.id,fromUserId:i,fromEmail:s,fromNickname:a||s,toUserId:e,status:"pending",createdAt:K.now()})})}getGameRequests(e){let t=Ne(ae(this.firestore,"gameRequests"),fe("toUserId","==",e),fe("status","==","pending"),kn("createdAt","desc"));return Ri(t,{idField:"id"})}getSentGameRequests(e){let t=Ne(ae(this.firestore,"gameRequests"),fe("fromUserId","==",e),fe("status","in",["pending","accepted"]),kn("createdAt","desc"));return Ri(t,{idField:"id"})}acceptGameRequest(e){return m(this,null,function*(){let t=Ce(this.firestore,"gameRequests",e),r=yield ut(t);if(!r.exists())throw new Error("Request not found");let i=r.data(),s=yield this.createTournamentForRequest(i.fromUserId,i.fromEmail,i.fromNickname,i.toUserId);return yield Pi(t,{status:"accepted",tournamentId:s}),s})}declineGameRequest(e){return m(this,null,function*(){let t=Ce(this.firestore,"gameRequests",e);yield Pi(t,{status:"declined"})})}createTournamentForRequest(e,t,r,i){return m(this,null,function*(){let s=this.auth.currentUser?.email||"",a=yield this.getUserNickname(i),c=Ce(ae(this.firestore,"tournaments")),l={id:c.id,player1Id:e,player1Email:t,player1Nickname:r||t,player2Id:i,player2Email:s,player2Nickname:a||s,player1Score:0,player2Score:0,currentRound:1,status:"in-progress",rounds:this.initializeRounds(),createdAt:K.now(),updatedAt:K.now(),isVsComputer:!1,gameMode:"tournament"};return yield Bl(c,l),c.id})}getUserNickname(e){return m(this,null,function*(){let t=Ce(this.firestore,"users",e),r=yield ut(t);return r.exists()&&r.data().nickname||""})}getChatMessages(e){let t=Ne(ae(this.firestore,"chatMessages"),fe("tournamentId","==",e),kn("timestamp","asc"),pr(50));return Ri(t,{idField:"id"})}sendChatMessage(e,t){return m(this,null,function*(){let r=this.auth.currentUser;if(!r)throw new Error("Not authenticated");let i=yield this.getUserNickname(r.uid),s=ae(this.firestore,"chatMessages");yield Cn(s,{tournamentId:e,userId:r.uid,userNickname:i||r.email||"Player",message:t.trim(),timestamp:K.now()})})}clearChatMessages(e){return m(this,null,function*(){let t=Ne(ae(this.firestore,"chatMessages"),fe("tournamentId","==",e)),i=(yield St(t)).docs.map(s=>Po(s.ref));yield Promise.all(i)})}static \u0275fac=function(t){return new(t||n)};static \u0275prov=Gi({token:n,factory:n.\u0275fac,providedIn:"root"})};export{UA as a,qA as b,pn as c,h0 as d,d0 as e,f0 as f,p0 as g,m0 as h,g0 as i,Pn as j,ZS as k,Ce as l,ut as m,eR as n,Bl as o,Pi as p,wg as q};
