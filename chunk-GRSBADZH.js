import{a as R,b as E,e as T,i as V}from"./chunk-QGRNVEZS.js";import{c as q,q as D}from"./chunk-VIM6QOD5.js";import{A as m,Fa as S,Ja as F,L as s,Q as y,X as g,Y as _,Z as b,_ as v,aa as i,ba as r,ca as k,d as p,ga as x,ia as f,ka as l,ma as o,na as h,oa as M,ra as w,sa as O,ta as P,v as C,z as u}from"./chunk-XDPIZZKM.js";var $=(n,t)=>t.uid,U=(n,t)=>t.id;function G(n,t){n&1&&(i(0,"div",3),k(1,"div",5),i(2,"p"),o(3,"Loading friends..."),r()())}function z(n,t){n&1&&(i(0,"div",10),o(1,"Searching..."),r())}function N(n,t){if(n&1){let e=x();i(0,"div",18)(1,"span",19),o(2),r(),i(3,"button",20),f("click",function(){let d=u(e).$implicit,c=l(3);return m(c.addFriend(d))}),o(4,"+ Add Friend"),r()()}if(n&2){let e=t.$implicit;s(2),h(e.nickname)}}function j(n,t){if(n&1&&(i(0,"div",11),b(1,N,5,1,"div",18,$),r()),n&2){let e=l(2);s(),v(e.searchResults)}}function A(n,t){n&1&&(i(0,"div",12),o(1,"No users found"),r())}function Q(n,t){if(n&1){let e=x();i(0,"div",23)(1,"div",24)(2,"span",25),o(3,"\u2694\uFE0F"),r(),i(4,"div",26)(5,"span",27),o(6),r(),i(7,"span",28),o(8,"wants to play!"),r()()(),i(9,"div",29)(10,"button",30),f("click",function(){let d=u(e).$implicit,c=l(3);return m(c.acceptRequest(d))}),o(11," Accept "),r(),i(12,"button",31),f("click",function(){let d=u(e).$implicit,c=l(3);return m(c.declineRequest(d))}),o(13," Decline "),r()()()}if(n&2){let e=t.$implicit;s(6),h(e.fromNickname)}}function L(n,t){if(n&1&&(i(0,"div",13)(1,"div",21)(2,"h2"),o(3),r()(),i(4,"div",22),b(5,Q,14,1,"div",23,U),r()()),n&2){let e=l(2);s(3),M("\u{1F3AE} Game Requests (",e.gameRequests.length,")"),s(2),v(e.gameRequests)}}function W(n,t){n&1&&(i(0,"div",16)(1,"p"),o(2,"You haven't added any friends yet"),r(),i(3,"p",32),o(4,"Search for users above to add friends!"),r()())}function B(n,t){if(n&1){let e=x();i(0,"div",33)(1,"div",34)(2,"span",35),o(3,"\u{1F464}"),r(),i(4,"div",36)(5,"span",37),o(6),r(),i(7,"span",38),o(8),r()()(),i(9,"div",39)(10,"button",40),f("click",function(){let d=u(e).$implicit,c=l(3);return m(c.challengeFriend(d))}),o(11," Challenge "),r(),i(12,"button",41),f("click",function(){let d=u(e).$implicit,c=l(3);return m(c.confirmRemoveFriend(d))}),o(13," Remove "),r()()()}if(n&2){let e=t.$implicit,a=l(3);s(6),h(e.friendNickname),s(2),M("Added ",a.formatDate(e.addedAt))}}function Y(n,t){if(n&1&&(i(0,"div",17),b(1,B,14,2,"div",33,U),r()),n&2){let e=l(2);s(),v(e.friends)}}function H(n,t){if(n&1){let e=x();i(0,"div",6)(1,"div",7)(2,"h2"),o(3,"\u{1F50D} Search Users"),r()(),i(4,"div",8)(5,"input",9),P("ngModelChange",function(d){u(e);let c=l();return O(c.searchQuery,d)||(c.searchQuery=d),m(d)}),f("input",function(){u(e);let d=l();return m(d.searchUsers())}),r(),g(6,z,2,0,"div",10),g(7,j,3,0,"div",11),g(8,A,2,0,"div",12),r()(),g(9,L,7,1,"div",13),i(10,"div",14)(11,"div",15)(12,"h2"),o(13),r()(),g(14,W,5,0,"div",16)(15,Y,3,0,"div",17),r()}if(n&2){let e=l();s(5),w("ngModel",e.searchQuery),s(),_(e.isSearching?6:-1),s(),_(e.searchResults.length>0?7:-1),s(),_(!e.isSearching&&e.searchResults.length===0&&e.searchQuery?8:-1),s(),_(e.gameRequests.length>0?9:-1),s(4),M("Your Friends (",e.friends.length,")"),s(),_(e.friends.length===0?14:15)}}function J(n,t){if(n&1){let e=x();i(0,"div",42),f("click",function(){u(e);let d=l();return m(d.cancelRemove())}),i(1,"div",43),f("click",function(d){return u(e),m(d.stopPropagation())}),i(2,"h3"),o(3,"Remove Friend?"),r(),i(4,"p"),o(5,"Are you sure you want to remove "),i(6,"strong"),o(7),r(),o(8," from your friends list?"),r(),i(9,"div",44)(10,"button",45),f("click",function(){u(e);let d=l();return m(d.cancelRemove())}),o(11,"Cancel"),r(),i(12,"button",46),f("click",function(){u(e);let d=l();return m(d.removeFriend())}),o(13,"Remove"),r()()()()}if(n&2){let e=l();s(7),h(e.friendToRemove==null?null:e.friendToRemove.friendNickname)}}var I=class n{router=C(F);auth=C(q);tournamentService=C(D);loading=!0;friends=[];gameRequests=[];searchQuery="";searchResults=[];isSearching=!1;showConfirmModal=!1;friendToRemove=null;requestsSubscription;sentRequestsSubscription;ngOnInit(){return p(this,null,function*(){yield this.loadFriends(),this.loadGameRequests(),this.watchSentRequests()})}ngOnDestroy(){this.requestsSubscription?.unsubscribe(),this.sentRequestsSubscription?.unsubscribe()}loadFriends(){return p(this,null,function*(){let t=this.auth.currentUser?.uid;if(t)try{this.friends=yield this.tournamentService.getFriends(t)}catch(e){console.error("Error loading friends:",e)}finally{this.loading=!1}})}searchUsers(){return p(this,null,function*(){if(!this.searchQuery.trim()){this.searchResults=[];return}this.isSearching=!0;try{let t=yield this.tournamentService.searchUsers(this.searchQuery),e=this.auth.currentUser;this.searchResults=t.filter(a=>a.uid!==e?.uid&&!this.friends.some(d=>d.friendId===a.uid))}catch(t){console.error("Error searching users:",t)}finally{this.isSearching=!1}})}addFriend(t){return p(this,null,function*(){let e=this.auth.currentUser;if(e)try{yield this.tournamentService.addFriend(e.uid,t.uid,t.nickname),this.searchResults=this.searchResults.filter(a=>a.uid!==t.uid),this.searchQuery="",yield this.loadFriends()}catch(a){console.error("Error adding friend:",a),alert("Failed to add friend")}})}loadGameRequests(){let t=this.auth.currentUser?.uid;t&&(this.requestsSubscription=this.tournamentService.getGameRequests(t).subscribe(e=>{this.gameRequests=e}))}watchSentRequests(){let t=this.auth.currentUser?.uid;t&&(this.sentRequestsSubscription=this.tournamentService.getSentGameRequests(t).subscribe(e=>{e.forEach(a=>{a.status==="accepted"&&a.tournamentId&&this.router.navigate(["/game",a.tournamentId])})}))}challengeFriend(t){return p(this,null,function*(){try{yield this.tournamentService.sendGameRequest(t.friendId,t.friendEmail,t.friendNickname),alert(`Challenge sent to ${t.friendNickname}!`)}catch(e){console.error("Error sending challenge:",e),alert("Failed to send challenge")}})}acceptRequest(t){return p(this,null,function*(){try{let e=yield this.tournamentService.acceptGameRequest(t.id);this.router.navigate(["/game",e])}catch(e){console.error("Error accepting request:",e),alert("Failed to accept request")}})}declineRequest(t){return p(this,null,function*(){try{yield this.tournamentService.declineGameRequest(t.id)}catch(e){console.error("Error declining request:",e),alert("Failed to decline request")}})}confirmRemoveFriend(t){this.friendToRemove=t,this.showConfirmModal=!0}cancelRemove(){this.showConfirmModal=!1,this.friendToRemove=null}removeFriend(){return p(this,null,function*(){if(this.friendToRemove)try{yield this.tournamentService.removeFriend(this.friendToRemove.friendId),this.showConfirmModal=!1,this.friendToRemove=null,yield this.loadFriends()}catch(t){console.error("Error removing friend:",t),alert("Failed to remove friend")}})}formatDate(t){if(!t)return"";let e=t.toDate(),d=Math.abs(new Date().getTime()-e.getTime()),c=Math.ceil(d/(1e3*60*60*24));return c===0?"today":c===1?"yesterday":c<7?`${c} days ago`:c<30?`${Math.floor(c/7)} weeks ago`:c<365?`${Math.floor(c/30)} months ago`:`${Math.floor(c/365)} years ago`}goToLobby(){this.router.navigate(["/lobby"])}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=y({type:n,selectors:[["app-friends"]],decls:10,vars:2,consts:[[1,"friends-container"],[1,"btn-back",3,"click"],[1,"friends-content"],[1,"loading"],[1,"modal-overlay"],[1,"spinner"],[1,"search-card"],[1,"search-header"],[1,"search-content"],["type","text","placeholder","Search by nickname...",1,"search-input",3,"ngModelChange","input","ngModel"],[1,"searching"],[1,"search-results"],[1,"no-results"],[1,"requests-card"],[1,"friends-card"],[1,"friends-header"],[1,"empty-state"],[1,"friends-list"],[1,"search-result-item"],[1,"user-nickname"],[1,"btn-add",3,"click"],[1,"requests-header"],[1,"requests-list"],[1,"request-item"],[1,"request-info"],[1,"request-icon"],[1,"request-details"],[1,"request-name"],[1,"request-text"],[1,"request-actions"],[1,"btn-accept",3,"click"],[1,"btn-decline",3,"click"],[1,"sub-text"],[1,"friend-item"],[1,"friend-info"],[1,"friend-icon"],[1,"friend-details"],[1,"friend-name"],[1,"friend-date"],[1,"friend-actions"],[1,"btn-challenge",3,"click"],[1,"btn-remove",3,"click"],[1,"modal-overlay",3,"click"],[1,"modal-content",3,"click"],[1,"modal-actions"],[1,"btn-cancel-modal",3,"click"],[1,"btn-confirm-remove",3,"click"]],template:function(e,a){e&1&&(i(0,"div",0)(1,"header")(2,"h1"),o(3,"\u{1F465} Friends"),r(),i(4,"button",1),f("click",function(){return a.goToLobby()}),o(5,"Back to Lobby"),r()(),i(6,"div",2),g(7,G,4,0,"div",3)(8,H,16,7),r(),g(9,J,14,1,"div",4),r()),e&2&&(s(7),_(a.loading?7:8),s(2),_(a.showConfirmModal?9:-1))},dependencies:[S,V,R,E,T],styles:[".friends-container[_ngcontent-%COMP%]{min-height:100vh;background:linear-gradient(135deg,#667eea,#764ba2);padding:20px}header[_ngcontent-%COMP%]{max-width:800px;margin:0 auto 30px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:20px}h1[_ngcontent-%COMP%]{color:#fff;margin:0}.btn-back[_ngcontent-%COMP%]{padding:10px 20px;background:#fff3;color:#fff;border:2px solid white;border-radius:5px;cursor:pointer;font-weight:600}.btn-back[_ngcontent-%COMP%]:hover{background:#ffffff4d}.friends-content[_ngcontent-%COMP%]{max-width:800px;margin:0 auto}.loading[_ngcontent-%COMP%]{background:#fff;padding:60px;border-radius:10px;text-align:center}.spinner[_ngcontent-%COMP%]{width:50px;height:50px;border:5px solid #f3f3f3;border-top:5px solid #667eea;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin:0 auto 20px}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.loading[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#666;font-size:16px}.search-card[_ngcontent-%COMP%]{background:#fff;border-radius:10px;box-shadow:0 10px 40px #0003;margin-bottom:30px;overflow:hidden}.search-header[_ngcontent-%COMP%]{padding:20px 30px;background:linear-gradient(135deg,#e3f2fd,#bbdefb);border-bottom:2px solid #2196f3}.search-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;color:#333}.search-content[_ngcontent-%COMP%]{padding:20px 30px}.search-input[_ngcontent-%COMP%]{width:100%;padding:12px 15px;border:2px solid #e0e0e0;border-radius:5px;font-size:16px;outline:none;transition:border-color .3s}.search-input[_ngcontent-%COMP%]:focus{border-color:#2196f3}.searching[_ngcontent-%COMP%], .no-results[_ngcontent-%COMP%]{text-align:center;padding:20px;color:#999}.search-results[_ngcontent-%COMP%]{margin-top:15px;display:flex;flex-direction:column;gap:10px}.search-result-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:12px 15px;background:#f5f5f5;border-radius:5px}.user-nickname[_ngcontent-%COMP%]{font-size:16px;font-weight:600;color:#333}.btn-add[_ngcontent-%COMP%]{padding:8px 15px;background:#4caf50;color:#fff;border:none;border-radius:5px;cursor:pointer;font-weight:600;transition:background .3s}.btn-add[_ngcontent-%COMP%]:hover{background:#45a049}.requests-card[_ngcontent-%COMP%]{background:#fff;border-radius:10px;box-shadow:0 10px 40px #0003;margin-bottom:30px;overflow:hidden;border:3px solid #ffd700}.requests-header[_ngcontent-%COMP%]{padding:20px 30px;background:linear-gradient(135deg,#fff9e6,#ffe6b3);border-bottom:2px solid #ffd700}.requests-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;color:#333}.requests-list[_ngcontent-%COMP%]{display:flex;flex-direction:column}.request-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:20px 30px;border-bottom:1px solid #f0f0f0;background:#fffbf0}.request-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.request-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:15px}.request-icon[_ngcontent-%COMP%]{font-size:32px;width:50px;height:50px;display:flex;align-items:center;justify-content:center;background:#fff3cd;border-radius:50%}.request-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:5px}.request-name[_ngcontent-%COMP%]{font-size:16px;font-weight:600;color:#333}.request-text[_ngcontent-%COMP%]{font-size:14px;color:#666}.request-actions[_ngcontent-%COMP%]{display:flex;gap:10px}.btn-accept[_ngcontent-%COMP%], .btn-decline[_ngcontent-%COMP%]{padding:10px 20px;border:none;border-radius:5px;cursor:pointer;font-weight:600;transition:background .3s}.btn-accept[_ngcontent-%COMP%]{background:#4caf50;color:#fff}.btn-accept[_ngcontent-%COMP%]:hover{background:#45a049}.btn-decline[_ngcontent-%COMP%]{background:#f44336;color:#fff}.btn-decline[_ngcontent-%COMP%]:hover{background:#da190b}.friends-card[_ngcontent-%COMP%]{background:#fff;border-radius:10px;box-shadow:0 10px 40px #0003;overflow:hidden}.friends-header[_ngcontent-%COMP%]{padding:25px 30px;border-bottom:2px solid #f0f0f0}.friends-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;color:#333}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:80px 20px;color:#999}.empty-state[_ngcontent-%COMP%]   .sub-text[_ngcontent-%COMP%]{font-size:14px;margin-top:10px}.friends-list[_ngcontent-%COMP%]{display:flex;flex-direction:column}.friend-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:20px 30px;border-bottom:1px solid #f0f0f0;transition:background .3s}.friend-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.friend-item[_ngcontent-%COMP%]:hover{background:#f9f9f9}.friend-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:15px}.friend-icon[_ngcontent-%COMP%]{font-size:32px;width:50px;height:50px;display:flex;align-items:center;justify-content:center;background:#e3f2fd;border-radius:50%}.friend-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:5px}.friend-name[_ngcontent-%COMP%]{font-size:16px;font-weight:600;color:#333}.friend-date[_ngcontent-%COMP%]{font-size:13px;color:#999}.friend-actions[_ngcontent-%COMP%]{display:flex;gap:10px}.btn-challenge[_ngcontent-%COMP%]{padding:8px 20px;background:#667eea;color:#fff;border:none;border-radius:5px;cursor:pointer;font-weight:600;transition:background .3s}.btn-challenge[_ngcontent-%COMP%]:hover{background:#5568d3}.btn-remove[_ngcontent-%COMP%]{padding:8px 20px;background:#f44336;color:#fff;border:none;border-radius:5px;cursor:pointer;font-weight:600;transition:background .3s}.btn-remove[_ngcontent-%COMP%]:hover{background:#da190b}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000000b3;display:flex;align-items:center;justify-content:center;z-index:1000;padding:20px}.modal-content[_ngcontent-%COMP%]{background:#fff;padding:30px;border-radius:10px;max-width:400px;width:100%;box-shadow:0 10px 40px #0000004d}.modal-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 15px;color:#333}.modal-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 25px;color:#666;line-height:1.5}.modal-actions[_ngcontent-%COMP%]{display:flex;gap:10px;justify-content:flex-end}.btn-cancel-modal[_ngcontent-%COMP%], .btn-confirm-remove[_ngcontent-%COMP%]{padding:10px 20px;border:none;border-radius:5px;cursor:pointer;font-weight:600;transition:background .3s}.btn-cancel-modal[_ngcontent-%COMP%]{background:#e0e0e0;color:#333}.btn-cancel-modal[_ngcontent-%COMP%]:hover{background:#d0d0d0}.btn-confirm-remove[_ngcontent-%COMP%]{background:#f44336;color:#fff}.btn-confirm-remove[_ngcontent-%COMP%]:hover{background:#da190b}"]})};export{I as FriendsComponent};
